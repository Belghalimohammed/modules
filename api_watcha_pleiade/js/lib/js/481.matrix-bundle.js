"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[481],{481:(e,t,r)=>{r.r(t),r.d(t,{initRustCrypto:()=>Na});var n={};r.r(n),r.d(n,{Attachment:()=>ie,BackupDecryptionKey:()=>_e,BackupKeys:()=>ae,BackupSecretsBundle:()=>ge,Base64EncodedPkMessage:()=>de,BaseMigrationData:()=>pe,CancelInfo:()=>ye,CheckCode:()=>he,CollectStrategy:()=>ve,CrossSigningBootstrapRequests:()=>ke,CrossSigningKeyExport:()=>Re,CrossSigningStatus:()=>Ie,Curve25519PublicKey:()=>Oe,Curve25519SecretKey:()=>Me,DecryptedRoomEvent:()=>qe,DecryptionErrorCode:()=>P,DecryptionSettings:()=>Be,DehydratedDevice:()=>Ve,DehydratedDeviceKey:()=>Ue,DehydratedDevices:()=>Ne,Device:()=>ze,DeviceId:()=>Le,DeviceKey:()=>Ge,DeviceKeyAlgorithm:()=>Je,DeviceKeyAlgorithmName:()=>N,DeviceKeyId:()=>Ye,DeviceKeyName:()=>x,DeviceLists:()=>$e,Ecies:()=>et,Ed25519PublicKey:()=>rt,Ed25519Signature:()=>it,Emoji:()=>_t,EncryptedAttachment:()=>at,EncryptionAlgorithm:()=>z,EncryptionInfo:()=>gt,EncryptionSettings:()=>dt,EstablishedEcies:()=>pt,EventId:()=>yt,HistoryVisibility:()=>j,IdentityKeys:()=>ht,InboundCreationResult:()=>vt,InboundGroupSession:()=>kt,KeysBackupRequest:()=>Rt,KeysClaimRequest:()=>It,KeysQueryRequest:()=>Ot,KeysUploadRequest:()=>Mt,LocalTrust:()=>L,LoggerLevel:()=>W,MaybeSignature:()=>qt,MegolmDecryptionError:()=>Bt,MegolmV1BackupKey:()=>Vt,Migration:()=>Ut,OlmMachine:()=>Nt,OtherUserIdentity:()=>zt,OutboundCreationResult:()=>Lt,OwnUserIdentity:()=>Gt,PickledInboundGroupSession:()=>Jt,PickledSession:()=>Yt,PkDecryption:()=>$t,PkEncryption:()=>er,PkMessage:()=>rr,PutDehydratedDeviceRequest:()=>ir,Qr:()=>_r,QrCode:()=>ar,QrCodeData:()=>gr,QrCodeMode:()=>G,QrCodeScan:()=>dr,QrState:()=>Q,RehydratedDevice:()=>pr,RequestType:()=>J,RoomId:()=>yr,RoomKeyCounts:()=>hr,RoomKeyImportResult:()=>vr,RoomKeyInfo:()=>kr,RoomKeyWithheldInfo:()=>Rr,RoomMessageRequest:()=>Ir,RoomSettings:()=>Or,Sas:()=>Mr,SecretsBundle:()=>qr,ServerName:()=>Br,ShieldColor:()=>H,ShieldState:()=>Vr,ShieldStateCode:()=>Y,Signature:()=>Ur,SignatureState:()=>X,SignatureUploadRequest:()=>Nr,SignatureVerification:()=>zr,Signatures:()=>Lr,StoreHandle:()=>Gr,ToDeviceRequest:()=>Jr,Tracing:()=>Yr,TrustRequirement:()=>$,UploadSigningKeysRequest:()=>$r,UserDevices:()=>en,UserId:()=>rn,VerificationMethod:()=>Z,VerificationRequest:()=>sn,VerificationRequestPhase:()=>ee,Versions:()=>on,__wbg_String_8f0eb39a4a4c2f66:()=>an,__wbg_Window_b0044ac7db258535:()=>cn,__wbg_WorkerGlobalScope_b74cefefc62a37da:()=>gn,__wbg_add_883d9432f9188ef2:()=>un,__wbg_add_9338901b80183e0f:()=>dn,__wbg_at_7d852dd9f194d43e:()=>ln,__wbg_backupkeys_new:()=>pn,__wbg_bound_55a8d08e0491e17a:()=>wn,__wbg_bound_f2afc3766d4545cf:()=>yn,__wbg_buffer_609cc3eee51ed158:()=>bn,__wbg_call_672a4d21634d4a24:()=>hn,__wbg_call_7cccdd69e0791ae2:()=>fn,__wbg_call_833bed5770ea2041:()=>vn,__wbg_call_b8adc8b1d0a0d8eb:()=>mn,__wbg_clearTimeout_5a54f8841c30079a:()=>kn,__wbg_clear_f450db7eeb71163f:()=>Sn,__wbg_close_26fc2e6856d8567a:()=>Rn,__wbg_code_cfd8f6868bdaed9b:()=>Kn,__wbg_continue_c46c11d3dbe1b030:()=>In,__wbg_count_613cb921d67a4f26:()=>Cn,__wbg_count_ea1a2987dff7759e:()=>On,__wbg_createIndex_873ac48adc772309:()=>An,__wbg_createIndex_fcfd513cf4581834:()=>Mn,__wbg_createObjectStore_e566459f7161f82f:()=>En,__wbg_crosssigningbootstraprequests_new:()=>qn,__wbg_crosssigningkeyexport_new:()=>Dn,__wbg_crosssigningstatus_new:()=>Bn,__wbg_crypto_ed58b8e10a292839:()=>Tn,__wbg_debug_3cb59063b29f58c1:()=>Vn,__wbg_debug_f41e47509e8e4e36:()=>Fn,__wbg_decryptedroomevent_new:()=>Un,__wbg_dehydrateddevice_new:()=>Pn,__wbg_dehydrateddevicekey_new:()=>Nn,__wbg_deleteObjectStore_3f08ae00cd288224:()=>xn,__wbg_delete_200677093b4cf756:()=>zn,__wbg_delete_2ecf7cf20900b3a2:()=>jn,__wbg_device_new:()=>Ln,__wbg_deviceid_new:()=>Wn,__wbg_devicekey_new:()=>Gn,__wbg_devicekeyid_new:()=>Qn,__wbg_done_769e5ede4b31c67b:()=>Jn,__wbg_emoji_new:()=>Hn,__wbg_encryptioninfo_new:()=>Yn,__wbg_entries_3265d4158b33e5dc:()=>Xn,__wbg_entries_c8a90a7ed73e84ce:()=>$n,__wbg_error_524f506f44df1645:()=>Zn,__wbg_error_7534b8e9a36f1ab4:()=>ei,__wbg_error_76286673af64a31f:()=>ti,__wbg_error_ff4ddaabdfc5dbb3:()=>ri,__wbg_from_2a5d3e218e67aa85:()=>ni,__wbg_getAllKeys_b11d8835dc4be0e8:()=>ii,__wbg_getAll_304e868beec2021f:()=>si,__wbg_getAll_d1e60c13c0073374:()=>_i,__wbg_getAll_e6903c610babcd42:()=>oi,__wbg_getRandomValues_3d90134a348e46b3:()=>ai,__wbg_getRandomValues_bcb4912f16000dc4:()=>ci,__wbg_getTime_46267b1c24877e30:()=>gi,__wbg_get_67b2ba62fc30de12:()=>ui,__wbg_get_8da03f81f6a1111e:()=>di,__wbg_get_93e54e8e166fbcab:()=>li,__wbg_get_b9b93047fe3cf45b:()=>pi,__wbg_getwithrefkey_1dc361bd10053bfe:()=>wi,__wbg_global_b6f5c73312f62313:()=>yi,__wbg_inboundgroupsession_new:()=>bi,__wbg_index_e00ca5fff206ee3e:()=>hi,__wbg_indexedDB_601ec26c63e333de:()=>fi,__wbg_indexedDB_b1f49280282046f8:()=>vi,__wbg_indexedDB_f6b47b0dc333fd2f:()=>mi,__wbg_info_3b4be85e0a44d2af:()=>ki,__wbg_info_3daf2e093e091b66:()=>Si,__wbg_instanceof_ArrayBuffer_e14585432e3737fc:()=>Ri,__wbg_instanceof_Map_f3469ce2244d2430:()=>Ki,__wbg_instanceof_Promise_935168b8f4b49db3:()=>Ii,__wbg_instanceof_Uint8Array_17156bcf118086a9:()=>Ci,__wbg_isArray_a1eab7e0d067391b:()=>Oi,__wbg_isSafeInteger_343e2beeeece1bb0:()=>Ai,__wbg_item_c3c26b4103ad5aaf:()=>Mi,__wbg_iterator_9a24c88df860dc65:()=>Ei,__wbg_key_29fefecef430db96:()=>qi,__wbg_keysbackuprequest_new:()=>Di,__wbg_keysclaimrequest_new:()=>Bi,__wbg_keysqueryrequest_new:()=>Ti,__wbg_keysuploadrequest_new:()=>Vi,__wbg_length_238152a0aedbb6e7:()=>Fi,__wbg_length_a446193dc22c12f8:()=>Ui,__wbg_length_e2d2a49132c1b256:()=>Pi,__wbg_lowerBound_1872d19f5bcf83c6:()=>Ni,__wbg_maybesignature_new:()=>xi,__wbg_megolmdecryptionerror_new:()=>zi,__wbg_message_5c5d919204d42400:()=>ji,__wbg_msCrypto_0a36e2ec3a343d26:()=>Li,__wbg_name_f2d27098bfd843e7:()=>Wi,__wbg_new_23a2665fac83c611:()=>Gi,__wbg_new_31a97dac4f10fab7:()=>Qi,__wbg_new_405e22f390576ce2:()=>Ji,__wbg_new_5e0be73521bc8c17:()=>Hi,__wbg_new_78feb108b6472713:()=>Yi,__wbg_new_7a91e41fe43b3c92:()=>Xi,__wbg_new_8a6f238a6ece86ea:()=>$i,__wbg_new_a12002a7f91c75be:()=>Zi,__wbg_new_a239edaa1dc2968f:()=>es,__wbg_newnoargs_105ed471475aaf50:()=>ts,__wbg_newwithbyteoffsetandlength_6d34787141015158:()=>rs,__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a:()=>ns,__wbg_newwithlength_a381634e90c276d4:()=>is,__wbg_newwithlength_ee8e1b95dea9d37c:()=>ss,__wbg_newwithmessage_baedba94f03976fd:()=>_s,__wbg_next_25feadfc0913fea9:()=>os,__wbg_next_6574e1a8a62d1055:()=>as,__wbg_node_02999533c4ea02e3:()=>cs,__wbg_now_2c95c9de01293173:()=>gs,__wbg_now_807e54c39636c349:()=>us,__wbg_objectStoreNames_9bb1ab04a7012aaf:()=>ds,__wbg_objectStore_21878d46d25b64b6:()=>ls,__wbg_oldVersion_e8337811e52861c6:()=>ps,__wbg_olmmachine_new:()=>ws,__wbg_openCursor_1adef2266972fb45:()=>ys,__wbg_openCursor_238e247d18bde2cd:()=>bs,__wbg_openCursor_f4b061aa6d804b93:()=>hs,__wbg_open_88b1390d99a7c691:()=>fs,__wbg_open_e0c0b2993eb596e1:()=>vs,__wbg_otheruseridentity_new:()=>ms,__wbg_ownuseridentity_new:()=>ks,__wbg_parse_def2e24ef1252aff:()=>Ss,__wbg_performance_7a3ffd0b17f663ad:()=>Rs,__wbg_pickledinboundgroupsession_unwrap:()=>Ks,__wbg_pickledsession_unwrap:()=>Is,__wbg_process_5c1d670bc53614b8:()=>Cs,__wbg_push_737cfc8c1432c2c6:()=>Os,__wbg_put_066faa31a6a88f5b:()=>As,__wbg_putdehydrateddevicerequest_new:()=>Ms,__wbg_qr_new:()=>Es,__wbg_queueMicrotask_97d92b4fcc8a61c5:()=>qs,__wbg_queueMicrotask_d3219def82552485:()=>Ds,__wbg_randomFillSync_ab2cfe79ebbf2740:()=>Bs,__wbg_readyState_4013cfdf4f22afb0:()=>Ts,__wbg_rehydrateddevice_new:()=>Vs,__wbg_require_79b1e9274cde3c87:()=>Fs,__wbg_resolve_4851785c9c5f573d:()=>Us,__wbg_result_f29afabdf2c05826:()=>Ps,__wbg_roomid_unwrap:()=>Ns,__wbg_roomkeycounts_new:()=>xs,__wbg_roomkeyimportresult_new:()=>zs,__wbg_roomkeyinfo_new:()=>js,__wbg_roomkeywithheldinfo_new:()=>Ls,__wbg_roommessagerequest_new:()=>Ws,__wbg_roomsettings_new:()=>Gs,__wbg_sas_new:()=>Qs,__wbg_secretsbundle_new:()=>Js,__wbg_setTimeout_db2dbaeefb6f39c7:()=>Hs,__wbg_set_37837023f3d740e8:()=>Ys,__wbg_set_3f1d0b984ed272ed:()=>Xs,__wbg_set_65595bdd868b3009:()=>$s,__wbg_set_6775f73144c2ef27:()=>Zs,__wbg_set_8fc6bf8a5b1071d1:()=>e_,__wbg_set_wasm:()=>o,__wbg_setonabort_3bf4db6614fa98e9:()=>t_,__wbg_setonblocked_aebf64bd39f1eca8:()=>r_,__wbg_setoncomplete_4d19df0dadb7c4d4:()=>n_,__wbg_setonerror_b0d9d723b8fddbbb:()=>i_,__wbg_setonerror_d7e3056cc6e56085:()=>s_,__wbg_setonsuccess_afa464ee777a396d:()=>__,__wbg_setonupgradeneeded_fcf7ce4f2eb0cb5f:()=>o_,__wbg_setonversionchange_6ee07fa49ee1e3a5:()=>a_,__wbg_setunique_dd24c422aa05df89:()=>c_,__wbg_signatures_new:()=>g_,__wbg_signatureuploadrequest_new:()=>u_,__wbg_signatureverification_new:()=>d_,__wbg_stack_0ed75d68575b0f3c:()=>l_,__wbg_static_accessor_GLOBAL_88a902d13a557d07:()=>p_,__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0:()=>w_,__wbg_static_accessor_SELF_37c5d418e4bf5819:()=>y_,__wbg_static_accessor_WINDOW_5de37043a91a9c40:()=>b_,__wbg_storehandle_new:()=>h_,__wbg_stringify_f7ed6987935b4a24:()=>f_,__wbg_subarray_aa9065fa9dc5df96:()=>v_,__wbg_target_0a62d9d79a2a1ede:()=>m_,__wbg_then_44b73946d2fb3e7d:()=>k_,__wbg_then_48b406749878a531:()=>S_,__wbg_todevicerequest_new:()=>R_,__wbg_transaction_babc423936946a37:()=>K_,__wbg_transaction_d6d07c3c9963c49e:()=>I_,__wbg_transaction_e713aa7b07ccaedd:()=>C_,__wbg_update_acd72607f506872a:()=>O_,__wbg_userdevices_new:()=>A_,__wbg_userid_new:()=>M_,__wbg_userid_unwrap:()=>E_,__wbg_value_68c4e9a54bb7fd5e:()=>q_,__wbg_value_cd1ffa7b1ab794f1:()=>D_,__wbg_values_53465c57fc8cd691:()=>B_,__wbg_verificationrequest_new:()=>T_,__wbg_version_a70a33e5bbc6d6db:()=>V_,__wbg_versions_c71aa1626a93e0a1:()=>F_,__wbg_warn_4ca3906c248c47c4:()=>U_,__wbg_warn_6ce7b8525f302b4c:()=>P_,__wbindgen_as_number:()=>N_,__wbindgen_bigint_from_i64:()=>x_,__wbindgen_bigint_from_u64:()=>z_,__wbindgen_bigint_get_as_i64:()=>j_,__wbindgen_boolean_get:()=>L_,__wbindgen_cb_drop:()=>W_,__wbindgen_closure_wrapper1066:()=>G_,__wbindgen_closure_wrapper2247:()=>Q_,__wbindgen_closure_wrapper5526:()=>J_,__wbindgen_closure_wrapper7042:()=>H_,__wbindgen_closure_wrapper7044:()=>Y_,__wbindgen_debug_string:()=>X_,__wbindgen_error_new:()=>$_,__wbindgen_in:()=>Z_,__wbindgen_init_externref_table:()=>eo,__wbindgen_is_array:()=>to,__wbindgen_is_bigint:()=>ro,__wbindgen_is_function:()=>no,__wbindgen_is_null:()=>io,__wbindgen_is_object:()=>so,__wbindgen_is_string:()=>_o,__wbindgen_is_undefined:()=>oo,__wbindgen_jsval_eq:()=>ao,__wbindgen_jsval_loose_eq:()=>co,__wbindgen_memory:()=>go,__wbindgen_number_get:()=>uo,__wbindgen_number_new:()=>lo,__wbindgen_string_get:()=>po,__wbindgen_string_new:()=>wo,__wbindgen_throw:()=>yo,__wbindgen_try_into_number:()=>bo,getVersions:()=>q,start:()=>D});var i=r(4705),s=r(467);let _;function o(e){_=e}let a=0,c=null;function g(){return null!==c&&0!==c.byteLength||(c=new Uint8Array(_.memory.buffer)),c}let u=new("undefined"==typeof TextEncoder?(0,module.require)("util").TextEncoder:TextEncoder)("utf-8");const d="function"==typeof u.encodeInto?function(e,t){return u.encodeInto(e,t)}:function(e,t){const r=u.encode(e);return t.set(r),{read:e.length,written:r.length}};function l(e,t,r){if(void 0===r){const r=u.encode(e),n=t(r.length,1)>>>0;return g().subarray(n,n+r.length).set(r),a=r.length,n}let n=e.length,i=t(n,1)>>>0;const s=g();let _=0;for(;_<n;_++){const t=e.charCodeAt(_);if(t>127)break;s[i+_]=t}if(_!==n){0!==_&&(e=e.slice(_)),i=r(i,n,n=_+3*e.length,1)>>>0;const t=g().subarray(i+_,i+n);_+=d(e,t).written,i=r(i,n,_,1)>>>0}return a=_,i}let p=null;function w(){return(null===p||!0===p.buffer.detached||void 0===p.buffer.detached&&p.buffer!==_.memory.buffer)&&(p=new DataView(_.memory.buffer)),p}function y(e){const t=_.__externref_table_alloc();return _.__wbindgen_export_4.set(t,e),t}function b(e,t){try{return e.apply(this,t)}catch(e){const t=y(e);_.__wbindgen_exn_store(t)}}let h=new("undefined"==typeof TextDecoder?(0,module.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});function f(e,t){return e>>>=0,h.decode(g().subarray(e,e+t))}function v(e){return null==e}function m(e,t){return e>>>=0,g().subarray(e/1,e/1+t)}h.decode();const k="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>{_.__wbindgen_export_6.get(e.dtor)(e.a,e.b)}));function S(e,t,r,n){const i={a:e,b:t,cnt:1,dtor:r},s=(...e)=>{i.cnt++;const t=i.a;i.a=0;try{return n(t,i.b,...e)}finally{0===--i.cnt?(_.__wbindgen_export_6.get(i.dtor)(t,i.b),k.unregister(i)):i.a=t}};return s.original=i,k.register(s,i,i),s}function R(e,t,r,n){const i={a:e,b:t,cnt:1,dtor:r},s=(...e)=>{i.cnt++;try{return n(i.a,i.b,...e)}finally{0===--i.cnt&&(_.__wbindgen_export_6.get(i.dtor)(i.a,i.b),i.a=0,k.unregister(i))}};return s.original=i,k.register(s,i,i),s}function K(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let r="[";t>0&&(r+=K(e[0]));for(let n=1;n<t;n++)r+=", "+K(e[n]);return r+="]",r}const r=/\[object ([^\]]+)\]/.exec(toString.call(e));let n;if(!(r&&r.length>1))return toString.call(e);if(n=r[1],"Object"==n)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:n}function I(e,t){const r=t(1*e.length,1)>>>0;return g().set(e,r/1),a=e.length,r}function C(e){const t=_.__wbindgen_export_4.get(e);return _.__externref_table_dealloc(e),t}function O(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}function A(e,t){const r=t(4*e.length,4)>>>0;for(let t=0;t<e.length;t++){const n=y(e[t]);w().setUint32(r+4*t,n,!0)}return a=e.length,r}function M(e,t){e>>>=0;const r=w(),n=[];for(let i=e;i<e+4*t;i+=4)n.push(_.__wbindgen_export_4.get(r.getUint32(i,!0)));return _.__externref_drop_slice(e,t),n}let E=null;function q(){const e=_.getVersions();return on.__wrap(e)}function D(){_.start()}function B(e,t,r){const n=_.closure29_externref_shim_multivalue_shim(e,t,r);if(n[1])throw C(n[0])}function T(e,t){_._dyn_core__ops__function__FnMut_____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__h607bd7dfd48e12ce(e,t)}function V(e,t,r){_.closure734_externref_shim(e,t,r)}function F(e,t){_._dyn_core__ops__function__Fn_____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__h6591bac8898b164c(e,t)}function U(e,t,r){_.closure410_externref_shim(e,t,r)}const P=Object.freeze({MissingRoomKey:0,0:"MissingRoomKey",UnknownMessageIndex:1,1:"UnknownMessageIndex",MismatchedIdentityKeys:2,2:"MismatchedIdentityKeys",UnknownSenderDevice:3,3:"UnknownSenderDevice",UnsignedSenderDevice:4,4:"UnsignedSenderDevice",SenderIdentityVerificationViolation:5,5:"SenderIdentityVerificationViolation",UnableToDecrypt:6,6:"UnableToDecrypt"}),N=Object.freeze({Ed25519:0,0:"Ed25519",Curve25519:1,1:"Curve25519",Unknown:3,3:"Unknown"}),x=Object.freeze({Curve25519:0,0:"Curve25519",Ed25519:1,1:"Ed25519",Unknown:2,2:"Unknown"}),z=Object.freeze({OlmV1Curve25519AesSha2:0,0:"OlmV1Curve25519AesSha2",MegolmV1AesSha2:1,1:"MegolmV1AesSha2",Unknown:2,2:"Unknown"}),j=Object.freeze({Invited:0,0:"Invited",Joined:1,1:"Joined",Shared:2,2:"Shared",WorldReadable:3,3:"WorldReadable"}),L=Object.freeze({Verified:0,0:"Verified",BlackListed:1,1:"BlackListed",Ignored:2,2:"Ignored",Unset:3,3:"Unset"}),W=Object.freeze({Trace:0,0:"Trace",Debug:1,1:"Debug",Info:2,2:"Info",Warn:3,3:"Warn",Error:4,4:"Error"}),G=Object.freeze({Login:0,0:"Login",Reciprocate:1,1:"Reciprocate"}),Q=Object.freeze({Created:0,0:"Created",Scanned:1,1:"Scanned",Confirmed:2,2:"Confirmed",Reciprocated:3,3:"Reciprocated",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),J=Object.freeze({KeysUpload:0,0:"KeysUpload",KeysQuery:1,1:"KeysQuery",KeysClaim:2,2:"KeysClaim",ToDevice:3,3:"ToDevice",SignatureUpload:4,4:"SignatureUpload",RoomMessage:5,5:"RoomMessage",KeysBackup:6,6:"KeysBackup"}),H=Object.freeze({Red:0,0:"Red",Grey:1,1:"Grey",None:2,2:"None"}),Y=Object.freeze({AuthenticityNotGuaranteed:0,0:"AuthenticityNotGuaranteed",UnknownDevice:1,1:"UnknownDevice",UnsignedDevice:2,2:"UnsignedDevice",UnverifiedIdentity:3,3:"UnverifiedIdentity",SentInClear:4,4:"SentInClear",VerificationViolation:5,5:"VerificationViolation"}),X=Object.freeze({Missing:0,0:"Missing",Invalid:1,1:"Invalid",ValidButNotTrusted:2,2:"ValidButNotTrusted",ValidAndTrusted:3,3:"ValidAndTrusted"}),$=Object.freeze({Untrusted:0,0:"Untrusted",CrossSignedOrLegacy:1,1:"CrossSignedOrLegacy",CrossSigned:2,2:"CrossSigned"}),Z=Object.freeze({SasV1:0,0:"SasV1",QrCodeScanV1:1,1:"QrCodeScanV1",QrCodeShowV1:2,2:"QrCodeShowV1",ReciprocateV1:3,3:"ReciprocateV1"}),ee=Object.freeze({Created:0,0:"Created",Requested:1,1:"Requested",Ready:2,2:"Ready",Transitioned:3,3:"Transitioned",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),te=["pending","done"],re=["readonly","readwrite","versionchange","readwriteflush","cleanup"],ne="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_attachment_free(e>>>0,1)));class ie{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ne.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_attachment_free(e,0)}static encrypt(e){const t=I(e,_.__wbindgen_malloc),r=a,n=_.attachment_encrypt(t,r);if(n[2])throw C(n[1]);return at.__wrap(n[0])}static decrypt(e){O(e,at);const t=_.attachment_decrypt(e.__wbg_ptr);if(t[3])throw C(t[2]);var r=m(t[0],t[1]).slice();return _.__wbindgen_free(t[0],1*t[1],1),r}}const se="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_backupdecryptionkey_free(e>>>0,1)));class _e{static __wrap(e){e>>>=0;const t=Object.create(_e.prototype);return t.__wbg_ptr=e,se.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,se.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_backupdecryptionkey_free(e,0)}static createRandomKey(){const e=_.backupdecryptionkey_createRandomKey();return _e.__wrap(e)}static fromBase64(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.backupdecryptionkey_fromBase64(t,r);if(n[2])throw C(n[1]);return _e.__wrap(n[0])}toBase64(){return _.backupdecryptionkey_toBase64(this.__wbg_ptr)}get megolmV1PublicKey(){const e=_.backupdecryptionkey_megolmV1PublicKey(this.__wbg_ptr);return Vt.__wrap(e)}decryptV1(e,t,r){let n,i;try{const c=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),g=a,u=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),d=a,p=l(r,_.__wbindgen_malloc,_.__wbindgen_realloc),w=a,y=_.backupdecryptionkey_decryptV1(this.__wbg_ptr,c,g,u,d,p,w);var s=y[0],o=y[1];if(y[3])throw s=0,o=0,C(y[2]);return n=s,i=o,f(s,o)}finally{_.__wbindgen_free(n,i,1)}}}const oe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_backupkeys_free(e>>>0,1)));class ae{static __wrap(e){e>>>=0;const t=Object.create(ae.prototype);return t.__wbg_ptr=e,oe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,oe.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_backupkeys_free(e,0)}get decryptionKey(){const e=_.__wbg_get_backupkeys_decryptionKey(this.__wbg_ptr);return 0===e?void 0:_e.__wrap(e)}set decryptionKey(e){let t=0;v(e)||(O(e,_e),t=e.__destroy_into_raw()),_.__wbg_set_backupkeys_decryptionKey(this.__wbg_ptr,t)}get backupVersion(){const e=_.__wbg_get_backupkeys_backupVersion(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set backupVersion(e){var t=v(e)?0:l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupkeys_backupVersion(this.__wbg_ptr,t,r)}get decryptionKeyBase64(){return _.backupkeys_decryptionKeyBase64(this.__wbg_ptr)}}const ce="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_backupsecretsbundle_free(e>>>0,1)));class ge{static __wrap(e){e>>>=0;const t=Object.create(ge.prototype);return t.__wbg_ptr=e,ce.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ce.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_backupsecretsbundle_free(e,0)}get key(){let e,t;try{const r=_.__wbg_get_backupsecretsbundle_key(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set key(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backup_version(){let e,t;try{const r=_.__wbg_get_backupsecretsbundle_backup_version(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set backup_version(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}}const ue="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_base64encodedpkmessage_free(e>>>0,1)));class de{static __wrap(e){e>>>=0;const t=Object.create(de.prototype);return t.__wbg_ptr=e,ue.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ue.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_base64encodedpkmessage_free(e,0)}get ciphertext(){let e,t;try{const r=_.__wbg_get_base64encodedpkmessage_ciphertext(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set ciphertext(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get mac(){let e,t;try{const r=_.__wbg_get_base64encodedpkmessage_mac(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set mac(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get ephemeralKey(){let e,t;try{const r=_.__wbg_get_base64encodedpkmessage_ephemeralKey(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set ephemeralKey(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_base64encodedpkmessage_ephemeralKey(this.__wbg_ptr,t,r)}constructor(e,t,r){const n=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=a,s=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),o=a,c=l(r,_.__wbindgen_malloc,_.__wbindgen_realloc),g=a,u=_.base64encodedpkmessage_new(n,i,s,o,c,g);return this.__wbg_ptr=u>>>0,ue.register(this,this.__wbg_ptr,this),this}}const le="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_basemigrationdata_free(e>>>0,1)));class pe{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,le.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_basemigrationdata_free(e,0)}get userId(){const e=_.__wbg_get_basemigrationdata_userId(this.__wbg_ptr);return 0===e?void 0:rn.__wrap(e)}set userId(e){let t=0;v(e)||(O(e,rn),t=e.__destroy_into_raw()),_.__wbg_set_basemigrationdata_userId(this.__wbg_ptr,t)}get deviceId(){const e=_.__wbg_get_basemigrationdata_deviceId(this.__wbg_ptr);return 0===e?void 0:Le.__wrap(e)}set deviceId(e){let t=0;v(e)||(O(e,Le),t=e.__destroy_into_raw()),_.__wbg_set_basemigrationdata_deviceId(this.__wbg_ptr,t)}get pickledAccount(){let e,t;try{const r=_.__wbg_get_basemigrationdata_pickledAccount(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set pickledAccount(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backupVersion(){const e=_.__wbg_get_basemigrationdata_backupVersion(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set backupVersion(e){var t=v(e)?0:l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_basemigrationdata_backupVersion(this.__wbg_ptr,t,r)}get backupRecoveryKey(){const e=_.__wbg_get_basemigrationdata_backupRecoveryKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set backupRecoveryKey(e){var t=v(e)?0:l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get privateCrossSigningMasterKey(){const e=_.__wbg_get_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningMasterKey(e){var t=v(e)?0:l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr,t,r)}get privateCrossSigningSelfSigningKey(){const e=_.__wbg_get_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningSelfSigningKey(e){var t=v(e)?0:l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr,t,r)}get privateCrossSigningUserSigningKey(){const e=_.__wbg_get_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningUserSigningKey(e){var t=v(e)?0:l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr,t,r)}constructor(){const e=_.basemigrationdata_new();return this.__wbg_ptr=e>>>0,le.register(this,this.__wbg_ptr,this),this}}const we="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_cancelinfo_free(e>>>0,1)));class ye{static __wrap(e){e>>>=0;const t=Object.create(ye.prototype);return t.__wbg_ptr=e,we.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,we.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_cancelinfo_free(e,0)}reason(){return _.cancelinfo_reason(this.__wbg_ptr)}cancelCode(){let e,t;try{const r=_.cancelinfo_cancelCode(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}cancelledbyUs(){return 0!==_.cancelinfo_cancelledbyUs(this.__wbg_ptr)}}const be="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_checkcode_free(e>>>0,1)));class he{static __wrap(e){e>>>=0;const t=Object.create(he.prototype);return t.__wbg_ptr=e,be.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,be.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_checkcode_free(e,0)}as_bytes(){const e=_.checkcode_as_bytes(this.__wbg_ptr);var t=m(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}to_digit(){return _.checkcode_to_digit(this.__wbg_ptr)}}const fe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_collectstrategy_free(e>>>0,1)));class ve{static __wrap(e){e>>>=0;const t=Object.create(ve.prototype);return t.__wbg_ptr=e,fe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,fe.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_collectstrategy_free(e,0)}eq(e){return O(e,ve),0!==_.collectstrategy_eq(this.__wbg_ptr,e.__wbg_ptr)}static deviceBasedStrategy(e,t){const r=_.collectstrategy_deviceBasedStrategy(e,t);return ve.__wrap(r)}static allDevices(){const e=_.collectstrategy_allDevices();return ve.__wrap(e)}static errorOnUnverifiedUserProblem(){const e=_.collectstrategy_errorOnUnverifiedUserProblem();return ve.__wrap(e)}static identityBasedStrategy(){const e=_.collectstrategy_identityBasedStrategy();return ve.__wrap(e)}static onlyTrustedDevices(){const e=_.collectstrategy_onlyTrustedDevices();return ve.__wrap(e)}}const me="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_crosssigningbootstraprequests_free(e>>>0,1)));class ke{static __wrap(e){e>>>=0;const t=Object.create(ke.prototype);return t.__wbg_ptr=e,me.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,me.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_crosssigningbootstraprequests_free(e,0)}get uploadKeysRequest(){return _.__wbg_get_crosssigningbootstraprequests_uploadKeysRequest(this.__wbg_ptr)}get uploadSigningKeysRequest(){const e=_.__wbg_get_crosssigningbootstraprequests_uploadSigningKeysRequest(this.__wbg_ptr);return $r.__wrap(e)}get uploadSignaturesRequest(){const e=_.__wbg_get_crosssigningbootstraprequests_uploadSignaturesRequest(this.__wbg_ptr);return Nr.__wrap(e)}}const Se="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_crosssigningkeyexport_free(e>>>0,1)));class Re{static __wrap(e){e>>>=0;const t=Object.create(Re.prototype);return t.__wbg_ptr=e,Se.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Se.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_crosssigningkeyexport_free(e,0)}get masterKey(){const e=_.crosssigningkeyexport_masterKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}get self_signing_key(){const e=_.crosssigningkeyexport_self_signing_key(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}get userSigningKey(){const e=_.crosssigningkeyexport_userSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}}const Ke="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_crosssigningstatus_free(e>>>0,1)));class Ie{static __wrap(e){e>>>=0;const t=Object.create(Ie.prototype);return t.__wbg_ptr=e,Ke.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ke.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_crosssigningstatus_free(e,0)}get hasMaster(){return 0!==_.crosssigningstatus_hasMaster(this.__wbg_ptr)}get hasSelfSigning(){return 0!==_.crosssigningstatus_hasSelfSigning(this.__wbg_ptr)}get hasUserSigning(){return 0!==_.crosssigningstatus_hasUserSigning(this.__wbg_ptr)}}const Ce="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_curve25519publickey_free(e>>>0,1)));class Oe{static __wrap(e){e>>>=0;const t=Object.create(Oe.prototype);return t.__wbg_ptr=e,Ce.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ce.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_curve25519publickey_free(e,0)}constructor(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.curve25519publickey_new(t,r);if(n[2])throw C(n[1]);return this.__wbg_ptr=n[0]>>>0,Ce.register(this,this.__wbg_ptr,this),this}get length(){return _.curve25519publickey_length(this.__wbg_ptr)>>>0}toBase64(){let e,t;try{const r=_.curve25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Ae="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_curve25519secretkey_free(e>>>0,1)));class Me{static __wrap(e){e>>>=0;const t=Object.create(Me.prototype);return t.__wbg_ptr=e,Ae.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ae.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_curve25519secretkey_free(e,0)}static new(){const e=_.curve25519secretkey_new();return Me.__wrap(e)}static fromBase64(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.curve25519secretkey_fromBase64(t,r);if(n[2])throw C(n[1]);return Me.__wrap(n[0])}toBase64(){let e,t;try{const r=_.curve25519secretkey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}toUint8Array(){const e=_.curve25519secretkey_toUint8Array(this.__wbg_ptr);var t=m(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}static fromUint8Array(e){const t=I(e,_.__wbindgen_malloc),r=a,n=_.curve25519secretkey_fromUint8Array(t,r);if(n[2])throw C(n[1]);return Me.__wrap(n[0])}}const Ee="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_decryptedroomevent_free(e>>>0,1)));class qe{static __wrap(e){e>>>=0;const t=Object.create(qe.prototype);return t.__wbg_ptr=e,Ee.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ee.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_decryptedroomevent_free(e,0)}get event(){return _.__wbg_get_decryptedroomevent_event(this.__wbg_ptr)}get sender(){const e=_.decryptedroomevent_sender(this.__wbg_ptr);return 0===e?void 0:rn.__wrap(e)}get senderDevice(){const e=_.decryptedroomevent_senderDevice(this.__wbg_ptr);return 0===e?void 0:Le.__wrap(e)}get senderCurve25519Key(){return _.decryptedroomevent_senderCurve25519Key(this.__wbg_ptr)}get senderClaimedEd25519Key(){return _.decryptedroomevent_senderClaimedEd25519Key(this.__wbg_ptr)}get forwardingCurve25519KeyChain(){return _.decryptedroomevent_forwardingCurve25519KeyChain(this.__wbg_ptr)}shieldState(e){const t=_.decryptedroomevent_shieldState(this.__wbg_ptr,e);return 0===t?void 0:Vr.__wrap(t)}}const De="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_decryptionsettings_free(e>>>0,1)));class Be{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,De.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_decryptionsettings_free(e,0)}get sender_device_trust_requirement(){return _.__wbg_get_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr)}set sender_device_trust_requirement(e){_.__wbg_set_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr,e)}constructor(e){const t=_.decryptionsettings_new(e);return this.__wbg_ptr=t>>>0,De.register(this,this.__wbg_ptr,this),this}}const Te="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_dehydrateddevice_free(e>>>0,1)));class Ve{static __wrap(e){e>>>=0;const t=Object.create(Ve.prototype);return t.__wbg_ptr=e,Te.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Te.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_dehydrateddevice_free(e,0)}keysForUpload(e,t){return O(t,Ue),_.dehydrateddevice_keysForUpload(this.__wbg_ptr,e,t.__wbg_ptr)}}const Fe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_dehydrateddevicekey_free(e>>>0,1)));class Ue{static __wrap(e){e>>>=0;const t=Object.create(Ue.prototype);return t.__wbg_ptr=e,Fe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Fe.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_dehydrateddevicekey_free(e,0)}static createRandomKey(){const e=_.dehydrateddevicekey_createRandomKey();if(e[2])throw C(e[1]);return Ue.__wrap(e[0])}static createKeyFromArray(e){const t=_.dehydrateddevicekey_createKeyFromArray(e);if(t[2])throw C(t[1]);return Ue.__wrap(t[0])}toBase64(){return _.dehydrateddevicekey_toBase64(this.__wbg_ptr)}}const Pe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_dehydrateddevices_free(e>>>0,1)));class Ne{static __wrap(e){e>>>=0;const t=Object.create(Ne.prototype);return t.__wbg_ptr=e,Pe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Pe.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_dehydrateddevices_free(e,0)}create(){return _.dehydrateddevices_create(this.__wbg_ptr)}rehydrate(e,t,r){O(e,Ue),O(t,Le);const n=l(r,_.__wbindgen_malloc,_.__wbindgen_realloc),i=a;return _.dehydrateddevices_rehydrate(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,n,i)}getDehydratedDeviceKey(){return _.dehydrateddevices_getDehydratedDeviceKey(this.__wbg_ptr)}saveDehydratedDeviceKey(e){return O(e,Ue),_.dehydrateddevices_saveDehydratedDeviceKey(this.__wbg_ptr,e.__wbg_ptr)}deleteDehydratedDeviceKey(){return _.dehydrateddevices_deleteDehydratedDeviceKey(this.__wbg_ptr)}}const xe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_device_free(e>>>0,1)));class ze{static __wrap(e){e>>>=0;const t=Object.create(ze.prototype);return t.__wbg_ptr=e,xe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xe.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_device_free(e,0)}requestVerification(e){var t=v(e)?0:A(e,_.__wbindgen_malloc),r=a;const n=_.device_requestVerification(this.__wbg_ptr,t,r);if(n[2])throw C(n[1]);return C(n[0])}encryptToDeviceEvent(e,t){const r=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a;return _.device_encryptToDeviceEvent(this.__wbg_ptr,r,n,t)}isVerified(){return 0!==_.device_isVerified(this.__wbg_ptr)}isCrossSigningTrusted(){return 0!==_.device_isCrossSigningTrusted(this.__wbg_ptr)}isCrossSignedByOwner(){return 0!==_.device_isCrossSignedByOwner(this.__wbg_ptr)}setLocalTrust(e){return _.device_setLocalTrust(this.__wbg_ptr,e)}get userId(){const e=_.device_userId(this.__wbg_ptr);return rn.__wrap(e)}get deviceId(){const e=_.device_deviceId(this.__wbg_ptr);return Le.__wrap(e)}get displayName(){const e=_.device_displayName(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}getKey(e){const t=_.device_getKey(this.__wbg_ptr,e);if(t[2])throw C(t[1]);return 0===t[0]?void 0:Ge.__wrap(t[0])}get curve25519Key(){const e=_.device_curve25519Key(this.__wbg_ptr);return 0===e?void 0:Oe.__wrap(e)}get ed25519Key(){const e=_.device_ed25519Key(this.__wbg_ptr);return 0===e?void 0:rt.__wrap(e)}get keys(){return _.device_keys(this.__wbg_ptr)}get algorithms(){return _.device_algorithms(this.__wbg_ptr)}get signatures(){const e=_.device_signatures(this.__wbg_ptr);return Lr.__wrap(e)}get localTrustState(){return _.device_localTrustState(this.__wbg_ptr)}isLocallyTrusted(){return 0!==_.device_isLocallyTrusted(this.__wbg_ptr)}isBlacklisted(){return 0!==_.device_isBlacklisted(this.__wbg_ptr)}isDeleted(){return 0!==_.device_isDeleted(this.__wbg_ptr)}firstTimeSeen(){const e=_.device_firstTimeSeen(this.__wbg_ptr);return BigInt.asUintN(64,e)}verify(){return _.device_verify(this.__wbg_ptr)}get isDehydrated(){return 0!==_.device_isDehydrated(this.__wbg_ptr)}}const je="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_deviceid_free(e>>>0,1)));class Le{static __wrap(e){e>>>=0;const t=Object.create(Le.prototype);return t.__wbg_ptr=e,je.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,je.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_deviceid_free(e,0)}constructor(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.deviceid_new(t,r);return this.__wbg_ptr=n>>>0,je.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=_.deviceid_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const We="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_devicekey_free(e>>>0,1)));class Ge{static __wrap(e){e>>>=0;const t=Object.create(Ge.prototype);return t.__wbg_ptr=e,We.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,We.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_devicekey_free(e,0)}get name(){return _.devicekey_name(this.__wbg_ptr)}get curve25519(){const e=_.devicekey_curve25519(this.__wbg_ptr);return 0===e?void 0:Oe.__wrap(e)}get ed25519(){const e=_.devicekey_ed25519(this.__wbg_ptr);return 0===e?void 0:rt.__wrap(e)}get unknown(){const e=_.devicekey_unknown(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}toBase64(){let e,t;try{const r=_.devicekey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Qe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_devicekeyalgorithm_free(e>>>0,1)));class Je{static __wrap(e){e>>>=0;const t=Object.create(Je.prototype);return t.__wbg_ptr=e,Qe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Qe.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_devicekeyalgorithm_free(e,0)}get name(){return _.devicekeyalgorithm_name(this.__wbg_ptr)}toString(){let e,t;try{const r=_.devicekeyalgorithm_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const He="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_devicekeyid_free(e>>>0,1)));class Ye{static __wrap(e){e>>>=0;const t=Object.create(Ye.prototype);return t.__wbg_ptr=e,He.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,He.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_devicekeyid_free(e,0)}constructor(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.devicekeyid_new(t,r);if(n[2])throw C(n[1]);return this.__wbg_ptr=n[0]>>>0,He.register(this,this.__wbg_ptr,this),this}get algorithm(){const e=_.devicekeyid_algorithm(this.__wbg_ptr);return Je.__wrap(e)}get deviceId(){const e=_.devicekeyid_deviceId(this.__wbg_ptr);return Le.__wrap(e)}toString(){let e,t;try{const r=_.devicekeyid_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Xe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_devicelists_free(e>>>0,1)));class $e{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Xe.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_devicelists_free(e,0)}constructor(e,t){var r=v(e)?0:A(e,_.__wbindgen_malloc),n=a,i=v(t)?0:A(t,_.__wbindgen_malloc),s=a;const o=_.devicelists_new(r,n,i,s);if(o[2])throw C(o[1]);return this.__wbg_ptr=o[0]>>>0,Xe.register(this,this.__wbg_ptr,this),this}isEmpty(){return 0!==_.devicelists_isEmpty(this.__wbg_ptr)}get changed(){const e=_.devicelists_changed(this.__wbg_ptr);var t=M(e[0],e[1]).slice();return _.__wbindgen_free(e[0],4*e[1],4),t}get left(){const e=_.devicelists_left(this.__wbg_ptr);var t=M(e[0],e[1]).slice();return _.__wbindgen_free(e[0],4*e[1],4),t}}const Ze="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_ecies_free(e>>>0,1)));class et{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ze.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_ecies_free(e,0)}constructor(){const e=_.ecies_new();return this.__wbg_ptr=e>>>0,Ze.register(this,this.__wbg_ptr,this),this}public_key(){const e=_.ecies_public_key(this.__wbg_ptr);return Oe.__wrap(e)}establish_inbound_channel(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.ecies_establish_inbound_channel(this.__wbg_ptr,t,r);if(n[2])throw C(n[1]);return vt.__wrap(n[0])}establish_outbound_channel(e,t){O(e,Oe);const r=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a,i=_.ecies_establish_outbound_channel(this.__wbg_ptr,e.__wbg_ptr,r,n);if(i[2])throw C(i[1]);return Lt.__wrap(i[0])}}const tt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_ed25519publickey_free(e>>>0,1)));class rt{static __wrap(e){e>>>=0;const t=Object.create(rt.prototype);return t.__wbg_ptr=e,tt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,tt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_ed25519publickey_free(e,0)}get length(){return _.ed25519publickey_length(this.__wbg_ptr)>>>0}toBase64(){let e,t;try{const r=_.ed25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const nt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_ed25519signature_free(e>>>0,1)));class it{static __wrap(e){e>>>=0;const t=Object.create(it.prototype);return t.__wbg_ptr=e,nt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,nt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_ed25519signature_free(e,0)}constructor(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.ed25519signature_new(t,r);if(n[2])throw C(n[1]);return this.__wbg_ptr=n[0]>>>0,nt.register(this,this.__wbg_ptr,this),this}toBase64(){let e,t;try{const r=_.ed25519signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const st="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_emoji_free(e>>>0,1)));class _t{static __wrap(e){e>>>=0;const t=Object.create(_t.prototype);return t.__wbg_ptr=e,st.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,st.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_emoji_free(e,0)}get symbol(){return _.emoji_symbol(this.__wbg_ptr)}get description(){return _.emoji_description(this.__wbg_ptr)}}const ot="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_encryptedattachment_free(e>>>0,1)));class at{static __wrap(e){e>>>=0;const t=Object.create(at.prototype);return t.__wbg_ptr=e,ot.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ot.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_encryptedattachment_free(e,0)}constructor(e,t){const r=I(e,_.__wbindgen_malloc),n=a,i=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),s=a,o=_.encryptedattachment_new(r,n,i,s);if(o[2])throw C(o[1]);return this.__wbg_ptr=o[0]>>>0,ot.register(this,this.__wbg_ptr,this),this}get encryptedData(){const e=_.encryptedattachment_encryptedData(this.__wbg_ptr);var t=m(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}get mediaEncryptionInfo(){const e=_.encryptedattachment_mediaEncryptionInfo(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}get hasMediaEncryptionInfoBeenConsumed(){return 0!==_.encryptedattachment_hasMediaEncryptionInfoBeenConsumed(this.__wbg_ptr)}}const ct="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_encryptioninfo_free(e>>>0,1)));class gt{static __wrap(e){e>>>=0;const t=Object.create(gt.prototype);return t.__wbg_ptr=e,ct.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ct.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_encryptioninfo_free(e,0)}get sender(){const e=_.encryptioninfo_sender(this.__wbg_ptr);return rn.__wrap(e)}get senderDevice(){const e=_.encryptioninfo_senderDevice(this.__wbg_ptr);return 0===e?void 0:Le.__wrap(e)}get senderCurve25519Key(){return _.encryptioninfo_senderCurve25519Key(this.__wbg_ptr)}get senderClaimedEd25519Key(){return _.encryptioninfo_senderClaimedEd25519Key(this.__wbg_ptr)}shieldState(e){const t=_.encryptioninfo_shieldState(this.__wbg_ptr,e);return Vr.__wrap(t)}}const ut="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_encryptionsettings_free(e>>>0,1)));class dt{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ut.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_encryptionsettings_free(e,0)}get algorithm(){return _.__wbg_get_encryptionsettings_algorithm(this.__wbg_ptr)}set algorithm(e){_.__wbg_set_encryptionsettings_algorithm(this.__wbg_ptr,e)}get rotationPeriod(){const e=_.__wbg_get_encryptionsettings_rotationPeriod(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriod(e){_.__wbg_set_encryptionsettings_rotationPeriod(this.__wbg_ptr,e)}get rotationPeriodMessages(){const e=_.__wbg_get_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriodMessages(e){_.__wbg_set_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr,e)}get historyVisibility(){return _.__wbg_get_encryptionsettings_historyVisibility(this.__wbg_ptr)}set historyVisibility(e){_.__wbg_set_encryptionsettings_historyVisibility(this.__wbg_ptr,e)}get sharingStrategy(){const e=_.__wbg_get_encryptionsettings_sharingStrategy(this.__wbg_ptr);return ve.__wrap(e)}set sharingStrategy(e){O(e,ve);var t=e.__destroy_into_raw();_.__wbg_set_encryptionsettings_sharingStrategy(this.__wbg_ptr,t)}constructor(){const e=_.encryptionsettings_new();return this.__wbg_ptr=e>>>0,ut.register(this,this.__wbg_ptr,this),this}}const lt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_establishedecies_free(e>>>0,1)));class pt{static __wrap(e){e>>>=0;const t=Object.create(pt.prototype);return t.__wbg_ptr=e,lt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,lt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_establishedecies_free(e,0)}public_key(){const e=_.establishedecies_public_key(this.__wbg_ptr);return Oe.__wrap(e)}encrypt(e){let t,r;try{const n=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=a,s=_.establishedecies_encrypt(this.__wbg_ptr,n,i);return t=s[0],r=s[1],f(s[0],s[1])}finally{_.__wbindgen_free(t,r,1)}}decrypt(e){let t,r;try{const s=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),o=a,c=_.establishedecies_decrypt(this.__wbg_ptr,s,o);var n=c[0],i=c[1];if(c[3])throw n=0,i=0,C(c[2]);return t=n,r=i,f(n,i)}finally{_.__wbindgen_free(t,r,1)}}check_code(){const e=_.establishedecies_check_code(this.__wbg_ptr);return he.__wrap(e)}}const wt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_eventid_free(e>>>0,1)));class yt{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,wt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_eventid_free(e,0)}constructor(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.eventid_new(t,r);if(n[2])throw C(n[1]);return this.__wbg_ptr=n[0]>>>0,wt.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=_.eventid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get serverName(){const e=_.eventid_serverName(this.__wbg_ptr);return 0===e?void 0:Br.__wrap(e)}toString(){let e,t;try{const r=_.eventid_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const bt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_identitykeys_free(e>>>0,1)));class ht{static __wrap(e){e>>>=0;const t=Object.create(ht.prototype);return t.__wbg_ptr=e,bt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,bt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_identitykeys_free(e,0)}get ed25519(){const e=_.__wbg_get_identitykeys_ed25519(this.__wbg_ptr);return rt.__wrap(e)}set ed25519(e){O(e,rt);var t=e.__destroy_into_raw();_.__wbg_set_identitykeys_ed25519(this.__wbg_ptr,t)}get curve25519(){const e=_.__wbg_get_identitykeys_curve25519(this.__wbg_ptr);return Oe.__wrap(e)}set curve25519(e){O(e,Oe);var t=e.__destroy_into_raw();_.__wbg_set_identitykeys_curve25519(this.__wbg_ptr,t)}}const ft="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_inboundcreationresult_free(e>>>0,1)));class vt{static __wrap(e){e>>>=0;const t=Object.create(vt.prototype);return t.__wbg_ptr=e,ft.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ft.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_inboundcreationresult_free(e,0)}get channel(){const e=_.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return pt.__wrap(e)}set channel(e){O(e,pt);var t=e.__destroy_into_raw();_.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get message(){let e,t;try{const r=_.__wbg_get_inboundcreationresult_message(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set message(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}}const mt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_inboundgroupsession_free(e>>>0,1)));class kt{static __wrap(e){e>>>=0;const t=Object.create(kt.prototype);return t.__wbg_ptr=e,mt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,mt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_inboundgroupsession_free(e,0)}get roomId(){const e=_.inboundgroupsession_roomId(this.__wbg_ptr);return yr.__wrap(e)}get senderKey(){const e=_.inboundgroupsession_senderKey(this.__wbg_ptr);return Oe.__wrap(e)}get sessionId(){let e,t;try{const r=_.inboundgroupsession_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}hasBeenImported(){return 0!==_.inboundgroupsession_hasBeenImported(this.__wbg_ptr)}}const St="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_keysbackuprequest_free(e>>>0,1)));class Rt{static __wrap(e){e>>>=0;const t=Object.create(Rt.prototype);return t.__wbg_ptr=e,St.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,St.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_keysbackuprequest_free(e,0)}get id(){return _.__wbg_get_keysbackuprequest_id(this.__wbg_ptr)}get body(){return _.__wbg_get_keysbackuprequest_body(this.__wbg_ptr)}get version(){return _.__wbg_get_keysbackuprequest_version(this.__wbg_ptr)}constructor(e,t,r){const n=_.keysbackuprequest_new(e,t,r);return this.__wbg_ptr=n>>>0,St.register(this,this.__wbg_ptr,this),this}get type(){return _.keysbackuprequest_type(this.__wbg_ptr)}}const Kt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_keysclaimrequest_free(e>>>0,1)));class It{static __wrap(e){e>>>=0;const t=Object.create(It.prototype);return t.__wbg_ptr=e,Kt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Kt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_keysclaimrequest_free(e,0)}get id(){return _.__wbg_get_keysclaimrequest_id(this.__wbg_ptr)}get body(){return _.__wbg_get_keysclaimrequest_body(this.__wbg_ptr)}constructor(e,t){const r=_.keysclaimrequest_new(e,t);return this.__wbg_ptr=r>>>0,Kt.register(this,this.__wbg_ptr,this),this}get type(){return _.keysclaimrequest_type(this.__wbg_ptr)}}const Ct="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_keysqueryrequest_free(e>>>0,1)));class Ot{static __wrap(e){e>>>=0;const t=Object.create(Ot.prototype);return t.__wbg_ptr=e,Ct.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ct.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_keysqueryrequest_free(e,0)}get id(){return _.__wbg_get_keysqueryrequest_id(this.__wbg_ptr)}get body(){return _.__wbg_get_keysqueryrequest_body(this.__wbg_ptr)}constructor(e,t){const r=_.keysqueryrequest_new(e,t);return this.__wbg_ptr=r>>>0,Ct.register(this,this.__wbg_ptr,this),this}get type(){return _.keysqueryrequest_type(this.__wbg_ptr)}}const At="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_keysuploadrequest_free(e>>>0,1)));class Mt{static __wrap(e){e>>>=0;const t=Object.create(Mt.prototype);return t.__wbg_ptr=e,At.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,At.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_keysuploadrequest_free(e,0)}get id(){return _.__wbg_get_keysuploadrequest_id(this.__wbg_ptr)}get body(){return _.__wbg_get_keysuploadrequest_body(this.__wbg_ptr)}constructor(e,t){const r=_.keysuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,At.register(this,this.__wbg_ptr,this),this}get type(){return _.keysuploadrequest_type(this.__wbg_ptr)}}const Et="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_maybesignature_free(e>>>0,1)));class qt{static __wrap(e){e>>>=0;const t=Object.create(qt.prototype);return t.__wbg_ptr=e,Et.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Et.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_maybesignature_free(e,0)}isValid(){return 0!==_.maybesignature_isValid(this.__wbg_ptr)}isInvalid(){return 0!==_.maybesignature_isInvalid(this.__wbg_ptr)}get signature(){const e=_.maybesignature_signature(this.__wbg_ptr);return 0===e?void 0:Ur.__wrap(e)}get invalidSignatureSource(){const e=_.maybesignature_invalidSignatureSource(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}}const Dt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_megolmdecryptionerror_free(e>>>0,1)));class Bt{static __wrap(e){e>>>=0;const t=Object.create(Bt.prototype);return t.__wbg_ptr=e,Dt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Dt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_megolmdecryptionerror_free(e,0)}get code(){return _.__wbg_get_megolmdecryptionerror_code(this.__wbg_ptr)}get description(){return _.__wbg_get_megolmdecryptionerror_description(this.__wbg_ptr)}get maybe_withheld(){return _.__wbg_get_megolmdecryptionerror_maybe_withheld(this.__wbg_ptr)}}const Tt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_megolmv1backupkey_free(e>>>0,1)));class Vt{static __wrap(e){e>>>=0;const t=Object.create(Vt.prototype);return t.__wbg_ptr=e,Tt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Tt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_megolmv1backupkey_free(e,0)}get publicKeyBase64(){return _.megolmv1backupkey_publicKeyBase64(this.__wbg_ptr)}get algorithm(){return _.megolmv1backupkey_algorithm(this.__wbg_ptr)}}const Ft="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_migration_free(e>>>0,1)));class Ut{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ft.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_migration_free(e,0)}static migrateBaseData(e,t,r){return O(e,pe),O(r,Gr),_.migration_migrateBaseData(e.__wbg_ptr,t,r.__wbg_ptr)}static migrateOlmSessions(e,t,r){const n=A(e,_.__wbindgen_malloc),i=a;return O(r,Gr),_.migration_migrateOlmSessions(n,i,t,r.__wbg_ptr)}static migrateMegolmSessions(e,t,r){const n=A(e,_.__wbindgen_malloc),i=a;return O(r,Gr),_.migration_migrateMegolmSessions(n,i,t,r.__wbg_ptr)}}const Pt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_olmmachine_free(e>>>0,1)));class Nt{static __wrap(e){e>>>=0;const t=Object.create(Nt.prototype);return t.__wbg_ptr=e,Pt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Pt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_olmmachine_free(e,0)}constructor(){const e=_.olmmachine_new();if(e[2])throw C(e[1]);return this.__wbg_ptr=e[0]>>>0,Pt.register(this,this.__wbg_ptr,this),this}static initialize(e,t,r,n){O(e,rn),O(t,Le);var i=v(r)?0:l(r,_.__wbindgen_malloc,_.__wbindgen_realloc),s=a,o=v(n)?0:l(n,_.__wbindgen_malloc,_.__wbindgen_realloc),c=a;return _.olmmachine_initialize(e.__wbg_ptr,t.__wbg_ptr,i,s,o,c)}static initFromStore(e,t,r){return O(e,rn),O(t,Le),O(r,Gr),_.olmmachine_initFromStore(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr)}get userId(){const e=_.olmmachine_userId(this.__wbg_ptr);return rn.__wrap(e)}get deviceId(){const e=_.olmmachine_deviceId(this.__wbg_ptr);return Le.__wrap(e)}get deviceCreationTimeMs(){return _.olmmachine_deviceCreationTimeMs(this.__wbg_ptr)}get identityKeys(){const e=_.olmmachine_identityKeys(this.__wbg_ptr);return ht.__wrap(e)}get displayName(){return _.olmmachine_displayName(this.__wbg_ptr)}get roomKeyRequestsEnabled(){return 0!==_.olmmachine_roomKeyRequestsEnabled(this.__wbg_ptr)}set roomKeyRequestsEnabled(e){_.olmmachine_set_roomKeyRequestsEnabled(this.__wbg_ptr,e)}get roomKeyForwardingEnabled(){return 0!==_.olmmachine_roomKeyForwardingEnabled(this.__wbg_ptr)}set roomKeyForwardingEnabled(e){_.olmmachine_set_roomKeyForwardingEnabled(this.__wbg_ptr,e)}trackedUsers(){const e=_.olmmachine_trackedUsers(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}updateTrackedUsers(e){const t=A(e,_.__wbindgen_malloc),r=a;return _.olmmachine_updateTrackedUsers(this.__wbg_ptr,t,r)}markAllTrackedUsersAsDirty(){return _.olmmachine_markAllTrackedUsersAsDirty(this.__wbg_ptr)}receiveSyncChanges(e,t,r,n){const i=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),s=a;O(t,$e);const o=_.olmmachine_receiveSyncChanges(this.__wbg_ptr,i,s,t.__wbg_ptr,r,v(n)?0:y(n));if(o[2])throw C(o[1]);return C(o[0])}outgoingRequests(){return _.olmmachine_outgoingRequests(this.__wbg_ptr)}markRequestAsSent(e,t,r){const n=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=a,s=l(r,_.__wbindgen_malloc,_.__wbindgen_realloc),o=a,c=_.olmmachine_markRequestAsSent(this.__wbg_ptr,n,i,t,s,o);if(c[2])throw C(c[1]);return C(c[0])}encryptRoomEvent(e,t,r){O(e,yr);const n=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),i=a,s=l(r,_.__wbindgen_malloc,_.__wbindgen_realloc),o=a,c=_.olmmachine_encryptRoomEvent(this.__wbg_ptr,e.__wbg_ptr,n,i,s,o);if(c[2])throw C(c[1]);return C(c[0])}decryptRoomEvent(e,t,r){const n=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=a;O(t,yr),O(r,Be);const s=_.olmmachine_decryptRoomEvent(this.__wbg_ptr,n,i,t.__wbg_ptr,r.__wbg_ptr);if(s[2])throw C(s[1]);return C(s[0])}getRoomEventEncryptionInfo(e,t){const r=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a;O(t,yr);const i=_.olmmachine_getRoomEventEncryptionInfo(this.__wbg_ptr,r,n,t.__wbg_ptr);if(i[2])throw C(i[1]);return C(i[0])}crossSigningStatus(){return _.olmmachine_crossSigningStatus(this.__wbg_ptr)}exportSecretsBundle(){return _.olmmachine_exportSecretsBundle(this.__wbg_ptr)}importSecretsBundle(e){O(e,qr);var t=e.__destroy_into_raw();return _.olmmachine_importSecretsBundle(this.__wbg_ptr,t)}exportCrossSigningKeys(){return _.olmmachine_exportCrossSigningKeys(this.__wbg_ptr)}importCrossSigningKeys(e,t,r){var n=v(e)?0:l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=a,s=v(t)?0:l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),o=a,c=v(r)?0:l(r,_.__wbindgen_malloc,_.__wbindgen_realloc),g=a;return _.olmmachine_importCrossSigningKeys(this.__wbg_ptr,n,i,s,o,c,g)}bootstrapCrossSigning(e){return _.olmmachine_bootstrapCrossSigning(this.__wbg_ptr,e)}getIdentity(e){return O(e,rn),_.olmmachine_getIdentity(this.__wbg_ptr,e.__wbg_ptr)}sign(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;return _.olmmachine_sign(this.__wbg_ptr,t,r)}invalidateGroupSession(e){return O(e,yr),_.olmmachine_invalidateGroupSession(this.__wbg_ptr,e.__wbg_ptr)}shareRoomKey(e,t,r){O(e,yr);const n=A(t,_.__wbindgen_malloc),i=a;return O(r,dt),_.olmmachine_shareRoomKey(this.__wbg_ptr,e.__wbg_ptr,n,i,r.__wbg_ptr)}queryKeysForUsers(e){const t=A(e,_.__wbindgen_malloc),r=a,n=_.olmmachine_queryKeysForUsers(this.__wbg_ptr,t,r);if(n[2])throw C(n[1]);return Ot.__wrap(n[0])}getMissingSessions(e){const t=A(e,_.__wbindgen_malloc),r=a;return _.olmmachine_getMissingSessions(this.__wbg_ptr,t,r)}getUserDevices(e,t){return O(e,rn),_.olmmachine_getUserDevices(this.__wbg_ptr,e.__wbg_ptr,!v(t),v(t)?0:t)}getDevice(e,t,r){return O(e,rn),O(t,Le),_.olmmachine_getDevice(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,!v(r),v(r)?0:r)}getVerification(e,t){O(e,rn);const r=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a,i=_.olmmachine_getVerification(this.__wbg_ptr,e.__wbg_ptr,r,n);if(i[2])throw C(i[1]);return C(i[0])}getVerificationRequest(e,t){O(e,rn);const r=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a,i=_.olmmachine_getVerificationRequest(this.__wbg_ptr,e.__wbg_ptr,r,n);return 0===i?void 0:sn.__wrap(i)}getVerificationRequests(e){return O(e,rn),_.olmmachine_getVerificationRequests(this.__wbg_ptr,e.__wbg_ptr)}receiveVerificationEvent(e,t){const r=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a;O(t,yr);const i=_.olmmachine_receiveVerificationEvent(this.__wbg_ptr,r,n,t.__wbg_ptr);if(i[2])throw C(i[1]);return C(i[0])}exportRoomKeys(e){return _.olmmachine_exportRoomKeys(this.__wbg_ptr,e)}importRoomKeys(e,t){const r=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a,i=_.olmmachine_importRoomKeys(this.__wbg_ptr,r,n,t);if(i[2])throw C(i[1]);return C(i[0])}importExportedRoomKeys(e,t){const r=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a,i=_.olmmachine_importExportedRoomKeys(this.__wbg_ptr,r,n,t);if(i[2])throw C(i[1]);return C(i[0])}importBackedUpRoomKeys(e,t,r){const n=l(r,_.__wbindgen_malloc,_.__wbindgen_realloc),i=a,s=_.olmmachine_importBackedUpRoomKeys(this.__wbg_ptr,e,v(t)?0:y(t),n,i);if(s[2])throw C(s[1]);return C(s[0])}saveBackupDecryptionKey(e,t){O(e,_e);const r=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a;return _.olmmachine_saveBackupDecryptionKey(this.__wbg_ptr,e.__wbg_ptr,r,n)}getBackupKeys(){return _.olmmachine_getBackupKeys(this.__wbg_ptr)}verifyBackup(e){const t=_.olmmachine_verifyBackup(this.__wbg_ptr,e);if(t[2])throw C(t[1]);return C(t[0])}enableBackupV1(e,t){const r=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a,i=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),s=a,o=_.olmmachine_enableBackupV1(this.__wbg_ptr,r,n,i,s);if(o[2])throw C(o[1]);return C(o[0])}isBackupEnabled(){return _.olmmachine_isBackupEnabled(this.__wbg_ptr)}disableBackup(){return _.olmmachine_disableBackup(this.__wbg_ptr)}backupRoomKeys(){return _.olmmachine_backupRoomKeys(this.__wbg_ptr)}roomKeyCounts(){return _.olmmachine_roomKeyCounts(this.__wbg_ptr)}static encryptExportedRoomKeys(e,t,r){let n,i;try{const c=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),g=a,u=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),d=a,p=_.olmmachine_encryptExportedRoomKeys(c,g,u,d,r);var s=p[0],o=p[1];if(p[3])throw s=0,o=0,C(p[2]);return n=s,i=o,f(s,o)}finally{_.__wbindgen_free(n,i,1)}}static decryptExportedRoomKeys(e,t){let r,n;try{const o=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),c=a,g=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),u=a,d=_.olmmachine_decryptExportedRoomKeys(o,c,g,u);var i=d[0],s=d[1];if(d[3])throw i=0,s=0,C(d[2]);return r=i,n=s,f(i,s)}finally{_.__wbindgen_free(r,n,1)}}registerRoomKeyUpdatedCallback(e){return _.olmmachine_registerRoomKeyUpdatedCallback(this.__wbg_ptr,e)}registerRoomKeysWithheldCallback(e){return _.olmmachine_registerRoomKeysWithheldCallback(this.__wbg_ptr,e)}registerUserIdentityUpdatedCallback(e){return _.olmmachine_registerUserIdentityUpdatedCallback(this.__wbg_ptr,e)}registerDevicesUpdatedCallback(e){return _.olmmachine_registerDevicesUpdatedCallback(this.__wbg_ptr,e)}registerReceiveSecretCallback(e){return _.olmmachine_registerReceiveSecretCallback(this.__wbg_ptr,e)}getSecretsFromInbox(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;return _.olmmachine_getSecretsFromInbox(this.__wbg_ptr,t,r)}deleteSecretsFromInbox(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;return _.olmmachine_deleteSecretsFromInbox(this.__wbg_ptr,t,r)}requestMissingSecretsIfNeeded(){return _.olmmachine_requestMissingSecretsIfNeeded(this.__wbg_ptr)}getRoomSettings(e){return O(e,yr),_.olmmachine_getRoomSettings(this.__wbg_ptr,e.__wbg_ptr)}setRoomSettings(e,t){return O(e,yr),O(t,Or),_.olmmachine_setRoomSettings(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr)}dehydratedDevices(){const e=_.olmmachine_dehydratedDevices(this.__wbg_ptr);return Ne.__wrap(e)}close(){const e=this.__destroy_into_raw();_.olmmachine_close(e)}}const xt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_otheruseridentity_free(e>>>0,1)));class zt{static __wrap(e){e>>>=0;const t=Object.create(zt.prototype);return t.__wbg_ptr=e,xt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_otheruseridentity_free(e,0)}isVerified(){return 0!==_.otheruseridentity_isVerified(this.__wbg_ptr)}verify(){return _.otheruseridentity_verify(this.__wbg_ptr)}requestVerification(e,t,r){O(e,yr),O(t,yt);var n=v(r)?0:A(r,_.__wbindgen_malloc),i=a;const s=_.otheruseridentity_requestVerification(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,n,i);if(s[2])throw C(s[1]);return sn.__wrap(s[0])}verificationRequestContent(e){let t,r;try{var n=v(e)?0:A(e,_.__wbindgen_malloc),i=a;const c=_.otheruseridentity_verificationRequestContent(this.__wbg_ptr,n,i);var s=c[0],o=c[1];if(c[3])throw s=0,o=0,C(c[2]);return t=s,r=o,f(s,o)}finally{_.__wbindgen_free(t,r,1)}}get masterKey(){let e,t;try{const i=_.otheruseridentity_masterKey(this.__wbg_ptr);var r=i[0],n=i[1];if(i[3])throw r=0,n=0,C(i[2]);return e=r,t=n,f(r,n)}finally{_.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const i=_.otheruseridentity_selfSigningKey(this.__wbg_ptr);var r=i[0],n=i[1];if(i[3])throw r=0,n=0,C(i[2]);return e=r,t=n,f(r,n)}finally{_.__wbindgen_free(e,t,1)}}pinCurrentMasterKey(){return _.otheruseridentity_pinCurrentMasterKey(this.__wbg_ptr)}identityNeedsUserApproval(){return 0!==_.otheruseridentity_identityNeedsUserApproval(this.__wbg_ptr)}wasPreviouslyVerified(){return 0!==_.otheruseridentity_wasPreviouslyVerified(this.__wbg_ptr)}withdrawVerification(){return _.otheruseridentity_withdrawVerification(this.__wbg_ptr)}hasVerificationViolation(){return 0!==_.otheruseridentity_hasVerificationViolation(this.__wbg_ptr)}}const jt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_outboundcreationresult_free(e>>>0,1)));class Lt{static __wrap(e){e>>>=0;const t=Object.create(Lt.prototype);return t.__wbg_ptr=e,jt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,jt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_outboundcreationresult_free(e,0)}get channel(){const e=_.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return pt.__wrap(e)}set channel(e){O(e,pt);var t=e.__destroy_into_raw();_.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get initial_message(){let e,t;try{const r=_.__wbg_get_outboundcreationresult_initial_message(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set initial_message(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}}const Wt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_ownuseridentity_free(e>>>0,1)));class Gt{static __wrap(e){e>>>=0;const t=Object.create(Gt.prototype);return t.__wbg_ptr=e,Wt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Wt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_ownuseridentity_free(e,0)}isVerified(){return 0!==_.ownuseridentity_isVerified(this.__wbg_ptr)}verify(){return _.ownuseridentity_verify(this.__wbg_ptr)}requestVerification(e){var t=v(e)?0:A(e,_.__wbindgen_malloc),r=a;const n=_.ownuseridentity_requestVerification(this.__wbg_ptr,t,r);if(n[2])throw C(n[1]);return C(n[0])}trustsOurOwnDevice(){return _.ownuseridentity_trustsOurOwnDevice(this.__wbg_ptr)}get masterKey(){let e,t;try{const i=_.ownuseridentity_masterKey(this.__wbg_ptr);var r=i[0],n=i[1];if(i[3])throw r=0,n=0,C(i[2]);return e=r,t=n,f(r,n)}finally{_.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const i=_.ownuseridentity_selfSigningKey(this.__wbg_ptr);var r=i[0],n=i[1];if(i[3])throw r=0,n=0,C(i[2]);return e=r,t=n,f(r,n)}finally{_.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const i=_.ownuseridentity_userSigningKey(this.__wbg_ptr);var r=i[0],n=i[1];if(i[3])throw r=0,n=0,C(i[2]);return e=r,t=n,f(r,n)}finally{_.__wbindgen_free(e,t,1)}}wasPreviouslyVerified(){return 0!==_.ownuseridentity_wasPreviouslyVerified(this.__wbg_ptr)}withdrawVerification(){return _.ownuseridentity_withdrawVerification(this.__wbg_ptr)}hasVerificationViolation(){return 0!==_.ownuseridentity_hasVerificationViolation(this.__wbg_ptr)}}const Qt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_pickledinboundgroupsession_free(e>>>0,1)));class Jt{static __unwrap(e){return e instanceof Jt?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Qt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_pickledinboundgroupsession_free(e,0)}get pickle(){let e,t;try{const r=_.__wbg_get_pickledinboundgroupsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set pickle(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=_.__wbg_get_pickledinboundgroupsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set senderKey(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get senderSigningKey(){const e=_.__wbg_get_pickledinboundgroupsession_senderSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set senderSigningKey(e){var t=v(e)?0:l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get roomId(){const e=_.__wbg_get_pickledinboundgroupsession_roomId(this.__wbg_ptr);return 0===e?void 0:yr.__wrap(e)}set roomId(e){let t=0;v(e)||(O(e,yr),t=e.__destroy_into_raw()),_.__wbg_set_pickledinboundgroupsession_roomId(this.__wbg_ptr,t)}get imported(){return 0!==_.__wbg_get_pickledinboundgroupsession_imported(this.__wbg_ptr)}set imported(e){_.__wbg_set_pickledinboundgroupsession_imported(this.__wbg_ptr,e)}get backedUp(){return 0!==_.__wbg_get_pickledinboundgroupsession_backedUp(this.__wbg_ptr)}set backedUp(e){_.__wbg_set_pickledinboundgroupsession_backedUp(this.__wbg_ptr,e)}constructor(){const e=_.pickledinboundgroupsession_new();return this.__wbg_ptr=e>>>0,Qt.register(this,this.__wbg_ptr,this),this}}const Ht="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_pickledsession_free(e>>>0,1)));class Yt{static __unwrap(e){return e instanceof Yt?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ht.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_pickledsession_free(e,0)}get pickle(){let e,t;try{const r=_.__wbg_get_pickledsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set pickle(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=_.__wbg_get_pickledsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set senderKey(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;_.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get createdUsingFallbackKey(){return 0!==_.__wbg_get_pickledsession_createdUsingFallbackKey(this.__wbg_ptr)}set createdUsingFallbackKey(e){_.__wbg_set_pickledsession_createdUsingFallbackKey(this.__wbg_ptr,e)}get creationTime(){return _.__wbg_get_pickledsession_creationTime(this.__wbg_ptr)}set creationTime(e){_.__wbg_set_pickledsession_creationTime(this.__wbg_ptr,e)}get lastUseTime(){return _.__wbg_get_pickledsession_lastUseTime(this.__wbg_ptr)}set lastUseTime(e){_.__wbg_set_pickledsession_lastUseTime(this.__wbg_ptr,e)}constructor(){const e=_.pickledsession_new();return this.__wbg_ptr=e>>>0,Ht.register(this,this.__wbg_ptr,this),this}}const Xt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_pkdecryption_free(e>>>0,1)));class $t{static __wrap(e){e>>>=0;const t=Object.create($t.prototype);return t.__wbg_ptr=e,Xt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Xt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_pkdecryption_free(e,0)}constructor(){const e=_.pkdecryption_new();return this.__wbg_ptr=e>>>0,Xt.register(this,this.__wbg_ptr,this),this}static fromKey(e){O(e,Me);const t=_.pkdecryption_fromKey(e.__wbg_ptr);return $t.__wrap(t)}secretKey(){const e=_.pkdecryption_secretKey(this.__wbg_ptr);return Me.__wrap(e)}publicKey(){const e=_.pkdecryption_publicKey(this.__wbg_ptr);return Oe.__wrap(e)}decryptString(e){let t,r;try{O(e,rr);const s=_.pkdecryption_decryptString(this.__wbg_ptr,e.__wbg_ptr);var n=s[0],i=s[1];if(s[3])throw n=0,i=0,C(s[2]);return t=n,r=i,f(n,i)}finally{_.__wbindgen_free(t,r,1)}}decrypt(e){O(e,rr);const t=_.pkdecryption_decrypt(this.__wbg_ptr,e.__wbg_ptr);if(t[3])throw C(t[2]);var r=m(t[0],t[1]).slice();return _.__wbindgen_free(t[0],1*t[1],1),r}}const Zt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_pkencryption_free(e>>>0,1)));class er{static __wrap(e){e>>>=0;const t=Object.create(er.prototype);return t.__wbg_ptr=e,Zt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Zt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_pkencryption_free(e,0)}static fromKey(e){O(e,Oe);const t=_.pkencryption_fromKey(e.__wbg_ptr);return er.__wrap(t)}encrypt(e){const t=I(e,_.__wbindgen_malloc),r=a,n=_.pkencryption_encrypt(this.__wbg_ptr,t,r);return rr.__wrap(n)}encryptString(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.pkencryption_encrypt(this.__wbg_ptr,t,r);return rr.__wrap(n)}}const tr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_pkmessage_free(e>>>0,1)));class rr{static __wrap(e){e>>>=0;const t=Object.create(rr.prototype);return t.__wbg_ptr=e,tr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,tr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_pkmessage_free(e,0)}ciphertext(){const e=_.pkmessage_ciphertext(this.__wbg_ptr);var t=m(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}mac(){const e=_.pkmessage_mac(this.__wbg_ptr);var t=m(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}ephemeralKey(){const e=_.pkmessage_ephemeralKey(this.__wbg_ptr);return Oe.__wrap(e)}static fromParts(e,t,r){const n=I(e,_.__wbindgen_malloc),i=a,s=I(t,_.__wbindgen_malloc),o=a;O(r,Oe);const c=_.pkmessage_fromParts(n,i,s,o,r.__wbg_ptr);return rr.__wrap(c)}static fromBase64(e){O(e,de);const t=_.pkmessage_fromBase64(e.__wbg_ptr);if(t[2])throw C(t[1]);return rr.__wrap(t[0])}toBase64(){const e=_.pkmessage_toBase64(this.__wbg_ptr);return de.__wrap(e)}}const nr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_putdehydrateddevicerequest_free(e>>>0,1)));class ir{static __wrap(e){e>>>=0;const t=Object.create(ir.prototype);return t.__wbg_ptr=e,nr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,nr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_putdehydrateddevicerequest_free(e,0)}get body(){return _.__wbg_get_putdehydrateddevicerequest_body(this.__wbg_ptr)}constructor(e){const t=_.putdehydrateddevicerequest_new(e);return this.__wbg_ptr=t>>>0,nr.register(this,this.__wbg_ptr,this),this}}const sr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_qr_free(e>>>0,1)));class _r{static __wrap(e){e>>>=0;const t=Object.create(_r.prototype);return t.__wbg_ptr=e,sr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,sr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_qr_free(e,0)}state(){return _.qr_state(this.__wbg_ptr)}hasBeenScanned(){return 0!==_.qr_hasBeenScanned(this.__wbg_ptr)}hasBeenConfirmed(){return 0!==_.qr_hasBeenConfirmed(this.__wbg_ptr)}get userId(){const e=_.qr_userId(this.__wbg_ptr);return rn.__wrap(e)}get otherUserId(){const e=_.qr_otherUserId(this.__wbg_ptr);return rn.__wrap(e)}get otherDeviceId(){const e=_.qr_otherDeviceId(this.__wbg_ptr);return Le.__wrap(e)}weStarted(){return 0!==_.qr_weStarted(this.__wbg_ptr)}cancelInfo(){const e=_.qr_cancelInfo(this.__wbg_ptr);return 0===e?void 0:ye.__wrap(e)}isDone(){return 0!==_.qr_isDone(this.__wbg_ptr)}isCancelled(){return 0!==_.qr_isCancelled(this.__wbg_ptr)}isSelfVerification(){return 0!==_.qr_isSelfVerification(this.__wbg_ptr)}reciprocated(){return 0!==_.qr_reciprocated(this.__wbg_ptr)}get flowId(){let e,t;try{const r=_.qr_flowId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get roomId(){const e=_.qr_roomId(this.__wbg_ptr);return 0===e?void 0:yr.__wrap(e)}toQrCode(){const e=_.qr_toQrCode(this.__wbg_ptr);if(e[2])throw C(e[1]);return ar.__wrap(e[0])}toBytes(){const e=_.qr_toBytes(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}reciprocate(){const e=_.qr_reciprocate(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}confirmScanning(){const e=_.qr_confirmScanning(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}cancel(){const e=_.qr_cancel(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}cancelWithCode(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.qr_cancelWithCode(this.__wbg_ptr,t,r);if(n[2])throw C(n[1]);return C(n[0])}registerChangesCallback(e){_.qr_registerChangesCallback(this.__wbg_ptr,e)}}const or="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_qrcode_free(e>>>0,1)));class ar{static __wrap(e){e>>>=0;const t=Object.create(ar.prototype);return t.__wbg_ptr=e,or.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,or.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_qrcode_free(e,0)}renderIntoBuffer(){const e=_.qrcode_renderIntoBuffer(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}}const cr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_qrcodedata_free(e>>>0,1)));class gr{static __wrap(e){e>>>=0;const t=Object.create(gr.prototype);return t.__wbg_ptr=e,cr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,cr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_qrcodedata_free(e,0)}constructor(e,t,r){O(e,Oe);var n=e.__destroy_into_raw();const i=l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),s=a;var o=v(r)?0:l(r,_.__wbindgen_malloc,_.__wbindgen_realloc),c=a;const g=_.qrcodedata_new(n,i,s,o,c);if(g[2])throw C(g[1]);return this.__wbg_ptr=g[0]>>>0,cr.register(this,this.__wbg_ptr,this),this}static fromBytes(e){const t=I(e,_.__wbindgen_malloc),r=a,n=_.qrcodedata_fromBytes(t,r);if(n[2])throw C(n[1]);return gr.__wrap(n[0])}toBytes(){const e=_.qrcodedata_toBytes(this.__wbg_ptr);var t=m(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}static fromBase64(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.qrcodedata_fromBase64(t,r);if(n[2])throw C(n[1]);return gr.__wrap(n[0])}toBase64(){let e,t;try{const r=_.qrcodedata_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get publicKey(){const e=_.qrcodedata_publicKey(this.__wbg_ptr);return Oe.__wrap(e)}get rendezvousUrl(){let e,t;try{const r=_.qrcodedata_rendezvousUrl(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get serverName(){const e=_.qrcodedata_serverName(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}get mode(){return _.qrcodedata_mode(this.__wbg_ptr)}}const ur="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_qrcodescan_free(e>>>0,1)));class dr{static __wrap(e){e>>>=0;const t=Object.create(dr.prototype);return t.__wbg_ptr=e,ur.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ur.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_qrcodescan_free(e,0)}static fromBytes(e){const t=_.qrcodescan_fromBytes(e);if(t[2])throw C(t[1]);return dr.__wrap(t[0])}}const lr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_rehydrateddevice_free(e>>>0,1)));class pr{static __wrap(e){e>>>=0;const t=Object.create(pr.prototype);return t.__wbg_ptr=e,lr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,lr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_rehydrateddevice_free(e,0)}receiveEvents(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a;return _.rehydrateddevice_receiveEvents(this.__wbg_ptr,t,r)}}const wr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_roomid_free(e>>>0,1)));class yr{static __wrap(e){e>>>=0;const t=Object.create(yr.prototype);return t.__wbg_ptr=e,wr.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof yr?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,wr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomid_free(e,0)}constructor(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.roomid_new(t,r);if(n[2])throw C(n[1]);return this.__wbg_ptr=n[0]>>>0,wr.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=_.roomid_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const br="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_roomkeycounts_free(e>>>0,1)));class hr{static __wrap(e){e>>>=0;const t=Object.create(hr.prototype);return t.__wbg_ptr=e,br.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,br.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomkeycounts_free(e,0)}get total(){return _.__wbg_get_roomkeycounts_total(this.__wbg_ptr)}set total(e){_.__wbg_set_roomkeycounts_total(this.__wbg_ptr,e)}get backedUp(){return _.__wbg_get_roomkeycounts_backedUp(this.__wbg_ptr)}set backedUp(e){_.__wbg_set_roomkeycounts_backedUp(this.__wbg_ptr,e)}}const fr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_roomkeyimportresult_free(e>>>0,1)));class vr{static __wrap(e){e>>>=0;const t=Object.create(vr.prototype);return t.__wbg_ptr=e,fr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,fr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomkeyimportresult_free(e,0)}get importedCount(){return _.__wbg_get_roomkeyimportresult_importedCount(this.__wbg_ptr)>>>0}get totalCount(){return _.__wbg_get_roomkeyimportresult_totalCount(this.__wbg_ptr)>>>0}keys(){return _.roomkeyimportresult_keys(this.__wbg_ptr)}}const mr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_roomkeyinfo_free(e>>>0,1)));class kr{static __wrap(e){e>>>=0;const t=Object.create(kr.prototype);return t.__wbg_ptr=e,mr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,mr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomkeyinfo_free(e,0)}get algorithm(){return _.roomkeyinfo_algorithm(this.__wbg_ptr)}get roomId(){const e=_.roomkeyinfo_roomId(this.__wbg_ptr);return yr.__wrap(e)}get senderKey(){const e=_.roomkeyinfo_senderKey(this.__wbg_ptr);return Oe.__wrap(e)}get sessionId(){let e,t;try{const r=_.roomkeyinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Sr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_roomkeywithheldinfo_free(e>>>0,1)));class Rr{static __wrap(e){e>>>=0;const t=Object.create(Rr.prototype);return t.__wbg_ptr=e,Sr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Sr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomkeywithheldinfo_free(e,0)}get sender(){const e=_.roomkeywithheldinfo_sender(this.__wbg_ptr);return rn.__wrap(e)}get algorithm(){return _.roomkeywithheldinfo_algorithm(this.__wbg_ptr)}get withheldCode(){let e,t;try{const r=_.roomkeywithheldinfo_withheldCode(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get roomId(){const e=_.roomkeywithheldinfo_roomId(this.__wbg_ptr);return yr.__wrap(e)}get sessionId(){let e,t;try{const r=_.roomkeywithheldinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Kr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_roommessagerequest_free(e>>>0,1)));class Ir{static __wrap(e){e>>>=0;const t=Object.create(Ir.prototype);return t.__wbg_ptr=e,Kr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Kr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roommessagerequest_free(e,0)}get id(){return _.__wbg_get_roommessagerequest_id(this.__wbg_ptr)}get room_id(){return _.__wbg_get_roommessagerequest_room_id(this.__wbg_ptr)}get txn_id(){return _.__wbg_get_roommessagerequest_txn_id(this.__wbg_ptr)}get event_type(){return _.__wbg_get_roommessagerequest_event_type(this.__wbg_ptr)}get body(){return _.__wbg_get_roommessagerequest_body(this.__wbg_ptr)}constructor(e,t,r,n,i){const s=_.roommessagerequest_new(e,t,r,n,i);return this.__wbg_ptr=s>>>0,Kr.register(this,this.__wbg_ptr,this),this}get type(){return _.roommessagerequest_type(this.__wbg_ptr)}}const Cr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_roomsettings_free(e>>>0,1)));class Or{static __wrap(e){e>>>=0;const t=Object.create(Or.prototype);return t.__wbg_ptr=e,Cr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Cr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomsettings_free(e,0)}get algorithm(){return _.__wbg_get_roomsettings_algorithm(this.__wbg_ptr)}set algorithm(e){_.__wbg_set_roomsettings_algorithm(this.__wbg_ptr,e)}get onlyAllowTrustedDevices(){return 0!==_.__wbg_get_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr)}set onlyAllowTrustedDevices(e){_.__wbg_set_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr,e)}get sessionRotationPeriodMs(){const e=_.__wbg_get_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}set sessionRotationPeriodMs(e){_.__wbg_set_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr,!v(e),v(e)?0:e)}get sessionRotationPeriodMessages(){const e=_.__wbg_get_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}set sessionRotationPeriodMessages(e){_.__wbg_set_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr,!v(e),v(e)?0:e)}constructor(){const e=_.roomsettings_new();return this.__wbg_ptr=e>>>0,Cr.register(this,this.__wbg_ptr,this),this}}const Ar="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_sas_free(e>>>0,1)));class Mr{static __wrap(e){e>>>=0;const t=Object.create(Mr.prototype);return t.__wbg_ptr=e,Ar.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ar.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_sas_free(e,0)}get userId(){const e=_.sas_userId(this.__wbg_ptr);return rn.__wrap(e)}get deviceId(){const e=_.sas_deviceId(this.__wbg_ptr);return Le.__wrap(e)}get otherUserId(){const e=_.sas_otherUserId(this.__wbg_ptr);return rn.__wrap(e)}get otherDeviceId(){const e=_.sas_otherDeviceId(this.__wbg_ptr);return Le.__wrap(e)}get flowId(){let e,t;try{const r=_.sas_flowId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get roomId(){const e=_.sas_roomId(this.__wbg_ptr);return 0===e?void 0:yr.__wrap(e)}supportsEmoji(){return 0!==_.sas_supportsEmoji(this.__wbg_ptr)}startedFromRequest(){return 0!==_.sas_startedFromRequest(this.__wbg_ptr)}isSelfVerification(){return 0!==_.sas_isSelfVerification(this.__wbg_ptr)}haveWeConfirmed(){return 0!==_.sas_haveWeConfirmed(this.__wbg_ptr)}hasBeenAccepted(){return 0!==_.sas_hasBeenAccepted(this.__wbg_ptr)}cancelInfo(){const e=_.sas_cancelInfo(this.__wbg_ptr);return 0===e?void 0:ye.__wrap(e)}weStarted(){return 0!==_.sas_weStarted(this.__wbg_ptr)}accept(){const e=_.sas_accept(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}confirm(){return _.sas_confirm(this.__wbg_ptr)}cancel(){const e=_.sas_cancel(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}cancelWithCode(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.sas_cancelWithCode(this.__wbg_ptr,t,r);if(n[2])throw C(n[1]);return C(n[0])}timedOut(){return 0!==_.sas_timedOut(this.__wbg_ptr)}canBePresented(){return 0!==_.sas_canBePresented(this.__wbg_ptr)}isDone(){return 0!==_.sas_isDone(this.__wbg_ptr)}isCancelled(){return 0!==_.sas_isCancelled(this.__wbg_ptr)}emoji(){const e=_.sas_emoji(this.__wbg_ptr);let t;return 0!==e[0]&&(t=M(e[0],e[1]).slice(),_.__wbindgen_free(e[0],4*e[1],4)),t}emojiIndex(){const e=_.sas_emojiIndex(this.__wbg_ptr);let t;return 0!==e[0]&&(t=m(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}decimals(){const e=_.sas_decimals(this.__wbg_ptr);let t;return 0!==e[0]&&(t=(r=e[0],n=e[1],r>>>=0,(null!==E&&0!==E.byteLength||(E=new Uint16Array(_.memory.buffer)),E).subarray(r/2,r/2+n)).slice(),_.__wbindgen_free(e[0],2*e[1],2)),t;var r,n}registerChangesCallback(e){_.sas_registerChangesCallback(this.__wbg_ptr,e)}}const Er="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_secretsbundle_free(e>>>0,1)));class qr{static __wrap(e){e>>>=0;const t=Object.create(qr.prototype);return t.__wbg_ptr=e,Er.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Er.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_secretsbundle_free(e,0)}get masterKey(){let e,t;try{const r=_.secretsbundle_masterKey(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const r=_.secretsbundle_selfSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const r=_.secretsbundle_userSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get backupBundle(){const e=_.secretsbundle_backupBundle(this.__wbg_ptr);return 0===e?void 0:ge.__wrap(e)}to_json(){const e=_.secretsbundle_to_json(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}static from_json(e){const t=_.secretsbundle_from_json(e);if(t[2])throw C(t[1]);return qr.__wrap(t[0])}}const Dr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_servername_free(e>>>0,1)));class Br{static __wrap(e){e>>>=0;const t=Object.create(Br.prototype);return t.__wbg_ptr=e,Dr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Dr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_servername_free(e,0)}constructor(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.servername_new(t,r);if(n[2])throw C(n[1]);return this.__wbg_ptr=n[0]>>>0,Dr.register(this,this.__wbg_ptr,this),this}get host(){let e,t;try{const r=_.servername_host(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get port(){const e=_.servername_port(this.__wbg_ptr);return 16777215===e?void 0:e}isIpLiteral(){return 0!==_.servername_isIpLiteral(this.__wbg_ptr)}}const Tr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_shieldstate_free(e>>>0,1)));class Vr{static __wrap(e){e>>>=0;const t=Object.create(Vr.prototype);return t.__wbg_ptr=e,Tr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Tr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_shieldstate_free(e,0)}get color(){return _.__wbg_get_shieldstate_color(this.__wbg_ptr)}set color(e){_.__wbg_set_shieldstate_color(this.__wbg_ptr,e)}get code(){const e=_.__wbg_get_shieldstate_code(this.__wbg_ptr);return 6===e?void 0:e}set code(e){_.__wbg_set_shieldstate_code(this.__wbg_ptr,v(e)?6:e)}get message(){const e=_.shieldstate_message(this.__wbg_ptr);let t;return 0!==e[0]&&(t=f(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}}const Fr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_signature_free(e>>>0,1)));class Ur{static __wrap(e){e>>>=0;const t=Object.create(Ur.prototype);return t.__wbg_ptr=e,Fr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Fr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_signature_free(e,0)}get ed25519(){const e=_.signature_ed25519(this.__wbg_ptr);return 0===e?void 0:it.__wrap(e)}toBase64(){let e,t;try{const r=_.signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Pr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_signatureuploadrequest_free(e>>>0,1)));class Nr{static __wrap(e){e>>>=0;const t=Object.create(Nr.prototype);return t.__wbg_ptr=e,Pr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Pr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_signatureuploadrequest_free(e,0)}get id(){return _.__wbg_get_signatureuploadrequest_id(this.__wbg_ptr)}get body(){return _.__wbg_get_signatureuploadrequest_body(this.__wbg_ptr)}constructor(e,t){const r=_.signatureuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,Pr.register(this,this.__wbg_ptr,this),this}get type(){return _.signatureuploadrequest_type(this.__wbg_ptr)}}const xr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_signatureverification_free(e>>>0,1)));class zr{static __wrap(e){e>>>=0;const t=Object.create(zr.prototype);return t.__wbg_ptr=e,xr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_signatureverification_free(e,0)}get deviceState(){return _.signatureverification_deviceState(this.__wbg_ptr)}get userState(){return _.signatureverification_userState(this.__wbg_ptr)}trusted(){return 0!==_.signatureverification_trusted(this.__wbg_ptr)}}const jr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_signatures_free(e>>>0,1)));class Lr{static __wrap(e){e>>>=0;const t=Object.create(Lr.prototype);return t.__wbg_ptr=e,jr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,jr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_signatures_free(e,0)}constructor(){const e=_.signatures_new();return this.__wbg_ptr=e>>>0,jr.register(this,this.__wbg_ptr,this),this}addSignature(e,t,r){O(e,rn),O(t,Ye),O(r,it);const n=_.signatures_addSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr);return 0===n?void 0:qt.__wrap(n)}getSignature(e,t){O(e,rn),O(t,Ye);const r=_.signatures_getSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr);return 0===r?void 0:it.__wrap(r)}get(e){return O(e,rn),_.signatures_get(this.__wbg_ptr,e.__wbg_ptr)}clear(){_.signatures_clear(this.__wbg_ptr)}isEmpty(){return 0!==_.signatures_isEmpty(this.__wbg_ptr)}get count(){return _.signatures_count(this.__wbg_ptr)>>>0}asJSON(){const e=_.signatures_asJSON(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}}const Wr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_storehandle_free(e>>>0,1)));class Gr{static __wrap(e){e>>>=0;const t=Object.create(Gr.prototype);return t.__wbg_ptr=e,Wr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Wr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_storehandle_free(e,0)}static open(e,t){var r=v(e)?0:l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a,i=v(t)?0:l(t,_.__wbindgen_malloc,_.__wbindgen_realloc),s=a;return _.storehandle_open(r,n,i,s)}static openWithKey(e,t){const r=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a,i=I(t,_.__wbindgen_malloc),s=a;return _.storehandle_openWithKey(r,n,i,s)}}const Qr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_todevicerequest_free(e>>>0,1)));class Jr{static __wrap(e){e>>>=0;const t=Object.create(Jr.prototype);return t.__wbg_ptr=e,Qr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Qr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_todevicerequest_free(e,0)}get id(){return _.__wbg_get_todevicerequest_id(this.__wbg_ptr)}get event_type(){return _.__wbg_get_todevicerequest_event_type(this.__wbg_ptr)}get txn_id(){return _.__wbg_get_todevicerequest_txn_id(this.__wbg_ptr)}get body(){return _.__wbg_get_todevicerequest_body(this.__wbg_ptr)}constructor(e,t,r,n){const i=_.todevicerequest_new(e,t,r,n);return this.__wbg_ptr=i>>>0,Qr.register(this,this.__wbg_ptr,this),this}get type(){return _.todevicerequest_type(this.__wbg_ptr)}}const Hr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_tracing_free(e>>>0,1)));class Yr{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Hr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_tracing_free(e,0)}static isAvailable(){return 0!==_.tracing_isAvailable()}constructor(e){const t=_.tracing_new(e);if(t[2])throw C(t[1]);return this.__wbg_ptr=t[0]>>>0,Hr.register(this,this.__wbg_ptr,this),this}set minLevel(e){const t=_.tracing_set_minLevel(this.__wbg_ptr,e);if(t[1])throw C(t[0])}turnOn(){const e=_.tracing_turnOn(this.__wbg_ptr);if(e[1])throw C(e[0])}turnOff(){const e=_.tracing_turnOff(this.__wbg_ptr);if(e[1])throw C(e[0])}}const Xr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_uploadsigningkeysrequest_free(e>>>0,1)));class $r{static __wrap(e){e>>>=0;const t=Object.create($r.prototype);return t.__wbg_ptr=e,Xr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Xr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_uploadsigningkeysrequest_free(e,0)}get body(){return _.__wbg_get_uploadsigningkeysrequest_body(this.__wbg_ptr)}constructor(e){const t=_.uploadsigningkeysrequest_new(e);return this.__wbg_ptr=t>>>0,Xr.register(this,this.__wbg_ptr,this),this}}const Zr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_userdevices_free(e>>>0,1)));class en{static __wrap(e){e>>>=0;const t=Object.create(en.prototype);return t.__wbg_ptr=e,Zr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Zr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_userdevices_free(e,0)}get(e){O(e,Le);const t=_.userdevices_get(this.__wbg_ptr,e.__wbg_ptr);return 0===t?void 0:ze.__wrap(t)}isAnyVerified(){return 0!==_.userdevices_isAnyVerified(this.__wbg_ptr)}keys(){return _.userdevices_keys(this.__wbg_ptr)}devices(){return _.userdevices_devices(this.__wbg_ptr)}}const tn="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_userid_free(e>>>0,1)));class rn{static __wrap(e){e>>>=0;const t=Object.create(rn.prototype);return t.__wbg_ptr=e,tn.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof rn?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,tn.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_userid_free(e,0)}constructor(e){const t=l(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=a,n=_.userid_new(t,r);if(n[2])throw C(n[1]);return this.__wbg_ptr=n[0]>>>0,tn.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=_.userid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get serverName(){const e=_.userid_serverName(this.__wbg_ptr);return Br.__wrap(e)}isHistorical(){return 0!==_.userid_isHistorical(this.__wbg_ptr)}toString(){let e,t;try{const r=_.userid_toString(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}clone(){const e=_.userid_clone(this.__wbg_ptr);return rn.__wrap(e)}}const nn="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_verificationrequest_free(e>>>0,1)));class sn{static __wrap(e){e>>>=0;const t=Object.create(sn.prototype);return t.__wbg_ptr=e,nn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,nn.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_verificationrequest_free(e,0)}static request(e,t,r,n){let i,s;try{O(e,rn),O(t,Le),O(r,rn);var o=v(n)?0:A(n,_.__wbindgen_malloc),c=a;const d=_.verificationrequest_request(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr,o,c);var g=d[0],u=d[1];if(d[3])throw g=0,u=0,C(d[2]);return i=g,s=u,f(g,u)}finally{_.__wbindgen_free(i,s,1)}}get ownUserId(){const e=_.verificationrequest_ownUserId(this.__wbg_ptr);return rn.__wrap(e)}get otherUserId(){const e=_.verificationrequest_otherUserId(this.__wbg_ptr);return rn.__wrap(e)}get otherDeviceId(){const e=_.verificationrequest_otherDeviceId(this.__wbg_ptr);return 0===e?void 0:Le.__wrap(e)}get roomId(){const e=_.verificationrequest_roomId(this.__wbg_ptr);return 0===e?void 0:yr.__wrap(e)}get cancelInfo(){const e=_.verificationrequest_cancelInfo(this.__wbg_ptr);return 0===e?void 0:ye.__wrap(e)}isPassive(){return 0!==_.verificationrequest_isPassive(this.__wbg_ptr)}isReady(){return 0!==_.verificationrequest_isReady(this.__wbg_ptr)}timedOut(){return 0!==_.verificationrequest_timedOut(this.__wbg_ptr)}timeRemainingMillis(){return _.verificationrequest_timeRemainingMillis(this.__wbg_ptr)}get theirSupportedMethods(){const e=_.verificationrequest_theirSupportedMethods(this.__wbg_ptr);if(e[3])throw C(e[2]);let t;return 0!==e[0]&&(t=M(e[0],e[1]).slice(),_.__wbindgen_free(e[0],4*e[1],4)),t}get ourSupportedMethods(){const e=_.verificationrequest_ourSupportedMethods(this.__wbg_ptr);if(e[3])throw C(e[2]);let t;return 0!==e[0]&&(t=M(e[0],e[1]).slice(),_.__wbindgen_free(e[0],4*e[1],4)),t}get flowId(){let e,t;try{const r=_.verificationrequest_flowId(this.__wbg_ptr);return e=r[0],t=r[1],f(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}isSelfVerification(){return 0!==_.verificationrequest_isSelfVerification(this.__wbg_ptr)}weStarted(){return 0!==_.verificationrequest_weStarted(this.__wbg_ptr)}isDone(){return 0!==_.verificationrequest_isDone(this.__wbg_ptr)}phase(){return _.verificationrequest_phase(this.__wbg_ptr)}getVerification(){return _.verificationrequest_getVerification(this.__wbg_ptr)}registerChangesCallback(e){_.verificationrequest_registerChangesCallback(this.__wbg_ptr,e)}isCancelled(){return 0!==_.verificationrequest_isCancelled(this.__wbg_ptr)}acceptWithMethods(e){const t=A(e,_.__wbindgen_malloc),r=a,n=_.verificationrequest_acceptWithMethods(this.__wbg_ptr,t,r);if(n[2])throw C(n[1]);return C(n[0])}accept(){const e=_.verificationrequest_accept(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}cancel(){const e=_.verificationrequest_cancel(this.__wbg_ptr);if(e[2])throw C(e[1]);return C(e[0])}startSas(){return _.verificationrequest_startSas(this.__wbg_ptr)}generateQrCode(){return _.verificationrequest_generateQrCode(this.__wbg_ptr)}scanQrCode(e){return O(e,dr),_.verificationrequest_scanQrCode(this.__wbg_ptr,e.__wbg_ptr)}}const _n="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>_.__wbg_versions_free(e>>>0,1)));class on{static __wrap(e){e>>>=0;const t=Object.create(on.prototype);return t.__wbg_ptr=e,_n.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,_n.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_versions_free(e,0)}get vodozemac(){return _.__wbg_get_versions_vodozemac(this.__wbg_ptr)}get matrix_sdk_crypto(){return _.__wbg_get_versions_matrix_sdk_crypto(this.__wbg_ptr)}get git_sha(){return _.__wbg_get_versions_git_sha(this.__wbg_ptr)}get git_description(){return _.__wbg_get_versions_git_description(this.__wbg_ptr)}}function an(e,t){const r=l(String(t),_.__wbindgen_malloc,_.__wbindgen_realloc),n=a;w().setInt32(e+4,n,!0),w().setInt32(e+0,r,!0)}function cn(e){return e.Window}function gn(e){return e.WorkerGlobalScope}function un(e,t){return e.add(t)}function dn(){return b((function(e,t,r){return e.add(t,r)}),arguments)}function ln(e,t){return e.at(t)}function pn(e){return ae.__wrap(e)}function wn(){return b((function(e,t){return IDBKeyRange.bound(e,t)}),arguments)}function yn(){return b((function(e,t,r,n){return IDBKeyRange.bound(e,t,0!==r,0!==n)}),arguments)}function bn(e){return e.buffer}function hn(){return b((function(e,t){return e.call(t)}),arguments)}function fn(){return b((function(e,t,r){return e.call(t,r)}),arguments)}function vn(){return b((function(e,t,r,n){return e.call(t,r,n)}),arguments)}function mn(){return b((function(e,t,r,n,i){return e.call(t,r,n,i)}),arguments)}function kn(e){return clearTimeout(e)}function Sn(){return b((function(e){return e.clear()}),arguments)}function Rn(e){e.close()}function Kn(e){return e.code}function In(){return b((function(e){e.continue()}),arguments)}function Cn(){return b((function(e){return e.count()}),arguments)}function On(){return b((function(e){return e.count()}),arguments)}function An(){return b((function(e,t,r,n,i){return e.createIndex(f(t,r),n,i)}),arguments)}function Mn(){return b((function(e,t,r,n){return e.createIndex(f(t,r),n)}),arguments)}function En(){return b((function(e,t,r){return e.createObjectStore(f(t,r))}),arguments)}function qn(e){return ke.__wrap(e)}function Dn(e){return Re.__wrap(e)}function Bn(e){return Ie.__wrap(e)}function Tn(e){return e.crypto}function Vn(e){console.debug(e)}function Fn(e,t){e.debug(t)}function Un(e){return qe.__wrap(e)}function Pn(e){return Ve.__wrap(e)}function Nn(e){return Ue.__wrap(e)}function xn(){return b((function(e,t,r){e.deleteObjectStore(f(t,r))}),arguments)}function zn(){return b((function(e,t){return e.delete(t)}),arguments)}function jn(){return b((function(e){return e.delete()}),arguments)}function Ln(e){return ze.__wrap(e)}function Wn(e){return Le.__wrap(e)}function Gn(e){return Ge.__wrap(e)}function Qn(e){return Ye.__wrap(e)}function Jn(e){return e.done}function Hn(e){return _t.__wrap(e)}function Yn(e){return gt.__wrap(e)}function Xn(e){return Object.entries(e)}function $n(e){return e.entries()}function Zn(e){console.error(e)}function ei(e,t){let r,n;try{r=e,n=t,console.error(f(e,t))}finally{_.__wbindgen_free(r,n,1)}}function ti(e,t){e.error(t)}function ri(){return b((function(e){const t=e.error;return v(t)?0:y(t)}),arguments)}function ni(e){return Array.from(e)}function ii(){return b((function(e){return e.getAllKeys()}),arguments)}function si(){return b((function(e){return e.getAll()}),arguments)}function _i(){return b((function(e,t,r){return e.getAll(t,r>>>0)}),arguments)}function oi(){return b((function(e,t){return e.getAll(t)}),arguments)}function ai(){return b((function(e,t){globalThis.crypto.getRandomValues(m(e,t))}),arguments)}function ci(){return b((function(e,t){e.getRandomValues(t)}),arguments)}function gi(e){return e.getTime()}function ui(){return b((function(e,t){return Reflect.get(e,t)}),arguments)}function di(){return b((function(e,t){return e.get(t)}),arguments)}function li(){return b((function(e,t){return e.get(t)}),arguments)}function pi(e,t){return e[t>>>0]}function wi(e,t){return e[t]}function yi(e){return e.global}function bi(e){return kt.__wrap(e)}function hi(){return b((function(e,t,r){return e.index(f(t,r))}),arguments)}function fi(){return b((function(e){const t=e.indexedDB;return v(t)?0:y(t)}),arguments)}function vi(){return b((function(e){const t=e.indexedDB;return v(t)?0:y(t)}),arguments)}function mi(){return b((function(e){const t=e.indexedDB;return v(t)?0:y(t)}),arguments)}function ki(e,t){e.info(t)}function Si(e){console.info(e)}function Ri(e){let t;try{t=e instanceof ArrayBuffer}catch(e){t=!1}return t}function Ki(e){let t;try{t=e instanceof Map}catch(e){t=!1}return t}function Ii(e){let t;try{t=e instanceof Promise}catch(e){t=!1}return t}function Ci(e){let t;try{t=e instanceof Uint8Array}catch(e){t=!1}return t}function Oi(e){return Array.isArray(e)}function Ai(e){return Number.isSafeInteger(e)}function Mi(e,t,r){const n=t.item(r>>>0);var i=v(n)?0:l(n,_.__wbindgen_malloc,_.__wbindgen_realloc),s=a;w().setInt32(e+4,s,!0),w().setInt32(e+0,i,!0)}function Ei(){return Symbol.iterator}function qi(){return b((function(e){return e.key}),arguments)}function Di(e){return Rt.__wrap(e)}function Bi(e){return It.__wrap(e)}function Ti(e){return Ot.__wrap(e)}function Vi(e){return Mt.__wrap(e)}function Fi(e){return e.length}function Ui(e){return e.length}function Pi(e){return e.length}function Ni(){return b((function(e,t){return IDBKeyRange.lowerBound(e,0!==t)}),arguments)}function xi(e){return qt.__wrap(e)}function zi(e){return Bt.__wrap(e)}function ji(e,t){const r=l(t.message,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a;w().setInt32(e+4,n,!0),w().setInt32(e+0,r,!0)}function Li(e){return e.msCrypto}function Wi(e,t){const r=l(t.name,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a;w().setInt32(e+4,n,!0),w().setInt32(e+0,r,!0)}function Gi(e,t){try{var r={a:e,b:t};const n=new Promise(((e,t)=>{const n=r.a;r.a=0;try{return function(e,t,r,n){_.closure422_externref_shim(e,t,r,n)}(n,r.b,e,t)}finally{r.a=n}}));return n}finally{r.a=r.b=0}}function Qi(e){return new Date(e)}function Ji(){return new Object}function Hi(){return new Map}function Yi(){return new Array}function Xi(e){return new Uint8ClampedArray(e)}function $i(){return new Error}function Zi(e){return new Uint8Array(e)}function es(e){return new Set(e)}function ts(e,t){return new Function(f(e,t))}function rs(e,t,r){return new Uint8ClampedArray(e,t>>>0,r>>>0)}function ns(e,t,r){return new Uint8Array(e,t>>>0,r>>>0)}function is(e){return new Uint8Array(e>>>0)}function ss(e){return new Uint8ClampedArray(e>>>0)}function _s(){return b((function(e,t){return new DOMException(f(e,t))}),arguments)}function os(e){return e.next}function as(){return b((function(e){return e.next()}),arguments)}function cs(e){return e.node}function gs(e){return e.now()}function us(){return Date.now()}function ds(e){return e.objectStoreNames}function ls(){return b((function(e,t,r){return e.objectStore(f(t,r))}),arguments)}function ps(e){return e.oldVersion}function ws(e){return Nt.__wrap(e)}function ys(){return b((function(e){return e.openCursor()}),arguments)}function bs(){return b((function(e){return e.openCursor()}),arguments)}function hs(){return b((function(e,t){return e.openCursor(t)}),arguments)}function fs(){return b((function(e,t,r){return e.open(f(t,r))}),arguments)}function vs(){return b((function(e,t,r,n){return e.open(f(t,r),n>>>0)}),arguments)}function ms(e){return zt.__wrap(e)}function ks(e){return Gt.__wrap(e)}function Ss(){return b((function(e,t){return JSON.parse(f(e,t))}),arguments)}function Rs(e){return e.performance}function Ks(e){return Jt.__unwrap(e)}function Is(e){return Yt.__unwrap(e)}function Cs(e){return e.process}function Os(e,t){return e.push(t)}function As(){return b((function(e,t,r){return e.put(t,r)}),arguments)}function Ms(e){return ir.__wrap(e)}function Es(e){return _r.__wrap(e)}function qs(e){queueMicrotask(e)}function Ds(e){return e.queueMicrotask}function Bs(){return b((function(e,t){e.randomFillSync(t)}),arguments)}function Ts(e){const t=e.readyState;return(te.indexOf(t)+1||3)-1}function Vs(e){return pr.__wrap(e)}function Fs(){return b((function(){return module.require}),arguments)}function Us(e){return Promise.resolve(e)}function Ps(){return b((function(e){return e.result}),arguments)}function Ns(e){return yr.__unwrap(e)}function xs(e){return hr.__wrap(e)}function zs(e){return vr.__wrap(e)}function js(e){return kr.__wrap(e)}function Ls(e){return Rr.__wrap(e)}function Ws(e){return Ir.__wrap(e)}function Gs(e){return Or.__wrap(e)}function Qs(e){return Mr.__wrap(e)}function Js(e){return qr.__wrap(e)}function Hs(){return b((function(e,t){return setTimeout(e,t)}),arguments)}function Ys(e,t,r){e[t>>>0]=r}function Xs(e,t,r){e[t]=r}function $s(e,t,r){e.set(t,r>>>0)}function Zs(e,t,r){e.set(t,r>>>0)}function e_(e,t,r){return e.set(t,r)}function t_(e,t){e.onabort=t}function r_(e,t){e.onblocked=t}function n_(e,t){e.oncomplete=t}function i_(e,t){e.onerror=t}function s_(e,t){e.onerror=t}function __(e,t){e.onsuccess=t}function o_(e,t){e.onupgradeneeded=t}function a_(e,t){e.onversionchange=t}function c_(e,t){e.unique=0!==t}function g_(e){return Lr.__wrap(e)}function u_(e){return Nr.__wrap(e)}function d_(e){return zr.__wrap(e)}function l_(e,t){const r=l(t.stack,_.__wbindgen_malloc,_.__wbindgen_realloc),n=a;w().setInt32(e+4,n,!0),w().setInt32(e+0,r,!0)}function p_(){const e="undefined"==typeof global?null:global;return v(e)?0:y(e)}function w_(){const e="undefined"==typeof globalThis?null:globalThis;return v(e)?0:y(e)}function y_(){const e="undefined"==typeof self?null:self;return v(e)?0:y(e)}function b_(){const e="undefined"==typeof window?null:window;return v(e)?0:y(e)}function h_(e){return Gr.__wrap(e)}function f_(){return b((function(e){return JSON.stringify(e)}),arguments)}function v_(e,t,r){return e.subarray(t>>>0,r>>>0)}function m_(e){const t=e.target;return v(t)?0:y(t)}function k_(e,t){return e.then(t)}function S_(e,t,r){return e.then(t,r)}function R_(e){return Jr.__wrap(e)}function K_(){return b((function(e,t,r,n){return e.transaction(f(t,r),re[n])}),arguments)}function I_(){return b((function(e,t,r){return e.transaction(t,re[r])}),arguments)}function C_(e){const t=e.transaction;return v(t)?0:y(t)}function O_(){return b((function(e,t){return e.update(t)}),arguments)}function A_(e){return en.__wrap(e)}function M_(e){return rn.__wrap(e)}function E_(e){return rn.__unwrap(e)}function q_(){return b((function(e){return e.value}),arguments)}function D_(e){return e.value}function B_(e){return e.values()}function T_(e){return sn.__wrap(e)}function V_(e){return e.version}function F_(e){return e.versions}function U_(e){console.warn(e)}function P_(e,t){e.warn(t)}function N_(e){return+e}function x_(e){return e}function z_(e){return BigInt.asUintN(64,e)}function j_(e,t){const r="bigint"==typeof t?t:void 0;w().setBigInt64(e+8,v(r)?BigInt(0):r,!0),w().setInt32(e+0,!v(r),!0)}function L_(e){return"boolean"==typeof e?e?1:0:2}function W_(e){const t=e.original;return 1==t.cnt--&&(t.a=0,!0)}function G_(e,t,r){return S(e,t,30,B)}function Q_(e,t,r){return S(e,t,401,T)}function J_(e,t,r){return S(e,t,401,V)}function H_(e,t,r){return R(e,t,407,F)}function Y_(e,t,r){return R(e,t,407,U)}function X_(e,t){const r=l(K(t),_.__wbindgen_malloc,_.__wbindgen_realloc),n=a;w().setInt32(e+4,n,!0),w().setInt32(e+0,r,!0)}function $_(e,t){return new Error(f(e,t))}function Z_(e,t){return e in t}function eo(){const e=_.__wbindgen_export_4,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)}function to(e){return Array.isArray(e)}function ro(e){return"bigint"==typeof e}function no(e){return"function"==typeof e}function io(e){return null===e}function so(e){return"object"==typeof e&&null!==e}function _o(e){return"string"==typeof e}function oo(e){return void 0===e}function ao(e,t){return e===t}function co(e,t){return e==t}function go(){return _.memory}function uo(e,t){const r="number"==typeof t?t:void 0;w().setFloat64(e+8,v(r)?0:r,!0),w().setInt32(e+0,!v(r),!0)}function lo(e){return e}function po(e,t){const r="string"==typeof t?t:void 0;var n=v(r)?0:l(r,_.__wbindgen_malloc,_.__wbindgen_realloc),i=a;w().setInt32(e+4,i,!0),w().setInt32(e+0,n,!0)}function wo(e,t){return f(e,t)}function yo(e,t){throw new Error(f(e,t))}function bo(e){let t;try{t=+e}catch(e){t=e}return t}const ho=new URL(r(9627),r.b);o(new Proxy({},{get(){throw new Error("@matrix-org/matrix-sdk-crypto-wasm was used before it was initialized. Call `initAsync` first.")}}));let fo=null;async function vo(){fo||(fo=async function(){const{instance:e}=await WebAssembly.instantiateStreaming(fetch(ho),{"./matrix_sdk_crypto_wasm_bg.js":n});o(e.exports),e.exports.__wbindgen_start()}()),await fo}var mo=r(4069),ko=r(6560),So=r(9561),Ro=r(6215),Ko=r(3840),Io=r(1815),Co=r(2986),Oo=r(2114),Ao=r(3883),Mo=r(8417);class Eo{constructor(e,t,r,n,s){this.olmMachine=e,this.keyClaimManager=t,this.outgoingRequestManager=r,this.room=n,this.encryptionSettings=s,(0,i.A)(this,"prefixedLogger",void 0),(0,i.A)(this,"lazyLoadedMembersResolved",!1),(0,i.A)(this,"currentEncryptionPromise",Promise.resolve()),this.prefixedLogger=Ko.v.getChild("[".concat(n.roomId," encryption]"));var _=n.getJoinedMembers();this.olmMachine.updateTrackedUsers(_.map((e=>new rn(e.userId)))).catch((e=>this.prefixedLogger.error("Error initializing tracked users",e)))}onCryptoEvent(e){if(JSON.stringify(this.encryptionSettings)!=JSON.stringify(e))throw new Error("Cannot reconfigure an active RoomEncryptor")}onRoomMembership(e){(e.membership==ko.O.Join||e.membership==ko.O.Invite&&this.room.shouldEncryptForInvitedMembers())&&this.olmMachine.updateTrackedUsers([new rn(e.userId)]).catch((e=>{this.prefixedLogger.error("Unable to update tracked users",e)}))}prepareForEncryption(e,t){var r=this;return(0,s.A)((function*(){yield r.encryptEvent(null,e,t)}))()}encryptEvent(e,t,r){var n,i=this,_=new Ko.T(this.prefixedLogger,e?null!==(n=e.getTxnId())&&void 0!==n?n:"":"prepareForEncryption"),o=this.currentEncryptionPromise.catch((()=>{})).then((0,s.A)((function*(){yield(0,Ao.NQ)(_,"ensureEncryptionSession",(0,s.A)((function*(){yield i.ensureEncryptionSession(_,t,r)}))),e&&(yield(0,Ao.NQ)(_,"encryptEventInner",(0,s.A)((function*(){yield i.encryptEventInner(_,e)}))))})));return this.currentEncryptionPromise=o,o}ensureEncryptionSession(e,t,r){var n=this;return(0,s.A)((function*(){if("m.megolm.v1.aes-sha2"!==n.encryptionSettings.algorithm)throw new Error("Cannot encrypt in ".concat(n.room.roomId," for unsupported algorithm '").concat(n.encryptionSettings.algorithm,"'"));e.debug("Starting encryption");var i=yield n.room.getEncryptionTargetMembers();n.lazyLoadedMembersResolved?(e.debug("Processing outgoing requests in background"),n.outgoingRequestManager.doProcessOutgoingRequests()):(yield(0,Ao.NQ)(n.prefixedLogger,"loadMembersIfNeeded: updateTrackedUsers",(0,s.A)((function*(){yield n.olmMachine.updateTrackedUsers(i.map((e=>new rn(e.userId))))}))),e.debug("Updated tracked users"),n.lazyLoadedMembersResolved=!0,e.debug("Processing outgoing requests"),yield(0,Ao.NQ)(n.prefixedLogger,"doProcessOutgoingRequests",(0,s.A)((function*(){yield n.outgoingRequestManager.doProcessOutgoingRequests()})))),e.debug("Encrypting for users (shouldEncryptForInvitedMembers: ".concat(n.room.shouldEncryptForInvitedMembers(),"):"),i.map((e=>"".concat(e.userId," (").concat(e.membership,")"))));var _=i.map((e=>new rn(e.userId)));yield(0,Ao.NQ)(n.prefixedLogger,"ensureSessionsForUsers",(0,s.A)((function*(){yield n.keyClaimManager.ensureSessionsForUsers(e,_)})));var o=new dt;switch(o.historyVisibility=function(e){switch(e){case Oo.Jv.Invited:return j.Invited;case Oo.Jv.Joined:return j.Joined;case Oo.Jv.Shared:return j.Shared;case Oo.Jv.WorldReadable:return j.WorldReadable}}(n.room.getHistoryVisibility()),o.algorithm=z.MegolmV1AesSha2,"number"==typeof n.encryptionSettings.rotation_period_ms&&(o.rotationPeriod=BigInt(1e3*n.encryptionSettings.rotation_period_ms)),"number"==typeof n.encryptionSettings.rotation_period_msgs&&(o.rotationPeriodMessages=BigInt(n.encryptionSettings.rotation_period_msgs)),r.kind){case Mo.YH.AllDevicesIsolationMode:var a,c=null!==(a=n.room.getBlacklistUnverifiedDevices())&&void 0!==a?a:t;o.sharingStrategy=ve.deviceBasedStrategy(c,r.errorOnVerifiedUserProblems);break;case Mo.YH.OnlySignedDevicesIsolationMode:o.sharingStrategy=ve.identityBasedStrategy()}yield(0,Ao.NQ)(n.prefixedLogger,"shareRoomKey",(0,s.A)((function*(){var e=yield n.olmMachine.shareRoomKey(new yr(n.room.roomId),_,o);if(e)for(var t of e)yield n.outgoingRequestManager.outgoingRequestProcessor.makeOutgoingRequest(t)})))}))()}forceDiscardSession(){var e=this;return(0,s.A)((function*(){(yield e.olmMachine.invalidateGroupSession(new yr(e.room.roomId)))&&e.prefixedLogger.info("Discarded existing group session")}))()}encryptEventInner(e,t){var r=this;return(0,s.A)((function*(){e.debug("Encrypting actual message content");var n=yield r.olmMachine.encryptRoomEvent(new yr(r.room.roomId),t.getType(),JSON.stringify(t.getContent()));t.makeEncrypted(Co.Bx.RoomMessageEncrypted,JSON.parse(n),r.olmMachine.identityKeys.curve25519.toBase64(),r.olmMachine.identityKeys.ed25519.toBase64()),e.debug("Encrypted event successfully")}))()}}var qo=r(7723),Do=r(6387),Bo="/_matrix/client/unstable/org.matrix.msc3814.v1",To="org.matrix.msc3814";class Vo extends Do.X{constructor(e,t,r,n,s){super(),this.logger=e,this.olmMachine=t,this.http=r,this.outgoingRequestProcessor=n,this.secretStorage=s,(0,i.A)(this,"intervalId",void 0)}cacheKey(e){var t=this;return(0,s.A)((function*(){yield t.olmMachine.dehydratedDevices().saveDehydratedDeviceKey(e),t.emit(Mo.cr.DehydrationKeyCached)}))()}isSupported(){var e=this;return(0,s.A)((function*(){try{yield e.http.authedRequest(Io.IT.Get,"/dehydrated_device",void 0,void 0,{prefix:Bo})}catch(e){var t=e;if("M_UNRECOGNIZED"===t.errcode)return!1;if("M_NOT_FOUND"===t.errcode)return!0;throw e}return!0}))()}start(){var e=arguments,t=this;return(0,s.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:{};if("boolean"==typeof r&&(r={createNewKey:r}),!r.onlyIfKeyCached||(yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey())){if(t.stop(),!1!==r.rehydrate)try{yield t.rehydrateDeviceIfAvailable()}catch(e){t.logger.info("dehydration: Error rehydrating device:",e),t.emit(Mo.cr.RehydrationError,e.message)}r.createNewKey&&(yield t.resetKey()),yield t.scheduleDeviceDehydration()}}))()}isKeyStored(){var e=this;return(0,s.A)((function*(){return Boolean(yield e.secretStorage.isStored(To))}))()}resetKey(){var e=this;return(0,s.A)((function*(){var t=Ue.createRandomKey();return yield e.secretStorage.store(To,t.toBase64()),yield e.cacheKey(t),t}))()}getKey(e){var t=this;return(0,s.A)((function*(){var r=yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey();if(r)return r;var n=yield t.secretStorage.get(To);if(void 0===n)return e?yield t.resetKey():null;var i=(0,qo.y4)(n);try{var s=Ue.createKeyFromArray(i);return yield t.cacheKey(s),s}finally{i.fill(0)}}))()}rehydrateDeviceIfAvailable(){var e=this;return(0,s.A)((function*(){var t,r=yield e.getKey(!1);if(!r)return!1;try{t=yield e.http.authedRequest(Io.IT.Get,"/dehydrated_device",void 0,void 0,{prefix:Bo})}catch(t){var n=t;if("M_NOT_FOUND"===n.errcode||"M_UNRECOGNIZED"===n.errcode)return e.logger.info("dehydration: No dehydrated device"),!1;throw n}e.logger.info("dehydration: dehydrated device found"),e.emit(Mo.cr.RehydrationStarted);var i=yield e.olmMachine.dehydratedDevices().rehydrate(r,new Le(t.device_id),JSON.stringify(t.device_data));e.logger.info("dehydration: device rehydrated");for(var s=void 0,_=0,o=0,a=(0,Ao.RR)("/dehydrated_device/$device_id/events",{$device_id:t.device_id});;){var c=yield e.http.authedRequest(Io.IT.Post,a,void 0,s?{next_batch:s}:{},{prefix:Bo});if(0===c.events.length)break;_+=c.events.length,s=c.next_batch,o+=(yield i.receiveEvents(JSON.stringify(c.events))).length,e.emit(Mo.cr.RehydrationProgress,o,_)}return e.logger.info("dehydration: received ".concat(o," room keys from ").concat(_," to-device events")),e.emit(Mo.cr.RehydrationCompleted),!0}))()}createAndUploadDehydratedDevice(){var e=this;return(0,s.A)((function*(){var t=yield e.getKey(!0),r=yield e.olmMachine.dehydratedDevices().create();e.emit(Mo.cr.DehydratedDeviceCreated);var n=yield r.keysForUpload("Dehydrated device",t);yield e.outgoingRequestProcessor.makeOutgoingRequest(n),e.emit(Mo.cr.DehydratedDeviceUploaded),e.logger.info("dehydration: uploaded device")}))()}scheduleDeviceDehydration(){var e=this;return(0,s.A)((function*(){e.stop(),yield e.createAndUploadDehydratedDevice(),e.intervalId=setInterval((()=>{e.createAndUploadDehydratedDevice().catch((t=>{e.emit(Mo.cr.DehydratedDeviceRotationError,t.message),e.logger.error("Error creating dehydrated device:",t)}))}),6048e5)}))()}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}delete(){var e=this;return(0,s.A)((function*(){e.stop();try{yield e.http.authedRequest(Io.IT.Delete,"/dehydrated_device",void 0,{},{prefix:Bo})}catch(e){var t=e;if("M_UNRECOGNIZED"===t.errcode)return;if("M_NOT_FOUND"===t.errcode)return;throw e}}))()}}function Fo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}class Uo{constructor(e,t){this.olmMachine=e,this.http=t}makeOutgoingRequest(e,t){var r=this;return(0,s.A)((function*(){var n;if(e instanceof Mt)n=yield r.requestWithRetry(Io.IT.Post,"/_matrix/client/v3/keys/upload",{},e.body);else if(e instanceof Ot)n=yield r.requestWithRetry(Io.IT.Post,"/_matrix/client/v3/keys/query",{},e.body);else if(e instanceof It)n=yield r.requestWithRetry(Io.IT.Post,"/_matrix/client/v3/keys/claim",{},e.body);else if(e instanceof Nr)n=yield r.requestWithRetry(Io.IT.Post,"/_matrix/client/v3/keys/signatures/upload",{},e.body);else if(e instanceof Rt)n=yield r.requestWithRetry(Io.IT.Put,"/_matrix/client/v3/room_keys/keys",{version:e.version},e.body);else if(e instanceof Jr)n=yield r.sendToDeviceRequest(e);else if(e instanceof Ir){var i="/_matrix/client/v3/rooms/".concat(encodeURIComponent(e.room_id),"/send/")+"".concat(encodeURIComponent(e.event_type),"/").concat(encodeURIComponent(e.txn_id));n=yield r.requestWithRetry(Io.IT.Put,i,{},e.body)}else{if(e instanceof $r)return void(yield r.makeRequestWithUIA(Io.IT.Post,"/_matrix/client/v3/keys/device_signing/upload",{},e.body,t));if(e instanceof ir){var _=Bo+"/dehydrated_device";return void(yield r.rawJsonRequest(Io.IT.Put,_,{},e.body))}Ko.v.warn("Unsupported outgoing message",Object.getPrototypeOf(e)),n=""}if(e.id)try{yield(0,Ao.NQ)(Ko.v,"Mark Request as sent ".concat(e.type),(0,s.A)((function*(){yield r.olmMachine.markRequestAsSent(e.id,e.type,n)})))}catch(e){if(!(e instanceof Error)||"Attempt to use a moved value"!==e.message&&"null pointer passed to rust"!==e.message)throw e;Ko.v.log("Ignoring error '".concat(e.message,"': client is likely shutting down"))}else Ko.v.trace("Outgoing request type:".concat(e.type," does not have an ID"))}))()}sendToDeviceRequest(e){var t=this;return(0,s.A)((function*(){var r=JSON.parse(e.body),n=[];for(var[i,s]of Object.entries(r.messages))for(var[_,o]of Object.entries(s))n.push("".concat(i,"/").concat(_," (msgid ").concat(o[Co.wt],")"));Ko.v.info("Sending batch of to-device messages. type=".concat(e.event_type," txnid=").concat(e.txn_id),n);var a="/_matrix/client/v3/sendToDevice/".concat(encodeURIComponent(e.event_type),"/")+encodeURIComponent(e.txn_id);return yield t.requestWithRetry(Io.IT.Put,a,{},e.body)}))()}makeRequestWithUIA(e,t,r,n,_){var o=this;return(0,s.A)((function*(){if(!_)return yield o.requestWithRetry(e,t,r,n);var a=JSON.parse(n),c=function(){var n=(0,s.A)((function*(n){var s=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fo(Object(r),!0).forEach((function(t){(0,i.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fo(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},a);null!==n&&(s.auth=n);var _=yield o.requestWithRetry(e,t,r,JSON.stringify(s));return JSON.parse(_)}));return function(e){return n.apply(this,arguments)}}(),g=yield _(c);return JSON.stringify(g)}))()}requestWithRetry(e,t,r,n){var i=this;return(0,s.A)((function*(){for(var s=0;;)try{return yield i.rawJsonRequest(e,t,r,n)}catch(e){s++;var _=(0,Io.fZ)(e,s,!0);if(_<0)throw e;yield(0,Ao.yy)(_)}}))()}rawJsonRequest(e,t,r,n){var i=this;return(0,s.A)((function*(){return yield i.http.authedRequest(e,t,r,n,{json:!1,headers:{"Content-Type":"application/json",Accept:"application/json"},prefix:"",localTimeoutMs:6e4})}))()}}class Po{constructor(e,t){this.olmMachine=e,this.outgoingRequestProcessor=t,(0,i.A)(this,"currentClaimPromise",void 0),(0,i.A)(this,"stopped",!1),this.currentClaimPromise=Promise.resolve()}stop(){this.stopped=!0}ensureSessionsForUsers(e,t){var r=this.currentClaimPromise.catch((()=>{})).then((()=>this.ensureSessionsForUsersInner(e,t)));return this.currentClaimPromise=r,r}ensureSessionsForUsersInner(e,t){var r=this;return(0,s.A)((function*(){if(r.stopped)throw new Error("Cannot ensure Olm sessions: shutting down");e.info("Checking for missing Olm sessions");var n=yield r.olmMachine.getMissingSessions(t.map((e=>e.clone())));n&&(e.info("Making /keys/claim request"),yield r.outgoingRequestProcessor.makeOutgoingRequest(n)),e.info("Olm sessions prepared")}))()}}var No=r(7131);function xo(e,t){var r=new Map;for(var[n,i]of e.keys.entries())r.set(n.toString(),i.toBase64());var s=No.u.Unverified;e.isBlacklisted()?s=No.u.Blocked:e.isVerified()&&(s=No.u.Verified);var _=new Map,o=e.signatures.get(t);if(o){var a=new Map;for(var[c,g]of o.entries())g.isValid()&&g.signature&&a.set(c,g.signature.toBase64());_.set(t.toString(),a)}var u=e.algorithms,d=new Set;return u.forEach((e=>{switch(e){case z.MegolmV1AesSha2:d.add("m.megolm.v1.aes-sha2");break;case z.OlmV1Curve25519AesSha2:default:d.add("m.olm.v1.curve25519-aes-sha2")}})),new No.p({deviceId:e.deviceId.toString(),userId:t.toString(),keys:r,algorithms:Array.from(d),verified:s,signatures:_,displayName:e.displayName,dehydrated:e.isDehydrated})}function zo(e){var t,r=new Map(Object.entries(e.keys)),n=null===(t=e.unsigned)||void 0===t?void 0:t.device_display_name,i=new Map;if(e.signatures)for(var s in e.signatures)i.set(s,new Map(Object.entries(e.signatures[s])));return new No.p({deviceId:e.device_id,userId:e.user_id,keys:r,algorithms:e.algorithms,verified:No.u.Unverified,signatures:i,displayName:n})}var jo=r(7570);class Lo{constructor(e,t,r){this.olmMachine=e,this.outgoingRequestProcessor=t,this.secretStorage=r}bootstrapCrossSigning(e){var t=this;return(0,s.A)((function*(){if(e.setupNewCrossSigning)yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);else{var r=yield t.olmMachine.crossSigningStatus(),n=yield t.secretStorage.get("m.cross_signing.master"),i=yield t.secretStorage.get("m.cross_signing.self_signing"),s=yield t.secretStorage.get("m.cross_signing.user_signing"),_=Boolean(n&&i&&s),o=r.hasMaster&&r.hasUserSigning&&r.hasSelfSigning;if(Ko.v.log("bootstrapCrossSigning: starting",{setupNewCrossSigning:e.setupNewCrossSigning,olmDeviceHasMaster:r.hasMaster,olmDeviceHasUserSigning:r.hasUserSigning,olmDeviceHasSelfSigning:r.hasSelfSigning,privateKeysInSecretStorage:_}),o)(yield t.secretStorage.hasKey())?_?Ko.v.log("bootstrapCrossSigning: Olm device has private keys and they are saved in secret storage; doing nothing"):(Ko.v.log("bootstrapCrossSigning: Olm device has private keys: exporting to secret storage"),yield t.exportCrossSigningKeysToStorage()):Ko.v.warn("bootstrapCrossSigning: Olm device has private keys, but secret storage is not yet set up; doing nothing for now.");else if(_){Ko.v.log("bootstrapCrossSigning: Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally");var a=yield t.olmMachine.importCrossSigningKeys(n,i,s);if(!a.hasMaster||!a.hasSelfSigning||!a.hasUserSigning)throw new Error("importCrossSigningKeys failed to import the keys");var c=yield t.olmMachine.getDevice(t.olmMachine.userId,t.olmMachine.deviceId);try{var g=yield c.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(g)}finally{c.free()}}else Ko.v.log("bootstrapCrossSigning: Cross-signing private keys not found locally or in secret storage, creating new keys"),yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);Ko.v.log("bootstrapCrossSigning: complete")}}))()}resetCrossSigning(e){var t=this;return(0,s.A)((function*(){var r=yield t.olmMachine.bootstrapCrossSigning(!0);for(var n of((yield t.secretStorage.hasKey())?(Ko.v.log("resetCrossSigning: exporting private keys to secret storage"),yield t.exportCrossSigningKeysToStorage()):Ko.v.warn("resetCrossSigning: Secret storage is not yet set up; not exporting keys to secret storage yet."),Ko.v.log("resetCrossSigning: publishing public keys to server"),[r.uploadKeysRequest,r.uploadSigningKeysRequest,r.uploadSignaturesRequest]))n&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(n,e))}))()}exportCrossSigningKeysToStorage(){var e=this;return(0,s.A)((function*(){var t=yield e.olmMachine.exportCrossSigningKeys();null!=t&&t.masterKey?yield e.secretStorage.store("m.cross_signing.master",t.masterKey):Ko.v.error("Cannot export MSK to secret storage, private key unknown"),null!=t&&t.self_signing_key?yield e.secretStorage.store("m.cross_signing.self_signing",t.self_signing_key):Ko.v.error("Cannot export SSK to secret storage, private key unknown"),null!=t&&t.userSigningKey?yield e.secretStorage.store("m.cross_signing.user_signing",t.userSigningKey):Ko.v.error("Cannot export USK to secret storage, private key unknown")}))()}}function Wo(e){return Go.apply(this,arguments)}function Go(){return(Go=(0,s.A)((function*(e){return Qo(e,["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"])}))).apply(this,arguments)}function Qo(e,t){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,s.A)((function*(e,t){var r=yield e.getDefaultKeyId();if(!r)return!1;for(var n of t)if(!(r in((yield e.isStored(n))||{})))return!1;return!0}))).apply(this,arguments)}var Ho=r(4400),Yo=r(4831),Xo=function(e){return e.Sas="m.sas.v1",e.ShowQrCode="m.qr_code.show.v1",e.ScanQrCode="m.qr_code.scan.v1",e.Reciprocate="m.reciprocate.v1",e}({});class $o extends Do.X{constructor(e,t,r,n){super(),this.olmMachine=e,this.inner=t,this.outgoingRequestProcessor=r,this.supportedVerificationMethods=n,(0,i.A)(this,"reEmitter",void 0),(0,i.A)(this,"_accepting",!1),(0,i.A)(this,"_cancelling",!1),(0,i.A)(this,"_verifier",void 0),this.reEmitter=new Yo.Q(this);var _=new WeakRef(this);t.registerChangesCallback((0,s.A)((function*(){var e;return null===(e=_.deref())||void 0===e?void 0:e.onChange()})))}onChange(){var e=this.inner.getVerification();e instanceof Mr?void 0===this._verifier||this._verifier instanceof ea?this.setVerifier(new ta(e,this,this.outgoingRequestProcessor)):this._verifier instanceof ta&&this._verifier.replaceInner(e):e instanceof _r&&void 0===this._verifier&&this.setVerifier(new ea(e,this.outgoingRequestProcessor)),this.emit(Ho.FM.Change)}setVerifier(e){this._verifier&&this.reEmitter.stopReEmitting(this._verifier,[Ho.FM.Change]),this._verifier=e,this.reEmitter.reEmit(this._verifier,[Ho.FM.Change])}get transactionId(){return this.inner.flowId}get roomId(){var e;return null===(e=this.inner.roomId)||void 0===e?void 0:e.toString()}get initiatedByMe(){return this.inner.weStarted()}get otherUserId(){return this.inner.otherUserId.toString()}get otherDeviceId(){var e;return null===(e=this.inner.otherDeviceId)||void 0===e?void 0:e.toString()}getOtherDevice(){var e=this;return(0,s.A)((function*(){var t=e.inner.otherDeviceId;if(t)return yield e.olmMachine.getDevice(e.inner.otherUserId,t,5)}))()}get isSelfVerification(){return this.inner.isSelfVerification()}get phase(){var e=this.inner.phase();switch(e){case ee.Created:case ee.Requested:return Ho.X9.Requested;case ee.Ready:return this._accepting?Ho.X9.Requested:Ho.X9.Ready;case ee.Transitioned:if(!this._verifier)throw new Error("VerificationRequest: inner phase == Transitioned but no verifier!");return this._verifier.verificationPhase;case ee.Done:return Ho.X9.Done;case ee.Cancelled:return Ho.X9.Cancelled}throw new Error("Unknown verification phase ".concat(e))}get pending(){if(this.inner.isPassive())return!1;var e=this.phase;return e!==Ho.X9.Done&&e!==Ho.X9.Cancelled}get accepting(){return this._accepting}get declining(){return this._cancelling}get timeout(){return this.inner.timeRemainingMillis()}get methods(){throw new Error("not implemented")}get chosenMethod(){if(this.phase!==Ho.X9.Started)return null;var e=this.inner.getVerification();return e instanceof Mr?Xo.Sas:e instanceof _r?Xo.Reciprocate:null}otherPartySupportsMethod(e){var t=this.inner.theirSupportedMethods;if(void 0===t)return!1;var r=ra[e];return t.some((e=>e===r))}accept(){var e=this;return(0,s.A)((function*(){if(e.inner.phase()!==ee.Requested||e._accepting)throw new Error("Cannot accept a verification request in phase ".concat(e.phase));e._accepting=!0;try{var t=e.inner.acceptWithMethods(e.supportedVerificationMethods.map(na));t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}finally{e._accepting=!1}e.emit(Ho.FM.Change)}))()}cancel(e){var t=this;return(0,s.A)((function*(){if(!t._cancelling){t._cancelling=!0;try{var e=t.inner.cancel();e&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(e))}finally{t._cancelling=!1}}}))()}beginKeyVerification(e,t){throw new Error("not implemented")}startVerification(e){var t=this;return(0,s.A)((function*(){if(e!==Xo.Sas)throw new Error("Unsupported verification method ".concat(e));if(!(yield t.getOtherDevice()))throw new Error("startVerification(): other device is unknown");var r=yield t.inner.startSas();if(r){var[,n]=r;yield t.outgoingRequestProcessor.makeOutgoingRequest(n)}if(!t._verifier)throw new Error("Still no verifier after startSas() call");return t._verifier}))()}scanQRCode(e){var t=this;return(0,s.A)((function*(){var r=dr.fromBytes(e),n=yield t.inner.scanQrCode(r);if(!t._verifier)throw new Error("Still no verifier after scanQrCode() call");var i=n.reciprocate();return i&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(i)),t._verifier}))()}get verifier(){return this.phase===Ho.X9.Started?this._verifier:void 0}getQRCodeBytes(){throw new Error("getQRCodeBytes() unsupported in Rust Crypto; use generateQRCode() instead.")}generateQRCode(){var e=this;return(0,s.A)((function*(){if(!(yield e.getOtherDevice()))throw new Error("generateQRCode(): other device is unknown");var t=yield e.inner.generateQrCode();if(t)return t.toBytes()}))()}get cancellationCode(){var e,t;return null!==(e=null===(t=this.inner.cancelInfo)||void 0===t?void 0:t.cancelCode())&&void 0!==e?e:null}get cancellingUserId(){var e=this.inner.cancelInfo;return e?e.cancelledbyUs()?this.olmMachine.userId.toString():this.inner.otherUserId.toString():void 0}}class Zo extends Do.X{constructor(e,t){super(),this.inner=e,this.outgoingRequestProcessor=t,(0,i.A)(this,"completionDeferred",void 0),this.completionDeferred=(0,Ao.v6)();var r=new WeakRef(this);e.registerChangesCallback((0,s.A)((function*(){var e;return null===(e=r.deref())||void 0===e?void 0:e.onChange()}))),this.completionDeferred.promise.catch((()=>null))}onChange(){if(this.inner.isDone())this.completionDeferred.resolve(void 0);else if(this.inner.isCancelled()){var e=this.inner.cancelInfo();this.completionDeferred.reject(new Error("Verification cancelled by ".concat(e.cancelledbyUs()?"us":"them"," with code ").concat(e.cancelCode(),": ").concat(e.reason())))}this.emit(Ho.FM.Change)}get hasBeenCancelled(){return this.inner.isCancelled()}get userId(){return this.inner.otherUserId.toString()}cancel(e){var t=this.inner.cancel();t&&this.outgoingRequestProcessor.makeOutgoingRequest(t)}getShowSasCallbacks(){return null}getReciprocateQrCodeCallbacks(){return null}}class ea extends Zo{constructor(e,t){super(e,t),(0,i.A)(this,"callbacks",null)}onChange(){null===this.callbacks&&this.inner.hasBeenScanned()&&(this.callbacks={confirm:()=>{this.confirmScanning()},cancel:()=>this.cancel()}),super.onChange()}verify(){var e=this;return(0,s.A)((function*(){null!==e.callbacks&&e.emit(Ho.Ji.ShowReciprocateQr,e.callbacks),yield e.completionDeferred.promise}))()}get verificationPhase(){switch(this.inner.state()){case Q.Created:return Ho.X9.Ready;case Q.Scanned:case Q.Confirmed:case Q.Reciprocated:return Ho.X9.Started;case Q.Done:return Ho.X9.Done;case Q.Cancelled:return Ho.X9.Cancelled;default:throw new Error("Unknown qr code state ".concat(this.inner.state()))}}getReciprocateQrCodeCallbacks(){return this.callbacks}confirmScanning(){var e=this;return(0,s.A)((function*(){var t=e.inner.confirmScanning();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}))()}}class ta extends Zo{constructor(e,t,r){super(e,r),(0,i.A)(this,"callbacks",null)}verify(){var e=this;return(0,s.A)((function*(){yield e.sendAccept(),yield e.completionDeferred.promise}))()}sendAccept(){var e=this;return(0,s.A)((function*(){var t=e.inner.accept();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}))()}onChange(){var e,t=this;if(super.onChange(),null===this.callbacks){var r=this.inner.emoji(),n=this.inner.decimals();if(void 0===r&&void 0===n)return;var i={};r&&(i.emoji=r.map((e=>[e.symbol,e.description]))),n&&(i.decimal=[n[0],n[1],n[2]]),this.callbacks={sas:i,confirm:(e=(0,s.A)((function*(){var e=yield t.inner.confirm();for(var r of e)yield t.outgoingRequestProcessor.makeOutgoingRequest(r)})),function(){return e.apply(this,arguments)}),mismatch:()=>{var e=this.inner.cancelWithCode("m.mismatched_sas");e&&this.outgoingRequestProcessor.makeOutgoingRequest(e)},cancel:()=>{var e=this.inner.cancelWithCode("m.user");e&&this.outgoingRequestProcessor.makeOutgoingRequest(e)}},this.emit(Ho.Ji.ShowSas,this.callbacks)}}get verificationPhase(){return Ho.X9.Started}getShowSasCallbacks(){return this.callbacks}replaceInner(e){if(this.inner!=e){this.inner=e;var t=new WeakRef(this);e.registerChangesCallback((0,s.A)((function*(){var e;return null===(e=t.deref())||void 0===e?void 0:e.onChange()}))),this.sendAccept(),this.onChange()}}}var ra={[Xo.Sas]:Z.SasV1,[Xo.ScanQrCode]:Z.QrCodeScanV1,[Xo.ShowQrCode]:Z.QrCodeShowV1,[Xo.Reciprocate]:Z.ReciprocateV1};function na(e){var t=ra[e];if(void 0===t)throw new Error("Unknown verification method ".concat(e));return t}class ia extends Do.X{constructor(e,t,r){super(),this.olmMachine=e,this.http=t,this.outgoingRequestProcessor=r,(0,i.A)(this,"checkedForBackup",!1),(0,i.A)(this,"serverBackupInfo",void 0),(0,i.A)(this,"activeBackupVersion",null),(0,i.A)(this,"stopped",!1),(0,i.A)(this,"backupKeysLoopRunning",!1),(0,i.A)(this,"keyBackupCheckInProgress",null)}stop(){this.stopped=!0}getActiveBackupVersion(){var e=this;return(0,s.A)((function*(){return(yield e.olmMachine.isBackupEnabled())?e.activeBackupVersion:null}))()}getServerBackupInfo(){var e=this;return(0,s.A)((function*(){return yield e.checkKeyBackupAndEnable(!1),e.serverBackupInfo}))()}isKeyBackupTrusted(e){var t=this;return(0,s.A)((function*(){var r=yield t.olmMachine.verifyBackup(e),n=yield t.olmMachine.getBackupKeys(),i=null==n?void 0:n.decryptionKey;return{matchesDecryptionKey:!!i&&sa(e,i),trusted:r.trusted()}}))()}checkKeyBackupAndEnable(e){return!e&&this.checkedForBackup?Promise.resolve(null):(this.keyBackupCheckInProgress||(this.keyBackupCheckInProgress=this.doCheckKeyBackup().finally((()=>{this.keyBackupCheckInProgress=null}))),this.keyBackupCheckInProgress)}handleBackupSecretReceived(e){var t=this;return(0,s.A)((function*(){var r,n;try{n=yield t.requestKeyBackupVersion()}catch(e){return Ko.v.warn("handleBackupSecretReceived: Error checking for latest key backup",e),!1}if(null===(r=n)||void 0===r||!r.version)return Ko.v.warn("handleBackupSecretReceived: Received a backup decryption key, but there is no trusted server-side key backup"),!1;try{var i=_e.fromBase64(e);return sa(n,i)?(Ko.v.info("handleBackupSecretReceived: A valid backup decryption key has been received and stored in cache."),yield t.saveBackupDecryptionKey(i,n.version),!0):(Ko.v.warn("handleBackupSecretReceived: Private decryption key does not match the public key of the current remote backup."),!1)}catch(e){Ko.v.warn("handleBackupSecretReceived: Invalid backup decryption key",e)}return!1}))()}saveBackupDecryptionKey(e,t){var r=this;return(0,s.A)((function*(){yield r.olmMachine.saveBackupDecryptionKey(e,t),r.emit(Mo.cr.KeyBackupDecryptionKeyCached,t)}))()}importRoomKeys(e,t){var r=this;return(0,s.A)((function*(){yield r.importRoomKeysAsJson(JSON.stringify(e),t)}))()}importRoomKeysAsJson(e,t){var r=this;return(0,s.A)((function*(){yield r.olmMachine.importExportedRoomKeys(e,((e,r)=>{var n,i={total:Number(r),successes:Number(e),stage:Mo.wF.LoadKeys,failures:0};null==t||null===(n=t.progressCallback)||void 0===n||n.call(t,i)}))}))()}importBackedUpRoomKeys(e,t,r){var n=this;return(0,s.A)((function*(){var i=new Map;for(var s of e){var _=new yr(s.room_id);i.has(_)||i.set(_,new Map),i.get(_).set(s.session_id,s)}yield n.olmMachine.importBackedUpRoomKeys(i,((e,t,n)=>{var i,s={total:Number(t),successes:Number(e),stage:Mo.wF.LoadKeys,failures:Number(n)};null==r||null===(i=r.progressCallback)||void 0===i||i.call(r,s)}),t)}))()}doCheckKeyBackup(){var e=this;return(0,s.A)((function*(){var t;Ko.v.log("Checking key backup status...");try{t=yield e.requestKeyBackupVersion()}catch(t){return Ko.v.warn("Error checking for active key backup",t),e.serverBackupInfo=void 0,null}e.checkedForBackup=!0,t&&!t.version&&(Ko.v.warn("active backup lacks a useful 'version'; ignoring it"),t=void 0),e.serverBackupInfo=t;var r=yield e.getActiveBackupVersion();if(!t)return null!==r?(Ko.v.log("No key backup present on server: disabling key backup"),yield e.disableKeyBackup()):Ko.v.log("No key backup present on server: not enabling key backup"),null;var n=yield e.isKeyBackupTrusted(t);return n.matchesDecryptionKey||n.trusted?null===r?(Ko.v.log("Found usable key backup v".concat(t.version,": enabling key backups")),yield e.enableKeyBackup(t)):r!==t.version?(Ko.v.log("On backup version ".concat(r," but found version ").concat(t.version,": switching.")),yield e.disableKeyBackup(),yield e.enableKeyBackup(t)):Ko.v.log("Backup version ".concat(t.version," still current")):null!==r?(Ko.v.log("Key backup present on server but not trusted: disabling key backup"),yield e.disableKeyBackup()):Ko.v.log("Key backup present on server but not trusted: not enabling key backup"),{backupInfo:t,trustInfo:n}}))()}enableKeyBackup(e){var t=this;return(0,s.A)((function*(){yield t.olmMachine.enableBackupV1(e.auth_data.public_key,e.version),t.activeBackupVersion=e.version,t.emit(Mo.cr.KeyBackupStatus,!0),t.backupKeysLoop()}))()}maybeUploadKey(){var e=this;return(0,s.A)((function*(){null!=e.activeBackupVersion&&e.backupKeysLoop()}))()}disableKeyBackup(){var e=this;return(0,s.A)((function*(){yield e.olmMachine.disableBackup(),e.activeBackupVersion=null,e.emit(Mo.cr.KeyBackupStatus,!1)}))()}backupKeysLoop(){var e=arguments,t=this;return(0,s.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:1e4;if(t.backupKeysLoopRunning)Ko.v.log("Backup loop already running");else{t.backupKeysLoopRunning=!0,Ko.v.log("Backup: Starting keys upload loop for backup version:".concat(t.activeBackupVersion,"."));var n=Math.random()*r;yield(0,Ao.yy)(n);try{for(var i=0,_=null,o=!0;!t.stopped;){var a=void 0;try{a=yield(0,Ao.NQ)(Ko.v,"BackupRoomKeys: Get keys to backup from rust crypto-sdk",(0,s.A)((function*(){return yield t.olmMachine.backupRoomKeys()})))}catch(e){Ko.v.error("Backup: Failed to get keys to backup from rust crypto-sdk",e)}if(!a||t.stopped||!t.activeBackupVersion)return Ko.v.log("Backup: Ending loop for version ".concat(t.activeBackupVersion,".")),void(a||t.emit(Mo.cr.KeyBackupSessionsRemaining,0));try{if(yield t.outgoingRequestProcessor.makeOutgoingRequest(a),i=0,t.stopped)break;if(!o&&null===_)try{var c=yield t.olmMachine.roomKeyCounts();_=c.total-c.backedUp}catch(e){Ko.v.error("Backup: Failed to get key counts from rust crypto-sdk",e)}if(null!==_){t.emit(Mo.cr.KeyBackupSessionsRemaining,_);var g=t.keysCountInBatch(a);_=Math.max(_-g,0)}}catch(e){if(i++,Ko.v.error("Backup: Error processing backup request for rust crypto-sdk",e),e instanceof Io.up){var u=e.data.errcode;if("M_NOT_FOUND"==u||"M_WRONG_ROOM_KEYS_VERSION"==u){Ko.v.log("Backup: Failed to upload keys to current vesion: ".concat(u,"."));try{yield t.disableKeyBackup()}catch(e){Ko.v.error("Backup: An error occurred while disabling key backup:",e)}return t.emit(Mo.cr.KeyBackupFailed,e.data.errcode),t.backupKeysLoopRunning=!1,void t.checkKeyBackupAndEnable(!0)}if(e.isRateLimitError())try{var d=e.getRetryAfterMs();if(d&&d>0){yield(0,Ao.yy)(d);continue}}catch(e){Ko.v.warn("Backup: An error occurred while retrieving a rate-limit retry delay",e)}}yield(0,Ao.yy)(1e3*Math.pow(2,Math.min(i-1,4)))}o=!1}}finally{t.backupKeysLoopRunning=!1}}}))()}keysCountInBatch(e){return ga(JSON.parse(e.body))}requestKeyBackupVersion(e){var t=this;return(0,s.A)((function*(){return yield oa(t.http,e)}))()}setupKeyBackup(e){var t=this;return(0,s.A)((function*(){yield t.deleteAllKeyBackupVersions();var r=_e.createRandomKey(),n=r.megolmV1PublicKey,i={public_key:n.publicKeyBase64};yield e(i);var s=yield t.http.authedRequest(Io.IT.Post,"/room_keys/version",void 0,{algorithm:n.algorithm,auth_data:i},{prefix:Io.iD.V3});return yield t.saveBackupDecryptionKey(r,s.version),{version:s.version,algorithm:n.algorithm,authData:i,decryptionKey:r}}))()}deleteAllKeyBackupVersions(){var e=this;return(0,s.A)((function*(){for(var t,r,n=null!==(t=null===(r=yield e.requestKeyBackupVersion())||void 0===r?void 0:r.version)&&void 0!==t?t:null;null!=n;){var i,s;yield e.deleteKeyBackupVersion(n),n=null!==(i=null===(s=yield e.requestKeyBackupVersion())||void 0===s?void 0:s.version)&&void 0!==i?i:null}}))()}deleteKeyBackupVersion(e){var t=this;return(0,s.A)((function*(){Ko.v.debug("deleteKeyBackupVersion v:".concat(e));var r=(0,Ao.RR)("/room_keys/version/$version",{$version:e});yield t.http.authedRequest(Io.IT.Delete,r,void 0,void 0,{prefix:Io.iD.V3}),t.activeBackupVersion===e&&(t.serverBackupInfo=null,yield t.disableKeyBackup())}))()}createBackupDecryptor(e){return new _a(e)}restoreKeyBackup(e,t,r){var n=this;return(0,s.A)((function*(){var i=yield n.downloadKeyBackup(e);return n.importKeyBackup(i,e,t,r)}))()}downloadKeyBackup(e){return this.http.authedRequest(Io.IT.Get,"/room_keys/keys",{version:e},void 0,{prefix:Io.iD.V3})}importKeyBackup(e,t,r,n){var i=this;return(0,s.A)((function*(){var _,o=ga(e),a=0,c=0;null==n||null===(_=n.progressCallback)||void 0===_||_.call(n,{total:o,successes:a,stage:Mo.wF.LoadKeys,failures:c});var g=function(){var e=(0,s.A)((function*(e){var s,_=[],g=function*(t){(yield r.decryptSessions(e.get(t))).forEach((e=>{e.room_id=t,_.push(e)}))};for(var u of e.keys())yield*g(u);try{yield i.importBackedUpRoomKeys(_,t),a+=_.length}catch(e){c+=_.length,Ko.v.error("Error importing keys from backup",e)}null==n||null===(s=n.progressCallback)||void 0===s||s.call(n,{total:o,successes:a,stage:Mo.wF.LoadKeys,failures:c})}));return function(t){return e.apply(this,arguments)}}(),u=0,d=new Map;for(var[l,p]of Object.entries(e.rooms))if(p.sessions)for(var[w,y]of(d.set(l,{}),Object.entries(p.sessions)))d.get(l)[w]=y,(u+=1)>=200&&(yield g(d),(d=new Map).set(l,{}),u=0);return u>0&&(yield g(d)),{total:o,imported:a}}))()}}function sa(e,t){var r;return"m.megolm_backup.v1.curve25519-aes-sha2"!==e.algorithm?(Ko.v.warn("backupMatchesPrivateKey: Unsupported backup algorithm",e.algorithm),!1):(null===(r=e.auth_data)||void 0===r?void 0:r.public_key)===t.megolmV1PublicKey.publicKeyBase64}class _a{constructor(e){(0,i.A)(this,"decryptionKey",void 0),(0,i.A)(this,"sourceTrusted",void 0),this.decryptionKey=e,this.sourceTrusted=!1}decryptSessions(e){var t=this;return(0,s.A)((function*(){var r=[];for(var[n,i]of Object.entries(e))try{var s=JSON.parse(t.decryptionKey.decryptV1(i.session_data.ephemeral,i.session_data.mac,i.session_data.ciphertext));s.session_id=n,r.push(s)}catch(e){Ko.v.log("Failed to decrypt megolm session from backup",e,i)}return r}))()}free(){this.decryptionKey.free()}}function oa(e,t){return aa.apply(this,arguments)}function aa(){return(aa=(0,s.A)((function*(e,t){try{var r=t?(0,Ao.RR)("/room_keys/version/$version",{$version:t}):"/room_keys/version";return yield e.authedRequest(Io.IT.Get,r,void 0,void 0,{prefix:Io.iD.V3})}catch(e){if("M_NOT_FOUND"===e.errcode)return null;throw e}}))).apply(this,arguments)}function ca(e,t){return t.auth_data.public_key===e.megolmV1PublicKey.publicKeyBase64}function ga(e){var t=0;for(var{sessions:r}of Object.values(e.rooms))t+=Object.keys(r).length;return t}var ua=r(5942),da=r(4575);class la{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.outgoingRequestProcessor=r,(0,i.A)(this,"stopped",!1),(0,i.A)(this,"outgoingRequestLoopRunning",!1),(0,i.A)(this,"nextLoopDeferred",void 0)}stop(){this.stopped=!0}doProcessOutgoingRequests(){this.nextLoopDeferred||(this.nextLoopDeferred=(0,Ao.v6)());var e=this.nextLoopDeferred.promise;return this.outgoingRequestLoopRunning||this.outgoingRequestLoop().catch((e=>{this.logger.error("Uncaught error in outgoing request loop",e)})),e}outgoingRequestLoop(){var e=this;return(0,s.A)((function*(){if(e.outgoingRequestLoopRunning)throw new Error("Cannot run two outgoing request loops");e.outgoingRequestLoopRunning=!0;try{for(;!e.stopped&&e.nextLoopDeferred;){var t=e.nextLoopDeferred;e.nextLoopDeferred=void 0,yield e.processOutgoingRequests().then(t.resolve,t.reject)}}finally{e.outgoingRequestLoopRunning=!1}e.nextLoopDeferred&&e.nextLoopDeferred.reject(new Error("OutgoingRequestsManager was stopped"))}))()}processOutgoingRequests(){var e=this;return(0,s.A)((function*(){if(!e.stopped){var t,r=yield e.olmMachine.outgoingRequests(),n=function*(t){if(e.stopped)return{v:void 0};try{yield(0,Ao.NQ)(e.logger,"Make outgoing request ".concat(t.type),(0,s.A)((function*(){yield e.outgoingRequestProcessor.makeOutgoingRequest(t)})))}catch(r){e.logger.error("Failed to process outgoing request ".concat(t.type,": ").concat(r))}};for(var i of r)if(t=yield*n(i))return t.v}}))()}}var pa=5e3,wa=function(e){return e.MISSING_DECRYPTION_KEY="MISSING_DECRYPTION_KEY",e.NETWORK_ERROR="NETWORK_ERROR",e.STOPPED="STOPPED",e}(wa||{});class ya extends Error{constructor(e){super("Failed to get key from backup: ".concat(e)),this.code=e,this.name="KeyDownloadError"}}class ba extends Error{constructor(e){super("Failed to get key from backup: rate limited"),this.retryMillis=e,this.name="KeyDownloadRateLimitError"}}class ha{constructor(e,t,r,n){this.olmMachine=t,this.http=r,this.backupManager=n,(0,i.A)(this,"stopped",!1),(0,i.A)(this,"configuration",null),(0,i.A)(this,"sessionLastCheckAttemptedTime",new Map),(0,i.A)(this,"logger",void 0),(0,i.A)(this,"downloadLoopRunning",!1),(0,i.A)(this,"queuedRequests",[]),(0,i.A)(this,"hasConfigurationProblem",!1),(0,i.A)(this,"currentBackupVersionCheck",null),(0,i.A)(this,"onBackupStatusChanged",(()=>{this.hasConfigurationProblem=!1,this.configuration=null,this.getOrCreateBackupConfiguration().then((e=>{e&&this.downloadKeysLoop()}))})),this.logger=e.getChild("[PerSessionKeyBackupDownloader]"),n.on(Mo.cr.KeyBackupStatus,this.onBackupStatusChanged),n.on(Mo.cr.KeyBackupFailed,this.onBackupStatusChanged),n.on(Mo.cr.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isKeyBackupDownloadConfigured(){return null!==this.configuration}getServerBackupInfo(){var e=this;return(0,s.A)((function*(){return yield e.backupManager.getServerBackupInfo()}))()}onDecryptionKeyMissingError(e,t){this.isAlreadyInQueue(e,t)?this.logger.trace("Not checking key backup for session ".concat(t," as it is already queued")):this.wasRequestedRecently(t)?this.logger.trace("Not checking key backup for session ".concat(t," as it was already requested recently")):(this.queuedRequests.push({roomId:e,megolmSessionId:t}),this.downloadKeysLoop())}stop(){this.stopped=!0,this.backupManager.off(Mo.cr.KeyBackupStatus,this.onBackupStatusChanged),this.backupManager.off(Mo.cr.KeyBackupFailed,this.onBackupStatusChanged),this.backupManager.off(Mo.cr.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isAlreadyInQueue(e,t){return this.queuedRequests.some((r=>r.roomId==e&&r.megolmSessionId==t))}markAsNotFoundInBackup(e){var t=Date.now();this.sessionLastCheckAttemptedTime.set(e,t),this.sessionLastCheckAttemptedTime.size>100&&(this.sessionLastCheckAttemptedTime=new Map(Array.from(this.sessionLastCheckAttemptedTime).filter(((e,r)=>Math.max(t-r,0)<pa))))}wasRequestedRecently(e){var t=this.sessionLastCheckAttemptedTime.get(e);return!!t&&Math.max(Date.now()-t,0)<pa}getBackupDecryptionKey(){var e=this;return(0,s.A)((function*(){try{return yield e.olmMachine.getBackupKeys()}catch(e){return null}}))()}requestRoomKeyFromBackup(e,t,r){var n=this;return(0,s.A)((function*(){var i=(0,Ao.RR)("/room_keys/keys/$roomId/$sessionId",{$roomId:t,$sessionId:r});return yield n.http.authedRequest(Io.IT.Get,i,{version:e},void 0,{prefix:Io.iD.V3})}))()}downloadKeysLoop(){var e=this;return(0,s.A)((function*(){if(!e.downloadLoopRunning&&!e.hasConfigurationProblem){e.downloadLoopRunning=!0;try{for(;e.queuedRequests.length>0;){var t=e.queuedRequests[0];try{var r=yield e.getOrCreateBackupConfiguration();if(!r)return void(e.downloadLoopRunning=!1);var n=yield e.queryKeyBackup(t.roomId,t.megolmSessionId,r);if(e.stopped)return;try{yield e.decryptAndImport(t,n,r)}catch(r){e.logger.error("Error while decrypting and importing key backup for session ".concat(t.megolmSessionId),r)}e.queuedRequests.shift()}catch(r){if(r instanceof ya)switch(r.code){case wa.MISSING_DECRYPTION_KEY:e.markAsNotFoundInBackup(t.megolmSessionId),e.queuedRequests.shift();break;case wa.NETWORK_ERROR:yield(0,Ao.yy)(pa);break;case wa.STOPPED:return void(e.downloadLoopRunning=!1)}else r instanceof ba&&(yield(0,Ao.yy)(r.retryMillis))}}}finally{e.downloadLoopRunning=!1}}}))()}queryKeyBackup(e,t,r){var n=this;return(0,s.A)((function*(){if(n.logger.debug("Checking key backup for session ".concat(t)),n.stopped)throw new ya(wa.STOPPED);try{var i=yield n.requestRoomKeyFromBackup(r.backupVersion,e,t);return n.logger.debug("Got key from backup for sessionId:".concat(t)),i}catch(e){if(n.stopped)throw new ya(wa.STOPPED);if(n.logger.info("No luck requesting key backup for session ".concat(t,": ").concat(e)),e instanceof Io.up){if("M_NOT_FOUND"==e.data.errcode)throw new ya(wa.MISSING_DECRYPTION_KEY);if(e.isRateLimitError()){var s;try{var _;s=null!==(_=e.getRetryAfterMs())&&void 0!==_?_:void 0}catch(e){n.logger.warn("Error while retrieving a rate-limit retry delay",e)}throw s&&s>0&&n.logger.info("Rate limited by server, waiting ".concat(s,"ms")),new ba(null!=s?s:pa)}}throw new ya(wa.NETWORK_ERROR)}}))()}decryptAndImport(e,t,r){var n=this;return(0,s.A)((function*(){var i={[e.megolmSessionId]:t},s=yield r.decryptor.decryptSessions(i);for(var _ of s)_.room_id=e.roomId;yield n.backupManager.importBackedUpRoomKeys(s,r.backupVersion)}))()}getOrCreateBackupConfiguration(){var e=this;return(0,s.A)((function*(){if(e.configuration)return e.configuration;if(e.hasConfigurationProblem)return null;if(null!=e.currentBackupVersionCheck)return e.logger.debug("Already checking server version, use current promise"),yield e.currentBackupVersionCheck;e.currentBackupVersionCheck=e.internalCheckFromServer();try{return yield e.currentBackupVersionCheck}finally{e.currentBackupVersionCheck=null}}))()}internalCheckFromServer(){var e=this;return(0,s.A)((function*(){var t,r,n,i,s=null;try{s=yield e.backupManager.getServerBackupInfo()}catch(t){return e.logger.debug("Backup: error while checking server version: ".concat(t)),e.hasConfigurationProblem=!0,null}if(e.logger.debug("Got current backup version from server: ".concat(null===(t=s)||void 0===t?void 0:t.version)),"m.megolm_backup.v1.curve25519-aes-sha2"!=(null===(r=s)||void 0===r?void 0:r.algorithm))return e.logger.info("Unsupported algorithm ".concat(null===(i=s)||void 0===i?void 0:i.algorithm)),e.hasConfigurationProblem=!0,null;if(null===(n=s)||void 0===n||!n.version)return e.logger.info("No current key backup"),e.hasConfigurationProblem=!0,null;var _=yield e.backupManager.getActiveBackupVersion();if(null==_||s.version!=_)return e.logger.info("The current backup version on the server (".concat(s.version,") is not trusted. Version we are currently backing up to: ").concat(_)),e.hasConfigurationProblem=!0,null;var o=yield e.getBackupDecryptionKey();if(null==o||!o.decryptionKey)return e.logger.debug("Not checking key backup for session (no decryption key)"),e.hasConfigurationProblem=!0,null;if(_!=o.backupVersion)return e.logger.debug("Version for which we have a decryption key (".concat(o.backupVersion,") doesn't match the version we are backing up to (").concat(_,")")),e.hasConfigurationProblem=!0,null;if(s.auth_data.public_key!=o.decryptionKey.megolmV1PublicKey.publicKeyBase64)return e.logger.debug("Key backup on server does not match our decryption key"),e.hasConfigurationProblem=!0,null;var a=e.backupManager.createBackupDecryptor(o.decryptionKey);return e.hasConfigurationProblem=!1,e.configuration={decryptor:a,backupVersion:_},e.configuration}))()}}function fa(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function va(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fa(Object(r),!0).forEach((function(t){(0,i.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fa(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ma=[Xo.Sas,Xo.ScanQrCode,Xo.ShowQrCode,Xo.Reciprocate];class ka extends Do.X{constructor(e,t,r,n,s,_,o){super(),this.logger=e,this.olmMachine=t,this.http=r,this.userId=n,this.secretStorage=_,this.cryptoCallbacks=o,(0,i.A)(this,"RECOVERY_KEY_DERIVATION_ITERATIONS",5e5),(0,i.A)(this,"_trustCrossSignedDevices",!0),(0,i.A)(this,"deviceIsolationMode",new Mo.ux(!1)),(0,i.A)(this,"stopped",!1),(0,i.A)(this,"roomEncryptors",{}),(0,i.A)(this,"eventDecryptor",void 0),(0,i.A)(this,"keyClaimManager",void 0),(0,i.A)(this,"outgoingRequestProcessor",void 0),(0,i.A)(this,"crossSigningIdentity",void 0),(0,i.A)(this,"backupManager",void 0),(0,i.A)(this,"outgoingRequestsManager",void 0),(0,i.A)(this,"perSessionBackupDownloader",void 0),(0,i.A)(this,"dehydratedDeviceManager",void 0),(0,i.A)(this,"reemitter",new Yo.Q(this)),(0,i.A)(this,"globalBlacklistUnverifiedDevices",!1),(0,i.A)(this,"_supportedVerificationMethods",ma),this.outgoingRequestProcessor=new Uo(t,r),this.outgoingRequestsManager=new la(this.logger,t,this.outgoingRequestProcessor),this.keyClaimManager=new Po(t,this.outgoingRequestProcessor),this.backupManager=new ia(t,r,this.outgoingRequestProcessor),this.perSessionBackupDownloader=new ha(this.logger,this.olmMachine,this.http,this.backupManager),this.dehydratedDeviceManager=new Vo(this.logger,t,r,this.outgoingRequestProcessor,_),this.eventDecryptor=new Sa(this.logger,t,this.perSessionBackupDownloader),this.reemitter.reEmit(this.backupManager,[Mo.cr.KeyBackupStatus,Mo.cr.KeyBackupSessionsRemaining,Mo.cr.KeyBackupFailed,Mo.cr.KeyBackupDecryptionKeyCached]),this.reemitter.reEmit(this.dehydratedDeviceManager,[Mo.cr.DehydratedDeviceCreated,Mo.cr.DehydratedDeviceUploaded,Mo.cr.RehydrationStarted,Mo.cr.RehydrationProgress,Mo.cr.RehydrationCompleted,Mo.cr.RehydrationError,Mo.cr.DehydrationKeyCached,Mo.cr.DehydratedDeviceRotationError]),this.crossSigningIdentity=new Lo(t,this.outgoingRequestProcessor,_),this.checkKeyBackupAndEnable()}getOlmMachineOrThrow(){if(this.stopped)throw new da.LA;return this.olmMachine}set globalErrorOnUnknownDevices(e){}get globalErrorOnUnknownDevices(){return!1}stop(){this.stopped||(this.stopped=!0,this.keyClaimManager.stop(),this.backupManager.stop(),this.outgoingRequestsManager.stop(),this.perSessionBackupDownloader.stop(),this.dehydratedDeviceManager.stop(),this.olmMachine.close())}encryptEvent(e,t){var r=this;return(0,s.A)((function*(){var t=e.getRoomId(),n=r.roomEncryptors[t];if(!n)throw new Error("Cannot encrypt event in unconfigured room ".concat(t));yield n.encryptEvent(e,r.globalBlacklistUnverifiedDevices,r.deviceIsolationMode)}))()}decryptEvent(e){var t=this;return(0,s.A)((function*(){if(!e.getRoomId())throw new Error("to-device event was not decrypted in preprocessToDeviceMessages");return yield t.eventDecryptor.attemptEventDecryption(e,t.deviceIsolationMode)}))()}getBackupDecryptor(e,t){var r=this;return(0,s.A)((function*(){if(!(t instanceof Uint8Array))throw new Error("getBackupDecryptor: expects Uint8Array");if("m.megolm_backup.v1.curve25519-aes-sha2"!=e.algorithm)throw new Error("getBackupDecryptor: Unsupported algorithm ".concat(e.algorithm));var n=_e.fromBase64((0,qo.WG)(t));if(!ca(n,e))throw new Error("getBackupDecryptor: key backup on server does not match the decryption key");return r.backupManager.createBackupDecryptor(n)}))()}importBackedUpRoomKeys(e,t,r){var n=this;return(0,s.A)((function*(){return yield n.backupManager.importBackedUpRoomKeys(e,t,r)}))()}getVersion(){var e=q();return"Rust SDK ".concat(e.matrix_sdk_crypto," (").concat(e.git_sha,"), Vodozemac ").concat(e.vodozemac)}setDeviceIsolationMode(e){this.deviceIsolationMode=e}isEncryptionEnabledInRoom(e){var t=this;return(0,s.A)((function*(){var r=yield t.olmMachine.getRoomSettings(new yr(e));return Boolean(null==r?void 0:r.algorithm)}))()}getOwnDeviceKeys(){var e=this;return(0,s.A)((function*(){var t=e.olmMachine.identityKeys;return{ed25519:t.ed25519.toBase64(),curve25519:t.curve25519.toBase64()}}))()}prepareToEncrypt(e){var t=this.roomEncryptors[e.roomId];t&&t.prepareForEncryption(this.globalBlacklistUnverifiedDevices,this.deviceIsolationMode)}forceDiscardSession(e){var t;return null===(t=this.roomEncryptors[e])||void 0===t?void 0:t.forceDiscardSession()}exportRoomKeys(){var e=this;return(0,s.A)((function*(){var t=yield e.olmMachine.exportRoomKeys((()=>!0));return JSON.parse(t)}))()}exportRoomKeysAsJson(){var e=this;return(0,s.A)((function*(){return yield e.olmMachine.exportRoomKeys((()=>!0))}))()}importRoomKeys(e,t){var r=this;return(0,s.A)((function*(){return yield r.backupManager.importRoomKeys(e,t)}))()}importRoomKeysAsJson(e,t){var r=this;return(0,s.A)((function*(){return yield r.backupManager.importRoomKeysAsJson(e,t)}))()}userHasCrossSigningKeys(){var e=arguments,t=this;return(0,s.A)((function*(){var r,n=e.length>0&&void 0!==e[0]?e[0]:t.userId,i=e.length>1&&void 0!==e[1]&&e[1],s=yield t.olmMachine.trackedUsers();for(var _ of s)if(n===_.toString()){r=_;break}if(void 0!==r){if(n===t.userId){var o=t.olmMachine.queryKeysForUsers([r.clone()]);yield t.outgoingRequestProcessor.makeOutgoingRequest(o)}var a=yield t.olmMachine.getIdentity(r);return null==a||a.free(),void 0!==a}if(i){var c,g=null===(c=(yield t.downloadDeviceList(new Set([n]))).master_keys)||void 0===c?void 0:c[n];return!!g&&Boolean(Object.values(g.keys)[0])}return!1}))()}getUserDeviceInfo(e){var t=arguments,r=this;return(0,s.A)((function*(){var n=t.length>1&&void 0!==t[1]&&t[1],i=new Map,s=yield r.getOlmMachineOrThrow().trackedUsers(),_=new Set;s.forEach((e=>_.add(e.toString())));var o=new Set;for(var a of e)_.has(a)?i.set(a,yield r.getUserDevices(a)):o.add(a);if(n&&o.size>=1){var c=yield r.downloadDeviceList(o);Object.entries(c.device_keys).forEach((e=>{var[t,r]=e;return i.set(t,function(e){return new Map(Object.entries(e).map((e=>{var[t,r]=e;return[t,zo(r)]})))}(r))}))}return i}))()}getUserDevices(e){var t=this;return(0,s.A)((function*(){var r=new rn(e),n=yield t.olmMachine.getUserDevices(r,1);try{var i=n.devices();try{return new Map(i.map((e=>[e.deviceId.toString(),xo(e,r)])))}finally{i.forEach((e=>e.free()))}}finally{n.free()}}))()}downloadDeviceList(e){var t=this;return(0,s.A)((function*(){var r={device_keys:{}};return e.forEach((e=>r.device_keys[e]=[])),yield t.http.authedRequest(Io.IT.Post,"/_matrix/client/v3/keys/query",void 0,r,{prefix:""})}))()}getTrustCrossSignedDevices(){return this._trustCrossSignedDevices}setTrustCrossSignedDevices(e){this._trustCrossSignedDevices=e}setDeviceVerified(e,t){var r=arguments,n=this;return(0,s.A)((function*(){var i=!(r.length>2&&void 0!==r[2])||r[2],s=yield n.olmMachine.getDevice(new rn(e),new Le(t));if(!s)throw new Error("Unknown device ".concat(e,"|").concat(t));try{yield s.setLocalTrust(i?L.Verified:L.Unset)}finally{s.free()}}))()}crossSignDevice(e){var t=this;return(0,s.A)((function*(){var r=yield t.olmMachine.getDevice(new rn(t.userId),new Le(e));if(!r)throw new Error("Unknown device ".concat(e));try{var n=yield r.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(n)}finally{r.free()}}))()}getDeviceVerificationStatus(e,t){var r=this;return(0,s.A)((function*(){var n=yield r.olmMachine.getDevice(new rn(e),new Le(t));if(!n)return null;try{return new Mo.wc({signedByOwner:n.isCrossSignedByOwner(),crossSigningVerified:n.isCrossSigningTrusted(),localVerified:n.isLocallyTrusted(),trustCrossSignedDevices:r._trustCrossSignedDevices})}finally{n.free()}}))()}getUserVerificationStatus(e){var t=this;return(0,s.A)((function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new rn(e));if(void 0===r)return new Mo.L0(!1,!1,!1);var n=r.isVerified(),i=r.wasPreviouslyVerified(),s=r instanceof zt&&r.identityNeedsUserApproval();return r.free(),new Mo.L0(n,i,!1,s)}))()}pinCurrentUserIdentity(e){var t=this;return(0,s.A)((function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new rn(e));if(void 0===r)throw new Error("Cannot pin identity of unknown user");if(r instanceof Gt)throw new Error("Cannot pin identity of own user");yield r.pinCurrentMasterKey()}))()}withdrawVerificationRequirement(e){var t=this;return(0,s.A)((function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new rn(e));if(void 0===r)throw new Error("Cannot withdraw verification of unknown user");yield r.withdrawVerification()}))()}isCrossSigningReady(){var e=this;return(0,s.A)((function*(){var{privateKeysInSecretStorage:t,privateKeysCachedLocally:r}=yield e.getCrossSigningStatus(),n=Boolean(r.masterKey)&&Boolean(r.selfSigningKey)&&Boolean(r.userSigningKey),i=yield e.getOwnIdentity();return!(null==i||!i.isVerified())&&(n||t)}))()}getCrossSigningKeyId(){var e=arguments,t=this;return(0,s.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:Mo.nX.Master,n=yield t.olmMachine.getIdentity(new rn(t.userId));if(!n)return null;try{var i,s=yield t.olmMachine.crossSigningStatus();if(!(s.hasMaster&&s.hasUserSigning&&s.hasSelfSigning))return null;if(!n.isVerified())return null;switch(r){case Mo.nX.Master:i=n.masterKey;break;case Mo.nX.SelfSigning:i=n.selfSigningKey;break;case Mo.nX.UserSigning:i=n.userSigningKey;break;default:return null}var _=JSON.parse(i);return Object.values(_.keys)[0]}finally{n.free()}}))()}bootstrapCrossSigning(e){var t=this;return(0,s.A)((function*(){yield t.crossSigningIdentity.bootstrapCrossSigning(e)}))()}isSecretStorageReady(){var e=this;return(0,s.A)((function*(){var t=["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"];return null!=(yield e.backupManager.getActiveBackupVersion())&&t.push("m.megolm_backup.v1"),Qo(e.secretStorage,t)}))()}bootstrapSecretStorage(){var e=arguments,t=this;return(0,s.A)((function*(){var{createSecretStorageKey:r,setupNewSecretStorage:n,setupNewKeyBackup:i}=e.length>0&&void 0!==e[0]?e[0]:{},s=n||!(yield t.secretStorageHasAESKey());if(s){if(!r)throw new Error("unable to create a new secret storage key, createSecretStorageKey is not set");t.logger.info("bootstrapSecretStorage: creating new secret storage key");var _=yield r();if(!_)throw new Error("createSecretStorageKey() callback did not return a secret storage key");yield t.addSecretStorageKeyToSecretStorage(_)}var o=yield t.olmMachine.exportCrossSigningKeys();!(o&&void 0!==o.masterKey&&void 0!==o.self_signing_key&&void 0!==o.userSigningKey)||!s&&(yield Wo(t.secretStorage))||(t.logger.info("bootstrapSecretStorage: cross-signing keys not yet exported; doing so now."),yield t.secretStorage.store("m.cross_signing.master",o.masterKey),yield t.secretStorage.store("m.cross_signing.user_signing",o.userSigningKey),yield t.secretStorage.store("m.cross_signing.self_signing",o.self_signing_key)),i?yield t.resetKeyBackup():yield t.saveBackupKeyToStorage()}))()}saveBackupKeyToStorage(){var e=this;return(0,s.A)((function*(){var t=yield e.backupManager.getServerBackupInfo();if(t&&t.version){var r=yield e.olmMachine.getBackupKeys();if(r.decryptionKey)if(ca(r.decryptionKey,t)){var n=r.decryptionKey.toBase64();yield e.secretStorage.store("m.megolm_backup.v1",n)}else Ko.v.info("Not saving backup key to secret storage: decryption key does not match backup info");else Ko.v.info("Not saving backup key to secret storage: no backup key")}else Ko.v.info("Not saving backup key to secret storage: no backup info")}))()}addSecretStorageKeyToSecretStorage(e){var t=this;return(0,s.A)((function*(){var r,n,i,s,_=yield t.secretStorage.addKey(jo.SECRET_STORAGE_ALGORITHM_V1_AES,{passphrase:null===(r=e.keyInfo)||void 0===r?void 0:r.passphrase,name:null===(n=e.keyInfo)||void 0===n?void 0:n.name,key:e.privateKey});yield t.secretStorage.setDefaultKeyId(_.keyId),null===(i=(s=t.cryptoCallbacks).cacheSecretStorageKey)||void 0===i||i.call(s,_.keyId,_.keyInfo,e.privateKey)}))()}secretStorageHasAESKey(){var e=this;return(0,s.A)((function*(){var t=yield e.secretStorage.getKey();if(!t)return!1;var[,r]=t;return r.algorithm===jo.SECRET_STORAGE_ALGORITHM_V1_AES}))()}getCrossSigningStatus(){var e=this;return(0,s.A)((function*(){var t=yield e.getOlmMachineOrThrow().getIdentity(new rn(e.userId)),r=Boolean(null==t?void 0:t.masterKey)&&Boolean(null==t?void 0:t.selfSigningKey)&&Boolean(null==t?void 0:t.userSigningKey);null==t||t.free();var n=yield Wo(e.secretStorage),i=yield e.getOlmMachineOrThrow().crossSigningStatus();return{publicKeysOnDevice:r,privateKeysInSecretStorage:n,privateKeysCachedLocally:{masterKey:Boolean(null==i?void 0:i.hasMaster),userSigningKey:Boolean(null==i?void 0:i.hasUserSigning),selfSigningKey:Boolean(null==i?void 0:i.hasSelfSigning)}}}))()}createRecoveryKeyFromPassphrase(e){var t=this;return(0,s.A)((function*(){if(e){var r=(0,ua.US)(32),n=yield(0,Mo.wn)(e,r,t.RECOVERY_KEY_DERIVATION_ITERATIONS);return{keyInfo:{passphrase:{algorithm:"m.pbkdf2",iterations:t.RECOVERY_KEY_DERIVATION_ITERATIONS,salt:r}},privateKey:n,encodedPrivateKey:(0,Mo.jS)(n)}}var i=new Uint8Array(32);return globalThis.crypto.getRandomValues(i),{privateKey:i,encodedPrivateKey:(0,Mo.jS)(i)}}))()}getEncryptionInfoForEvent(e){var t=this;return(0,s.A)((function*(){return t.eventDecryptor.getEncryptionInfoForEvent(e)}))()}getVerificationRequestsToDeviceInProgress(e){return this.olmMachine.getVerificationRequests(new rn(e)).filter((e=>void 0===e.roomId)).map((e=>new $o(this.olmMachine,e,this.outgoingRequestProcessor,this._supportedVerificationMethods)))}findVerificationRequestDMInProgress(e,t){if(!t)throw new Error("missing userId");var r=this.olmMachine.getVerificationRequests(new rn(t)).find((t=>{var r;return(null===(r=t.roomId)||void 0===r?void 0:r.toString())===e}));if(r)return new $o(this.olmMachine,r,this.outgoingRequestProcessor,this._supportedVerificationMethods)}requestVerificationDM(e,t){var r=this;return(0,s.A)((function*(){var n=yield r.olmMachine.getIdentity(new rn(e));if(!n)throw new Error("unknown userId ".concat(e));try{var i=r._supportedVerificationMethods.map((e=>na(e))),s=yield n.verificationRequestContent(i),_=yield r.sendVerificationRequestContent(t,s),o=yield n.requestVerification(new yr(t),new yt(_),i);return new $o(r.olmMachine,o,r.outgoingRequestProcessor,r._supportedVerificationMethods)}finally{n.free()}}))()}sendVerificationRequestContent(e,t){var r=this;return(0,s.A)((function*(){var n=(0,ua.US)(32),{event_id:i}=yield r.http.authedRequest(Io.IT.Put,"/_matrix/client/v3/rooms/".concat(encodeURIComponent(e),"/send/m.room.message/").concat(encodeURIComponent(n)),void 0,t,{prefix:""});return i}))()}setSupportedVerificationMethods(e){this._supportedVerificationMethods=null!=e?e:ma}requestOwnUserVerification(){var e=this;return(0,s.A)((function*(){var t=yield e.olmMachine.getIdentity(new rn(e.userId));if(void 0===t)throw new Error("cannot request verification for this device when there is no existing cross-signing key");try{var[r,n]=yield t.requestVerification(e._supportedVerificationMethods.map(na));return yield e.outgoingRequestProcessor.makeOutgoingRequest(n),new $o(e.olmMachine,r,e.outgoingRequestProcessor,e._supportedVerificationMethods)}finally{t.free()}}))()}requestDeviceVerification(e,t){var r=this;return(0,s.A)((function*(){var n=yield r.olmMachine.getDevice(new rn(e),new Le(t));if(!n)throw new Error("Not a known device");try{var[i,s]=n.requestVerification(r._supportedVerificationMethods.map(na));return yield r.outgoingRequestProcessor.makeOutgoingRequest(s),new $o(r.olmMachine,i,r.outgoingRequestProcessor,r._supportedVerificationMethods)}finally{n.free()}}))()}getSessionBackupPrivateKey(){var e=this;return(0,s.A)((function*(){var t=yield e.olmMachine.getBackupKeys();return t.decryptionKey?(0,qo.y4)(t.decryptionKey.toBase64()):null}))()}storeSessionBackupPrivateKey(e,t){var r=this;return(0,s.A)((function*(){var n=(0,qo.WG)(e);if(!t)throw new Error("storeSessionBackupPrivateKey: version is required");yield r.backupManager.saveBackupDecryptionKey(_e.fromBase64(n),t)}))()}loadSessionBackupPrivateKeyFromSecretStorage(){var e=this;return(0,s.A)((function*(){var t=yield e.secretStorage.get("m.megolm_backup.v1");if(!t)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: missing decryption key in secret storage");var r=yield e.backupManager.getServerBackupInfo();if(!r||!r.version)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: unable to get backup version");var n=_e.fromBase64(t);if(!ca(n,r))throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: decryption key does not match backup info");yield e.backupManager.saveBackupDecryptionKey(n,r.version)}))()}getActiveSessionBackupVersion(){var e=this;return(0,s.A)((function*(){return yield e.backupManager.getActiveBackupVersion()}))()}getKeyBackupInfo(){var e=this;return(0,s.A)((function*(){return(yield e.backupManager.getServerBackupInfo())||null}))()}isKeyBackupTrusted(e){var t=this;return(0,s.A)((function*(){return yield t.backupManager.isKeyBackupTrusted(e)}))()}checkKeyBackupAndEnable(){var e=this;return(0,s.A)((function*(){return yield e.backupManager.checkKeyBackupAndEnable(!0)}))()}deleteKeyBackupVersion(e){var t=this;return(0,s.A)((function*(){yield t.backupManager.deleteKeyBackupVersion(e)}))()}resetKeyBackup(){var e=this;return(0,s.A)((function*(){var t=yield e.backupManager.setupKeyBackup((t=>e.signObject(t)));(yield e.secretStorageHasAESKey())&&(yield e.secretStorage.store("m.megolm_backup.v1",t.decryptionKey.toBase64())),e.checkKeyBackupAndEnable()}))()}disableKeyStorage(){var e=this;return(0,s.A)((function*(){var t=yield e.getKeyBackupInfo();null!=t&&t.version?yield e.deleteKeyBackupVersion(t.version):Ko.v.error("Can't delete key backup version: no version available"),yield e.deleteSecretStorage(),yield e.dehydratedDeviceManager.delete()}))()}signObject(e){var t=this;return(0,s.A)((function*(){var r=new Map(Object.entries(e.signatures||{})),n=e.unsigned;delete e.signatures,delete e.unsigned;var i=r.get(t.userId)||{},s=mo.stringify(e),_=yield t.olmMachine.sign(s),o=JSON.parse(_.asJSON());r.set(t.userId,va(va({},i),o[t.userId])),void 0!==n&&(e.unsigned=n),e.signatures=Object.fromEntries(r.entries())}))()}restoreKeyBackupWithPassphrase(e,t){var r=this;return(0,s.A)((function*(){var n=yield r.backupManager.getServerBackupInfo();if(null==n||!n.version)throw new Error("No backup info available");var i=yield function(e,t){if(!e.private_key_salt||!e.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return(0,Mo.wn)(t,e.private_key_salt,e.private_key_iterations,e.private_key_bits)}(n.auth_data,e);return yield r.storeSessionBackupPrivateKey(i,n.version),r.restoreKeyBackup(t)}))()}restoreKeyBackup(e){var t=this;return(0,s.A)((function*(){var r=yield t.olmMachine.getBackupKeys(),{decryptionKey:n,backupVersion:i}=r;if(!n||!i)throw new Error("No decryption key found in crypto store");var s=(0,qo.y4)(n.toBase64()),_=yield t.backupManager.requestKeyBackupVersion(i);if(!_)throw new Error("Backup version to restore ".concat(i," not found on server"));var o=yield t.getBackupDecryptor(_,s);try{var a;return null==e||null===(a=e.progressCallback)||void 0===a||a.call(e,{stage:Mo.wF.Fetch}),yield t.backupManager.restoreKeyBackup(i,o,e)}finally{o.free()}}))()}isDehydrationSupported(){var e=this;return(0,s.A)((function*(){return yield e.dehydratedDeviceManager.isSupported()}))()}startDehydration(){var e=arguments,t=this;return(0,s.A)((function*(){var r=e.length>0&&void 0!==e[0]?e[0]:{};if(!(yield t.isCrossSigningReady())||!(yield t.isSecretStorageReady()))throw new Error("Device dehydration requires cross-signing and secret storage to be set up");return yield t.dehydratedDeviceManager.start(r||{})}))()}importSecretsBundle(e){var t=this;return(0,s.A)((function*(){var r=qr.from_json(e);yield t.getOlmMachineOrThrow().importSecretsBundle(r)}))()}exportSecretsBundle(){var e=this;return(0,s.A)((function*(){var t=yield e.getOlmMachineOrThrow().exportSecretsBundle(),r=t.to_json();return t.free(),r}))()}encryptToDeviceMessages(e,t,r){var n=this;return(0,s.A)((function*(){var i=new Ko.T(n.logger,"encryptToDeviceMessages"),_=new Set(t.map((e=>{var{userId:t}=e;return t})));yield n.keyClaimManager.ensureSessionsForUsers(i,Array.from(_).map((e=>new rn(e))));var o={batch:[],eventType:Co.Bx.RoomMessageEncrypted};return yield Promise.all(t.map(function(){var t=(0,s.A)((function*(t){var{userId:i,deviceId:s}=t,_=yield n.olmMachine.getDevice(new rn(i),new Le(s));if(_){var a=JSON.parse(yield _.encryptToDeviceEvent(e,r));o.batch.push({deviceId:s,userId:i,payload:a})}else n.logger.warn("encryptToDeviceMessages: unknown device ".concat(i,":").concat(s))}));return function(e){return t.apply(this,arguments)}}())),o}))()}resetEncryption(e){var t=this;return(0,s.A)((function*(){t.logger.debug("resetEncryption: resetting encryption"),t.dehydratedDeviceManager.delete(),yield t.backupManager.deleteAllKeyBackupVersions(),yield t.deleteSecretStorage(),yield t.crossSigningIdentity.bootstrapCrossSigning({setupNewCrossSigning:!0,authUploadDeviceSigningKeys:e}),yield t.resetKeyBackup(),t.logger.debug("resetEncryption: ended")}))()}deleteSecretStorage(){var e=this;return(0,s.A)((function*(){yield e.secretStorage.store("m.cross_signing.master",null),yield e.secretStorage.store("m.cross_signing.self_signing",null),yield e.secretStorage.store("m.cross_signing.user_signing",null),yield e.secretStorage.store("m.megolm_backup.v1",null);var t=yield e.secretStorage.getDefaultKeyId();t&&(yield e.secretStorage.store("m.secret_storage.key.".concat(t),null)),yield e.secretStorage.setDefaultKeyId(null)}))()}receiveSyncChanges(e){var t=this;return(0,s.A)((function*(){var{events:r,oneTimeKeysCounts:n=new Map,unusedFallbackKeys:i,devices:_=new $e}=e,o=yield(0,Ao.NQ)(Ko.v,"receiveSyncChanges",(0,s.A)((function*(){return yield t.olmMachine.receiveSyncChanges(r?JSON.stringify(r):"[]",_,n,i)})));return JSON.parse(o)}))()}preprocessToDeviceMessages(e){var t=this;return(0,s.A)((function*(){var r=yield t.receiveSyncChanges({events:e});for(var n of r)if(n.type===Co.Bx.KeyVerificationRequest){var i=n.sender,s=n.content.transaction_id;s&&i&&t.onIncomingKeyVerificationRequest(i,s)}return r}))()}processKeyCounts(e,t){var r=this;return(0,s.A)((function*(){var n=e&&new Map(Object.entries(e)),i=t&&new Set(t);void 0===n&&void 0===i||(yield r.receiveSyncChanges({oneTimeKeysCounts:n,unusedFallbackKeys:i}))}))()}processDeviceLists(e){var t=this;return(0,s.A)((function*(){var r,n,i=new $e(null===(r=e.changed)||void 0===r?void 0:r.map((e=>new rn(e))),null===(n=e.left)||void 0===n?void 0:n.map((e=>new rn(e))));yield t.receiveSyncChanges({devices:i})}))()}onCryptoEvent(e,t){var r=this;return(0,s.A)((function*(){var n=t.getContent(),i=new Or;if("m.megolm.v1.aes-sha2"===n.algorithm){i.algorithm=z.MegolmV1AesSha2;try{i.sessionRotationPeriodMs=n.rotation_period_ms,i.sessionRotationPeriodMessages=n.rotation_period_msgs,yield r.olmMachine.setRoomSettings(new yr(e.roomId),i)}catch(t){return void r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event which caused error: ").concat(t))}var s=r.roomEncryptors[e.roomId];s?s.onCryptoEvent(n):r.roomEncryptors[e.roomId]=new Eo(r.olmMachine,r.keyClaimManager,r.outgoingRequestsManager,e,n)}else r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event with invalid algorithm ").concat(n.algorithm))}))()}onSyncCompleted(e){this.outgoingRequestsManager.doProcessOutgoingRequests().catch((e=>{this.logger.warn("onSyncCompleted: Error processing outgoing requests",e)}))}markAllTrackedUsersAsDirty(){var e=this;return(0,s.A)((function*(){yield e.olmMachine.markAllTrackedUsersAsDirty()}))()}onIncomingKeyVerificationRequest(e,t){var r=this.olmMachine.getVerificationRequest(new rn(e),t);r?this.emit(Mo.cr.VerificationRequestReceived,new $o(this.olmMachine,r,this.outgoingRequestProcessor,this._supportedVerificationMethods)):this.logger.info("Ignoring just-received verification request ".concat(t," which did not start a rust-side verification"))}onRoomMembership(e,t,r){var n=this.roomEncryptors[e.getRoomId()];n&&n.onRoomMembership(t)}onRoomKeysUpdated(e){var t=this;return(0,s.A)((function*(){for(var r of e)t.onRoomKeyUpdated(r);t.backupManager.maybeUploadKey()}))()}onRoomKeyUpdated(e){var t=this;if(!this.stopped){this.logger.debug("Got update for session ".concat(e.sessionId," from sender ").concat(e.senderKey.toBase64()," in ").concat(e.roomId.toString()));var r=this.eventDecryptor.getEventsPendingRoomKey(e.roomId.toString(),e.sessionId);if(0!==r.length){this.logger.debug("Retrying decryption on events:",r.map((e=>"".concat(e.getId()))));var n=function(e){e.attemptDecryption(t,{isRetry:!0}).catch((r=>{t.logger.info("Still unable to decrypt event ".concat(e.getId()," after receiving key"))}))};for(var i of r)n(i)}}}onRoomKeysWithheld(e){var t=this;return(0,s.A)((function*(){for(var r of e){t.logger.debug("Got withheld message for session ".concat(r.sessionId," in ").concat(r.roomId.toString()));var n=t.eventDecryptor.getEventsPendingRoomKey(r.roomId.toString(),r.sessionId);if(0===n.length)return;for(var i of(t.logger.debug("Retrying decryption on events:",n.map((e=>"".concat(e.getId())))),n))i.attemptDecryption(t,{isRetry:!0}).catch((e=>{}))}}))()}onUserIdentityUpdated(e){var t=this;return(0,s.A)((function*(){var r=yield t.getUserVerificationStatus(e.toString());t.emit(Mo.cr.UserTrustStatusChanged,e.toString(),r),e.toString()===t.userId&&(t.emit(Mo.cr.KeysChanged,{}),yield t.checkKeyBackupAndEnable())}))()}onDevicesUpdated(e){var t=this;return(0,s.A)((function*(){t.emit(Mo.cr.WillUpdateDevices,e,!1),t.emit(Mo.cr.DevicesUpdated,e,!1)}))()}handleSecretReceived(e,t){var r=this;return(0,s.A)((function*(){return r.logger.debug("onReceiveSecret: Received secret ".concat(e)),"m.megolm_backup.v1"===e&&(yield r.backupManager.handleBackupSecretReceived(t))}))()}checkSecrets(e){var t=this;return(0,s.A)((function*(){var r=yield t.olmMachine.getSecretsFromInbox(e);for(var n of r)if(yield t.handleSecretReceived(e,n))break;yield t.olmMachine.deleteSecretsFromInbox(e)}))()}onLiveEventFromSync(e){var t=this;return(0,s.A)((function*(){if(!e.isState()&&!e.getUnsigned().transaction_id){var r=function(){var r=(0,s.A)((function*(r){(function(e){switch(e.getType()){case Co.Bx.KeyVerificationCancel:case Co.Bx.KeyVerificationDone:case Co.Bx.KeyVerificationMac:case Co.Bx.KeyVerificationStart:case Co.Bx.KeyVerificationKey:case Co.Bx.KeyVerificationReady:case Co.Bx.KeyVerificationAccept:return!0;case Co.Bx.RoomMessage:return e.getContent().msgtype===Co.Wr.KeyVerificationRequest;default:return!1}})(e)&&(yield t.onKeyVerificationEvent(r))}));return function(e){return r.apply(this,arguments)}}();if(e.isDecryptionFailure()||e.isEncrypted()){var n=setTimeout((()=>e.off(So.OQ.Decrypted,i)),3e5),i=(t,s)=>{s||(clearTimeout(n),e.off(So.OQ.Decrypted,i),r(t))};e.on(So.OQ.Decrypted,i)}else yield r(e)}}))()}onKeyVerificationEvent(e){var t=this;return(0,s.A)((function*(){var r=e.getRoomId();if(!r)throw new Error("missing roomId in the event");t.logger.debug("Incoming verification event ".concat(e.getId()," type ").concat(e.getType()," from ").concat(e.getSender())),yield t.olmMachine.receiveVerificationEvent(JSON.stringify({event_id:e.getId(),type:e.getType(),sender:e.getSender(),state_key:e.getStateKey(),content:e.getContent(),origin_server_ts:e.getTs()}),new yr(r)),e.getType()===Co.Bx.RoomMessage&&e.getContent().msgtype===Co.Wr.KeyVerificationRequest&&t.onIncomingKeyVerificationRequest(e.getSender(),e.getId()),t.outgoingRequestsManager.doProcessOutgoingRequests().catch((e=>{t.logger.warn("onKeyVerificationRequest: Error processing outgoing requests",e)}))}))()}getOwnIdentity(){var e=this;return(0,s.A)((function*(){return yield e.olmMachine.getIdentity(new rn(e.userId))}))()}}class Sa{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.perSessionBackupDownloader=r,(0,i.A)(this,"eventsPendingKey",new Ao.kG((()=>new Ao.kG((()=>new Set)))))}attemptEventDecryption(e,t){var r=this;return(0,s.A)((function*(){var n;switch(r.addEventToPendingList(e),t.kind){case Mo.YH.AllDevicesIsolationMode:n=$.Untrusted;break;case Mo.YH.OnlySignedDevicesIsolationMode:n=$.CrossSignedOrLegacy}try{var i=yield r.olmMachine.decryptRoomEvent(Ra(e),new yr(e.getRoomId()),new Be(n));return r.removeEventFromPendingList(e),{clearEvent:JSON.parse(i.event),claimedEd25519Key:i.senderClaimedEd25519Key,senderCurve25519Key:i.senderCurve25519Key,forwardingCurve25519KeyChain:i.forwardingCurve25519KeyChain}}catch(t){if(!(t instanceof Bt))throw new Ro.O(Mo.RT.UNKNOWN_ERROR,"Unknown error");r.onMegolmDecryptionError(e,t,yield r.perSessionBackupDownloader.getServerBackupInfo())}}))()}onMegolmDecryptionError(e,t,r){var n=e.getWireContent(),i={sender_key:n.sender_key,session_id:n.session_id};if(t.code===P.MissingRoomKey||t.code===P.UnknownMessageIndex){this.perSessionBackupDownloader.onDecryptionKeyMissingError(e.getRoomId(),n.session_id);var s=e.getMembershipAtEvent();if(s&&s!==ko.O.Join&&s!==ko.O.Invite)throw new Ro.O(Mo.RT.HISTORICAL_MESSAGE_USER_NOT_JOINED,"This message was sent when we were not a member of the room.",i);if(e.getTs()<=this.olmMachine.deviceCreationTimeMs)throw null===r?new Ro.O(Mo.RT.HISTORICAL_MESSAGE_NO_KEY_BACKUP,"This message was sent before this device logged in, and there is no key backup on the server.",i):this.perSessionBackupDownloader.isKeyBackupDownloadConfigured()?new Ro.O(Mo.RT.HISTORICAL_MESSAGE_WORKING_BACKUP,"This message was sent before this device logged in. Key backup is working, but we still do not (yet) have the key.",i):new Ro.O(Mo.RT.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED,"This message was sent before this device logged in, and key backup is not working.",i)}if(t.maybe_withheld){var _="The sender has disabled encrypting to unverified devices."===t.maybe_withheld?Mo.RT.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE:Mo.RT.MEGOLM_KEY_WITHHELD;throw new Ro.O(_,t.maybe_withheld,i)}switch(t.code){case P.MissingRoomKey:throw new Ro.O(Mo.RT.MEGOLM_UNKNOWN_INBOUND_SESSION_ID,"The sender's device has not sent us the keys for this message.",i);case P.UnknownMessageIndex:throw new Ro.O(Mo.RT.OLM_UNKNOWN_MESSAGE_INDEX,"The sender's device has not sent us the keys for this message at this index.",i);case P.SenderIdentityVerificationViolation:throw this.removeEventFromPendingList(e),new Ro.O(Mo.RT.SENDER_IDENTITY_PREVIOUSLY_VERIFIED,"The sender identity is unverified, but was previously verified.");case P.UnknownSenderDevice:throw this.removeEventFromPendingList(e),new Ro.O(Mo.RT.UNKNOWN_SENDER_DEVICE,"The sender device is not known.");case P.UnsignedSenderDevice:throw this.removeEventFromPendingList(e),new Ro.O(Mo.RT.UNSIGNED_SENDER_DEVICE,"The sender identity is not cross-signed.");default:throw new Ro.O(Mo.RT.UNKNOWN_ERROR,t.description,i)}}getEncryptionInfoForEvent(e){var t=this;return(0,s.A)((function*(){if(!e.getClearContent()||e.isDecryptionFailure())return null;if(null!==e.status)return{shieldColour:Mo.so.NONE,shieldReason:null};var r=yield t.olmMachine.getRoomEventEncryptionInfo(Ra(e),new yr(e.getRoomId()));return function(e,t){if(void 0===t)return null;var r,n,i=t.shieldState(!1);switch(i.color){case H.Grey:r=Mo.so.GREY;break;case H.None:r=Mo.so.NONE;break;default:r=Mo.so.RED}switch(i.code){case void 0:case null:n=null;break;case Y.AuthenticityNotGuaranteed:n=Mo.uV.AUTHENTICITY_NOT_GUARANTEED;break;case Y.UnknownDevice:n=Mo.uV.UNKNOWN_DEVICE;break;case Y.UnsignedDevice:n=Mo.uV.UNSIGNED_DEVICE;break;case Y.UnverifiedIdentity:n=Mo.uV.UNVERIFIED_IDENTITY;break;case Y.SentInClear:n=Mo.uV.SENT_IN_CLEAR;break;case Y.VerificationViolation:n=Mo.uV.VERIFICATION_VIOLATION}return{shieldColour:r,shieldReason:n}}(t.logger,r)}))()}getEventsPendingRoomKey(e,t){var r=this.eventsPendingKey.get(e);if(!r)return[];var n=r.get(t);return n?[...n]:[]}addEventToPendingList(e){var t=e.getRoomId();t&&this.eventsPendingKey.getOrCreate(t).getOrCreate(e.getWireContent().session_id).add(e)}removeEventFromPendingList(e){var t=e.getRoomId();if(t){var r=this.eventsPendingKey.getOrCreate(t);if(r){var n=r.get(e.getWireContent().session_id);n&&(n.delete(e),0===n.size&&(r.delete(e.getWireContent().session_id),0===r.size&&this.eventsPendingKey.delete(t)))}}}}function Ra(e){return JSON.stringify({event_id:e.getId(),type:e.getWireType(),sender:e.getSender(),state_key:e.getStateKey(),content:e.getWireContent(),origin_server_ts:e.getTs()})}var Ka=r(4303),Ia=r(5530),Ca=r(5542);function Oa(){return Oa=(0,s.A)((function*(e){var t,{logger:r,legacyStore:n}=e;if(yield vo(),new Yr(W.Debug).turnOn(),yield n.containsData()){yield n.startup();var i=null;if(yield n.doTxn("readonly",[Ia.y.STORE_ACCOUNT],(e=>{n.getAccount(e,(e=>{i=e}))})),i){var s=yield n.getMigrationState();if(!(s>=Ka.Il.MEGOLM_SESSIONS_MIGRATED)){var _=yield function(e,t){return Ma.apply(this,arguments)}(r,n),o=yield function(e,t){return Ea.apply(this,arguments)}(r,n),a=1+_+o;r.info("Migrating data from legacy crypto store. ".concat(_," olm sessions and ").concat(o," megolm sessions to migrate."));var c=0;u(0);var g=(new TextEncoder).encode(e.legacyPickleKey);s===Ka.Il.NOT_STARTED&&(r.info("Migrating data from legacy crypto store. Step 1: base data"),yield function(e,t,r,n,i,s,_){return Aa.apply(this,arguments)}(e.http,e.userId,e.deviceId,n,g,e.storeHandle,r),s=Ka.Il.INITIAL_DATA_MIGRATED,yield n.setMigrationState(s)),u(1),s===Ka.Il.INITIAL_DATA_MIGRATED&&(r.info("Migrating data from legacy crypto store. Step 2: olm sessions (".concat(_," sessions to migrate).")),yield function(e,t,r,n,i){return qa.apply(this,arguments)}(r,n,g,e.storeHandle,u),s=Ka.Il.OLM_SESSIONS_MIGRATED,yield n.setMigrationState(s)),s===Ka.Il.OLM_SESSIONS_MIGRATED&&(r.info("Migrating data from legacy crypto store. Step 3: megolm sessions (".concat(o," sessions to migrate).")),yield function(e,t,r,n,i){return Da.apply(this,arguments)}(r,n,g,e.storeHandle,u),s=Ka.Il.MEGOLM_SESSIONS_MIGRATED,yield n.setMigrationState(s)),null===(t=e.legacyMigrationProgressListener)||void 0===t||t.call(e,-1,-1),r.info("Migration from legacy crypto store complete")}}else r.debug("Legacy crypto store is not set up (no account found). Not migrating.")}function u(t){var r;c+=t,null===(r=e.legacyMigrationProgressListener)||void 0===r||r.call(e,c,a)}})),Oa.apply(this,arguments)}function Aa(){return(Aa=(0,s.A)((function*(e,t,r,n,i,s,_){var o=new pe;o.userId=new rn(t),o.deviceId=new Le(r),yield n.doTxn("readonly",[Ia.y.STORE_ACCOUNT],(e=>n.getAccount(e,(e=>{o.pickledAccount=null!=e?e:""}))));var a=yield Ta(n,i,"m.megolm_backup.v1");if(a){for(var c=!1,g=null;!c;)try{g=yield oa(e),c=!0}catch(e){_.info("Failed to get backup version during migration, retrying in 2 seconds",e),yield(0,Ao.yy)(2e3)}if(g&&"m.megolm_backup.v1.curve25519-aes-sha2"==g.algorithm)try{var u,d=_e.fromBase64(a),l=null===(u=g.auth_data)||void 0===u?void 0:u.public_key;d.megolmV1PublicKey.publicKeyBase64==l?(o.backupVersion=g.version,o.backupRecoveryKey=a):_.debug("The backup key to migrate does not match the active backup version","Cached pub key: ".concat(d.megolmV1PublicKey.publicKeyBase64),"Active pub key: ".concat(l))}catch(e){_.warn("Failed to check if the backup key to migrate matches the active backup version",e)}}o.privateCrossSigningMasterKey=yield Ta(n,i,"master"),o.privateCrossSigningSelfSigningKey=yield Ta(n,i,"self_signing"),o.privateCrossSigningUserSigningKey=yield Ta(n,i,"user_signing"),yield Ut.migrateBaseData(o,i,s)}))).apply(this,arguments)}function Ma(){return(Ma=(0,s.A)((function*(e,t){var r;return e.debug("Counting olm sessions to be migrated"),yield t.doTxn("readonly",[Ia.y.STORE_SESSIONS],(e=>t.countEndToEndSessions(e,(e=>r=e)))),r}))).apply(this,arguments)}function Ea(){return(Ea=(0,s.A)((function*(e,t){return e.debug("Counting megolm sessions to be migrated"),yield t.countEndToEndInboundGroupSessions()}))).apply(this,arguments)}function qa(){return(qa=(0,s.A)((function*(e,t,r,n,i){for(;;){var s=yield t.getEndToEndSessionsBatch();if(null===s)return;e.debug("Migrating batch of ".concat(s.length," olm sessions"));var _=[];for(var o of s){var a=new Yt;a.senderKey=o.deviceKey,a.pickle=o.session,a.lastUseTime=a.creationTime=new Date(o.lastReceivedMessageTs),_.push(a)}yield Ut.migrateOlmSessions(_,r,n),yield t.deleteEndToEndSessionsBatch(s),i(s.length)}}))).apply(this,arguments)}function Da(){return(Da=(0,s.A)((function*(e,t,r,n,i){for(;;){var s=yield t.getEndToEndInboundGroupSessionsBatch();if(null===s)return;e.debug("Migrating batch of ".concat(s.length," megolm sessions"));var _=[];for(var o of s){var a,c=o.sessionData,g=new Jt;g.pickle=c.session,g.roomId=new yr(c.room_id),g.senderKey=o.senderKey,g.senderSigningKey=null===(a=c.keysClaimed)||void 0===a?void 0:a.ed25519,g.backedUp=!o.needsBackup,g.imported=!0===c.untrusted,_.push(g)}yield Ut.migrateMegolmSessions(_,r,n),yield t.deleteEndToEndInboundGroupSessionsBatch(s),i(s.length)}}))).apply(this,arguments)}function Ba(){return(Ba=(0,s.A)((function*(e){var{logger:t,legacyStore:r,olmMachine:n}=e;if((yield r.containsData())&&!((yield r.getMigrationState())>=Ka.Il.ROOM_SETTINGS_MIGRATED)){var i={};for(var[s,_]of(yield r.doTxn("readwrite",[Ia.y.STORE_ROOMS],(e=>{r.getEndToEndRooms(e,(e=>{i=e}))})),t.debug("Migrating ".concat(Object.keys(i).length," sets of room settings")),Object.entries(i)))try{var o=new Or;if("m.megolm.v1.aes-sha2"!==_.algorithm){t.warn("Room ".concat(s,": ignoring room with invalid algorithm ").concat(_.algorithm));continue}o.algorithm=z.MegolmV1AesSha2,o.sessionRotationPeriodMs=_.rotation_period_ms,o.sessionRotationPeriodMessages=_.rotation_period_msgs,yield n.setRoomSettings(new yr(s),o)}catch(e){t.warn("Room ".concat(s,": ignoring settings ").concat(JSON.stringify(_)," which caused error ").concat(e))}t.debug("Completed room settings migration"),yield r.setMigrationState(Ka.Il.ROOM_SETTINGS_MIGRATED)}}))).apply(this,arguments)}function Ta(e,t,r){return Va.apply(this,arguments)}function Va(){return(Va=(0,s.A)((function*(e,t,r){var n=yield new Promise((t=>{e.doTxn("readonly",[Ia.y.STORE_ACCOUNT],(n=>{e.getSecretStorePrivateKey(n,t,r)}))}));return n&&n.ciphertext&&n.iv&&n.mac?yield(0,Ca.A)(n,t,r):n instanceof Uint8Array?(0,qo.WG)(n):void 0}))).apply(this,arguments)}function Fa(){return Fa=(0,s.A)((function*(e){var{legacyCryptoStore:t,rustCrypto:r,logger:n}=e,i=yield r.getOwnIdentity();if(i&&!i.isVerified()){var s=yield function(e){return Ua.apply(this,arguments)}(t);if(s){var _=JSON.parse(i.masterKey);if(_.keys&&0!==Object.keys(_.keys).length){var o=Object.values(_.keys)[0];o&&o==s&&(n.info("Post Migration: Migrating legacy trusted MSK: ".concat(s," to locally verified.")),yield i.verify())}else n.error("Post Migration | Unexpected error: no master key in the rust session.")}}})),Fa.apply(this,arguments)}function Ua(){return(Ua=(0,s.A)((function*(e){var t=null;return yield e.doTxn("readonly","account",(r=>{e.getCrossSigningKeys(r,(e=>{var r=null==e?void 0:e.master;r&&0!=Object.keys(r.keys).length&&(t=Object.values(r.keys)[0])}))})),t}))).apply(this,arguments)}function Pa(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Na(e){return xa.apply(this,arguments)}function xa(){return xa=(0,s.A)((function*(e){var t,{logger:r}=e;r.debug("Initialising Rust crypto-sdk WASM artifact"),yield vo(),new Yr(W.Debug).turnOn(),r.debug("Opening Rust CryptoStore"),t=e.storePrefix?e.storeKey?yield Gr.openWithKey(e.storePrefix,e.storeKey):yield Gr.open(e.storePrefix,e.storePassphrase):yield Gr.open(),e.legacyCryptoStore&&(yield function(e){return Oa.apply(this,arguments)}(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Pa(Object(r),!0).forEach((function(t){(0,i.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pa(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({legacyStore:e.legacyCryptoStore,storeHandle:t},e)));var n=yield function(e,t,r,n,i,s,_,o){return za.apply(this,arguments)}(r,e.http,e.userId,e.deviceId,e.secretStorage,e.cryptoCallbacks,t,e.legacyCryptoStore);return t.free(),r.debug("Completed rust crypto-sdk setup"),n})),xa.apply(this,arguments)}function za(){return za=(0,s.A)((function*(e,t,r,n,i,s,_,o){e.debug("Init OlmMachine");var a=yield Nt.initFromStore(new rn(r),new Le(n),_);o&&(yield function(e){return Ba.apply(this,arguments)}({logger:e,legacyStore:o,olmMachine:a})),a.roomKeyRequestsEnabled=!1;var c=new ka(e,a,t,r,n,i,s);if(yield a.registerRoomKeyUpdatedCallback((e=>c.onRoomKeysUpdated(e))),yield a.registerRoomKeysWithheldCallback((e=>c.onRoomKeysWithheld(e))),yield a.registerUserIdentityUpdatedCallback((e=>c.onUserIdentityUpdated(e))),yield a.registerDevicesUpdatedCallback((e=>c.onDevicesUpdated(e))),c.checkSecrets("m.megolm_backup.v1"),yield a.registerReceiveSecretCallback(((e,t)=>c.checkSecrets(e))),yield a.outgoingRequests(),o&&(yield o.containsData())&&(yield o.getMigrationState())<Ka.Il.INITIAL_OWN_KEY_QUERY_DONE){e.debug("Performing initial key query after migration");for(var g=!1;!g;)try{yield c.userHasCrossSigningKeys(r),g=!0}catch(t){e.error("Failed to check for cross-signing keys after migration, retrying",t)}yield function(e){return Fa.apply(this,arguments)}({legacyCryptoStore:o,rustCrypto:c,logger:e}),yield o.setMigrationState(Ka.Il.INITIAL_OWN_KEY_QUERY_DONE)}return c})),za.apply(this,arguments)}},4069:e=>{for(var t=/[\\\"\x00-\x1F]/g,r={},n=0;n<32;++n)r[String.fromCharCode(n)]="\\U"+("0000"+n.toString(16)).slice(-4).toUpperCase();function i(e){return t.lastIndex=0,e.replace(t,(function(e){return r[e]}))}r["\b"]="\\b",r["\t"]="\\t",r["\n"]="\\n",r["\f"]="\\f",r["\r"]="\\r",r['"']='\\"',r["\\"]="\\\\",e.exports={stringify:function e(t){switch(typeof t){case"string":return'"'+i(t)+'"';case"number":return isFinite(t)?t:"null";case"boolean":return t;case"object":return null===t?"null":Array.isArray(t)?function(t){for(var r="[",n="",i=0;i<t.length;++i)n+=r,r=",",n+=e(t[i]);return","!=r?"[]":n+"]"}(t):function(t){var r="{",n="",s=Object.keys(t);s.sort();for(var _=0;_<s.length;++_){var o=s[_];n+=r+'"'+i(o)+'":',r=",",n+=e(t[o])}return","!=r?"{}":n+"}"}(t);default:throw new Error("Cannot stringify: "+typeof t)}}}},9627:(e,t,r)=>{e.exports=r.p+"c73c67d011a9c8e47a6d.wasm"}}]);